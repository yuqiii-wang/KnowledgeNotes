
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Personal Knowledge Base and Notes">
      
      
        <meta name="author" content="Yuqi">
      
      
      
        <link rel="prev" href="vins.html">
      
      
        <link rel="next" href="../examples/ceres.html">
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>VINS SLAM Source Code Review - Yuqi's Knowledge Blogs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vins-slam-source-code-review" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../index.html" title="Yuqi&#39;s Knowledge Blogs" class="md-header__button md-logo" aria-label="Yuqi's Knowledge Blogs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yuqi's Knowledge Blogs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              VINS SLAM Source Code Review
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../index.html" title="Yuqi&#39;s Knowledge Blogs" class="md-nav__button md-logo" aria-label="Yuqi's Knowledge Blogs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Yuqi's Knowledge Blogs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Yuqi's Knowledge Blogs
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data structure and algos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data structure and algos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Algos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Algos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Backtracking
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Backtracking
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/algos/backtracking/backtracking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backtracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dynamic programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dynamic programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/algos/dynamic_programming/dynamic_programming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Search
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Search
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/algos/search/bfs_vs_dfs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Difference Between BFS and DFS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data structs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data structs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stack heap queue
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stack heap queue
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/data_structs/stack_heap_queue/summary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stack, Heap and Queue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tree
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tree
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/data_structs/tree/binary_tree.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Binary Tree
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Probability and statistics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Probability and statistics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/probability_and_statistics/ants_leaving_bridge.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ants leaving bridge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/probability_and_statistics/eight_horse_racing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eight Horse Racing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structure_and_algos/probability_and_statistics/money_hall_problem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Money Hall Problem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Database
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/cluster.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DB Cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sharding_and_partitioning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sharding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Non sql
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Non sql
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/big_query.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Big Query
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/summary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3" id="__nav_3_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Es
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Es
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/es/elastic_search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elastic Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/es/kibana.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kibana
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ldap
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ldap
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/ldap/indexing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LDAP Indexing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/ldap/ldap_proto.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LDAP Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/ldap/ldap_schema.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LDAP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_3_5" id="__nav_3_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mongodb
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mongodb
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/mongodb/indexing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MongoDB Indexing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/mongodb/mongo_clustering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MongoDB Clustering and Replication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/mongodb/mongodb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MongoDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_3_6" id="__nav_3_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Redis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/redis/examples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Example Uses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/redis/lock.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use of redis lock
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/redis/performance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Performance Discussions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/redis/redis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/non_sql/redis/redis_clustering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis CLustering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sql
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sql
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/db_adv_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DB Advanced Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/db_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common DB knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/optimizations_on_complex_sql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Optimizations Over SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/sql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some SQL Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_6" >
        
          
          <label class="md-nav__link" for="__nav_3_4_6" id="__nav_3_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mysql and oracle
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mysql and oracle
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/mysql_and_oracle/mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MYSQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/mysql_and_oracle/mysql_clustering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MYSQL Clustering/Distribution and Sharding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/mysql_and_oracle/optimizations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Optimizations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/mysql_and_oracle/oracle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Oracle knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_7" >
        
          
          <label class="md-nav__link" for="__nav_3_4_7" id="__nav_3_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Postgresql
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Postgresql
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/postgresql/postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Postgre SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_8" >
        
          
          <label class="md-nav__link" for="__nav_3_4_8" id="__nav_3_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sqlite
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sqlite
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../database/sql/sqlite/sqlite.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQLite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dev ops
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dev ops
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cloud devops
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cloud devops
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Aws
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Aws
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/aws/aws_cloud_perf_devops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Performance DevOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/aws/concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/aws/connection_checks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Connection Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/aws/operations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Best AWS Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/aws/system_mgr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1_6" >
        
          
          <label class="md-nav__link" for="__nav_4_1_1_6" id="__nav_4_1_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Rds
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Rds
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/aws/rds/redshift.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Redshift
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2" >
        
          
          <label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Docker
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/docker/containerd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Containerd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/docker/docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/docker/docker_adv.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Engine and Advanced Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/docker/docker_practice.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" >
        
          
          <label class="md-nav__link" for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    K8s
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    K8s
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/k8s/helm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/k8s/k8s.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/k8s/k8s_components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common K8S Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/k8s/k8s_mon_stack.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K8S Monitoring Stack
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/k8s/k8s_practice.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K8S Practice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/k8s/k8s_variants.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K8S Variants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" >
        
          
          <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Service mgt
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Service mgt
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/service_mgt/service_discovery.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Service Discovery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_5" >
        
          
          <label class="md-nav__link" for="__nav_4_1_5" id="__nav_4_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Terraform
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Terraform
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/terraform/terraform.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terraform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/cloud_devops/terraform/tips.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Development Tips
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux devops
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux devops
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/linux_devops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Linux Knowledge and DevOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/linux_network_devops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Network DevOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/linux_perf_devops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Performance DevOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/mac.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mac OS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/ubuntu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ubuntu
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6" id="__nav_4_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Bash
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Bash
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/bash/awk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWK tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/bash/bash_ops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bash common Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/bash/linux_tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Linux Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/bash/network.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network linux tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/linux_devops/bash/special_char_ops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Special Character Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Software tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Software tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_1" >
        
          
          <label class="md-nav__link" for="__nav_4_3_1" id="__nav_4_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CMake
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    CMake
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/CMake/cmake_tutorials.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cmake
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_2" >
        
          
          <label class="md-nav__link" for="__nav_4_3_2" id="__nav_4_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Git
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/Git/git_tutorials.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3_3" id="__nav_4_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Postman
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Postman
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/Postman/postman.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Postman
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_4" >
        
          
          <label class="md-nav__link" for="__nav_4_3_4" id="__nav_4_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Splunk
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Splunk
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/Splunk/Splunk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Splunk
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_5" >
        
          
          <label class="md-nav__link" for="__nav_4_3_5" id="__nav_4_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ansible
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/ansible/ansible.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_6" >
        
          
          <label class="md-nav__link" for="__nav_4_3_6" id="__nav_4_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Grafana k6
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Grafana k6
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/grafana_k6/grafana_k6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grafana K6 for Stress Test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_7" >
        
          
          <label class="md-nav__link" for="__nav_4_3_7" id="__nav_4_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Jenkins
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Jenkins
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/jenkins/jenkins.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jenkins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_8" >
        
          
          <label class="md-nav__link" for="__nav_4_3_8" id="__nav_4_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nginx
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/nginx/nginx.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_9" >
        
          
          <label class="md-nav__link" for="__nav_4_3_9" id="__nav_4_3_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Virtualbox
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Virtualbox
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/virtualbox/virtualbox.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VirtualBox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_10" >
        
          
          <label class="md-nav__link" for="__nav_4_3_10" id="__nav_4_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vscode
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vscode
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/software_tools/vscode/vscode_shortcuts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some very useful shortcuts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Fundamental computer
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fundamental computer
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/terminologies.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terminology Explain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Compilation principles
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Compilation principles
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/compilation_principles/compilation_principles.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compilation Principles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/compilation_principles/computer_arch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Computer Architecure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/compilation_principles/cross_compilation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cross Compilation on x86 and Arm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/compilation_principles/executable_elf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Executable ELF (Executable and Linkable Format)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/compilation_principles/helloworld_example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hello world example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/compilation_principles/linker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/compilation_principles/symbol_table_elf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ELF Symbol Table
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Embedded system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Embedded system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/embedded_system/embedded_system_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embedded System Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/embedded_system/embedded_system_multi_media.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Media
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/embedded_system/eps32_start_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EPS32
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/embedded_system/esp32p4_board.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ESP32P4 Board and Relevant Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Hardwawre
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Hardwawre
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/bootloader.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bootloader when a Computer Starts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/display.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Display
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/dma.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Direct Memory Access (DMA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/motherboard.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Motherboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/numa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Non-Uniform Memory Access (NUMA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_6" >
        
          
          <label class="md-nav__link" for="__nav_5_4_6" id="__nav_5_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cpu
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cpu
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/cpu/cpu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_7" >
        
          
          <label class="md-nav__link" for="__nav_5_4_7" id="__nav_5_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Digital electronics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Digital electronics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/digital_electronics/FPGA.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FPGA and Verilog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/digital_electronics/VHDL.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VHDL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/digital_electronics/circuit_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Circuit Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/digital_electronics/pcb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Printed Circuit Board
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/digital_electronics/verilog.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Verilog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_7_6" >
        
          
          <label class="md-nav__link" for="__nav_5_4_7_6" id="__nav_5_4_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Simple cpu tutorial
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_4_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Simple cpu tutorial
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/digital_electronics/simple_cpu_tutorial/8_bit_cpu_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8-bit single-cycle CPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_8" >
        
          
          <label class="md-nav__link" for="__nav_5_4_8" id="__nav_5_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Disk
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Disk
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/disk/disk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Disk Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_9" >
        
          
          <label class="md-nav__link" for="__nav_5_4_9" id="__nav_5_4_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Gpu
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Gpu
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/gpu/gpu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/hardwawre/gpu/gpu_hardware.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPU Hardware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operating sys
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operating sys
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/OS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operating System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/macos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mac OS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/memory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory OS management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/process_mgt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process and thread management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/rtos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RTOS (Real Time Operating System)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/storage_and_peripherals.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage and Peripherals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_5_7" id="__nav_5_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/linux.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux OS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/system_call.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux System Call
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/virtual_file_sys.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Virtual File System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_7_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5_7_5" id="__nav_5_5_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Io
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Io
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/io/IO.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/io/block_io.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block IO/Peripheral/Devices Layer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/io/dma.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Direct Memory Access (DMA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/io/driver.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/io/linux_storage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_7_6" >
        
          
          <label class="md-nav__link" for="__nav_5_5_7_6" id="__nav_5_5_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Kernel
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kernel
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/kernel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Kernel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/kernel_perf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kernel Performance Measurement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/memcpy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory copy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/memory_kernel_structs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Implementation in Linux Kernel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/memory_methods.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kernel Memory Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/memory_proc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory for User Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/page.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Page
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/process_scheduling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Scheduling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/kernel/thread.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thread
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_7_7" >
        
          
          <label class="md-nav__link" for="__nav_5_5_7_7" id="__nav_5_5_7_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Malloc and free
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_7_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Malloc and free
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/malloc_and_free/free.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Free
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/malloc_and_free/malloc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    malloc and free Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/malloc_and_free/others.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Malloc and Free Other Discussions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_7_8" >
        
          
          <label class="md-nav__link" for="__nav_5_5_7_8" id="__nav_5_5_7_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Realtime
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_7_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Realtime
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/Linux/realtime/realtime.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Real Time Linux (RT)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_5_8" id="__nav_5_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Socket
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Socket
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/napi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    New API (NAPI)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_struct.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Socket structures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/tcp_queue_summary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TCP queues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/tcp_recv_mem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_8_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5_8_5" id="__nav_5_5_8_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Select poll epoll
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_8_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Select poll epoll
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/select_poll_epoll/epoll.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EPoll
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/select_poll_epoll/epoll_implementation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Epoll Implementation Detail
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/select_poll_epoll/nginx_epoll_study.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx epoll study
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/select_poll_epoll/poll.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Socket Poll
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/select_poll_epoll/select.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Socket Select
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/select_poll_epoll/summary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_8_6" >
        
          
          <label class="md-nav__link" for="__nav_5_5_8_6" id="__nav_5_5_8_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Socket proc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_8_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Socket proc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/accept.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accept
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/bind.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bind
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/connect.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connect
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/listen.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Listen
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/recv_byNIC.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TCP recv from NIC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/recv_byUser.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recv from user
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/send.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connect
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/socket.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Socket
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fundamental_computer/operating_sys/socket/socket_proc/summary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Math
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Math
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ai
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ai
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1" id="__nav_6_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Audio
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Audio
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/audio/audio_freq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audio Frequency Explained
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/audio/text_and_audio.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Text and Audio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2" >
        
          
          <label class="md-nav__link" for="__nav_6_1_2" id="__nav_6_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cv
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cv
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/epilolar_geo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Epipolar geometry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/homography.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homography
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/paddleocr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Paddle OCR (Optical Character Recognition)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/shader.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/triangulation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Triangulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_6" >
        
          
          <label class="md-nav__link" for="__nav_6_1_2_6" id="__nav_6_1_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Camera
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Camera
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/camera/camera_setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stereo Camera Calibration and Rectification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/camera/camera_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Camera Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/camera/light_and_lens.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Light and Lens
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_7" >
        
          
          <label class="md-nav__link" for="__nav_6_1_2_7" id="__nav_6_1_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cnn
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cnn
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cnn/cnn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Convolutional Neural Network (CNN)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cnn/googlenet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GoogLeNet (InceptionV1)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cnn/r_cnn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regions with CNN (R-CNN)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cnn/resnet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Residual neural network (ResNet)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cnn/u_net.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    U-Net
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cnn/yolo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    You Only Look Once v3 (YOLOv3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cnn/yolo_libtorch_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YOLOv3 + Libtorch Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_8" >
        
          
          <label class="md-nav__link" for="__nav_6_1_2_8" id="__nav_6_1_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cv basics.md
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cv basics.md
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_basics.md/img_proc_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic Image Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_basics.md/interpolation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interpolation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_9" >
        
          
          <label class="md-nav__link" for="__nav_6_1_2_9" id="__nav_6_1_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cv features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cv features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/akaze.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Akaze
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/bow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BoW (Bags of Words)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/canny_detector.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canny Detector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/harris.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harris Operator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/orb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ORB (Oriented FAST and Rotated BRIEF)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/sift.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scale-invariant feature transform (SIFT)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/surf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SURF (Speeded-Up Robust Features)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_features/wavelet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wavelet Transform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_10" >
        
          
          <label class="md-nav__link" for="__nav_6_1_2_10" id="__nav_6_1_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cv generative
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cv generative
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_generative/clip.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contrastive Language-Image Pre-training (CLIP)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_generative/controlnet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ControlNet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_generative/diffusion_model.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diffusion Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/cv/cv_generative/vae.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Variational Autoencoder (VAE)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3" >
        
          
          <label class="md-nav__link" for="__nav_6_1_3" id="__nav_6_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Machine learning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Machine learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic machine learning knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/err_metrics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/high_dim_embedding.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    High Dimension Embedding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/multi_task_training.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Task Training/Fine-Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/reinforcement_learning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reinforcement Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_6" >
        
          
          <label class="md-nav__link" for="__nav_6_1_3_6" id="__nav_6_1_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Deep learning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deep learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/activation_funcs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Activation Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/compression.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Compression: Pruning, Distillation and Quantization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/nn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/nn_weight_init.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Parameter Initialization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/normalization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Normalization in Deep Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/ntk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Tangent Kernel (NTK)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/optimizer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Optimizers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/quantization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Quantization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/rnn_and_lstm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sequence NNs: RNN, GRU and LSTM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/stable_training.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stable Training Discussions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/deep_learning/training_rate_scheduling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Training Rate Scheduling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_7" >
        
          
          <label class="md-nav__link" for="__nav_6_1_3_7" id="__nav_6_1_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Non deeplearning methods
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Non deeplearning methods
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/boosting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Boosting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/decision_tree.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decision Tree
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/kmeans_and_knn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K-means and KNN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/lda.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linear Discriminant Analysis (LDA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/logistic_regression.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logistic Regression
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/markov_chain.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Markov Chain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/naive_bayes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Naive Bayes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/ransac.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Random Sample Consensus (RANSAC)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/machine_learning/non_deeplearning_methods/svm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Support Vector Machine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_4" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4" id="__nav_6_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nlp
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nlp
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/attention_further_details.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attention Mechanism Further Explained
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/attention_is_all_you_need.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attention Is All You Need
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/attention_variants.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attention Variants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/non_deep_learning_embeddings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Non Deep Learning Embeddings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Large Language Model (LLM) Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/similarity.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Text Similarity/Overlap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/text_generation_strategies.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Text Generation Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/tokenization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tokenization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_4_9" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4_9" id="__nav_6_1_4_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Embedding
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Embedding
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/embedding/constrasive_learning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contrastive Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/embedding/rope_emb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embeddings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/embedding/semantic_emb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantics/Linguistics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_4_10" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4_10" id="__nav_6_1_4_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Llm
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Llm
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/deepseek.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DeepSeek
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/inference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Inference Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/llm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM (Large Language Model)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/llm_cache.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache in LLM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/llm_evaluation_enhancement.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Evaluation Enhancement Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/llm_evaluations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Evaluations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/llm_frameworks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Frameworks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/long_context.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Long Context Interpolation and Extrapolation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/moe.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mixture of Experts (MoEs)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_4_10_10" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4_10_10" id="__nav_6_1_4_10_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Rag
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_4_10_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4_10_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Rag
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/rag/adv_rag.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/rag/graph_rag.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graph RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/rag/rag.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retrieval Augmented Generation (RAG)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_4_10_11" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4_10_11" id="__nav_6_1_4_10_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Training and finetuning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_4_10_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4_10_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Training and finetuning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/training_and_finetuning/llm_fine_tuning_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parameter-Efficient Fine Tuning (PEFT) Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/training_and_finetuning/llm_full_param_finetuning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Full Parameter Finetuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/training_and_finetuning/llm_param_efficient_finetuning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parameter-Efficient Fine Tuning (PEFT)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/training_and_finetuning/llm_training_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Training Considerations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/training_and_finetuning/ppo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proximal Policy Optimization (PPO)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/nlp/llm/training_and_finetuning/rlhf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reinforcement Learning from Human Feedback (RLHF)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_5" >
        
          
          <label class="md-nav__link" for="__nav_6_1_5" id="__nav_6_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Software
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Software
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/software/comfyui.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comfy UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Algebra
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Algebra
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/polynomial.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Polynomial
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/seires.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Series
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/sequence.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sequence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/some_algebra.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Miscellaneous Algebra
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/trigonometry.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trigonometry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_6" >
        
          
          <label class="md-nav__link" for="__nav_6_2_6" id="__nav_6_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Complex and series
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Complex and series
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/complex_and_series/calculations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Calculation Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/complex_and_series/complex_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complex Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/complex_and_series/complex_aplications.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complex Applications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_7" >
        
          
          <label class="md-nav__link" for="__nav_6_2_7" id="__nav_6_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Differential and integral
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Differential and integral
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/calculations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Differential and Integral Calculations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/differentiable_manifold.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Differentiable Manifold
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/differential_equations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Differential equations in matrix form
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/differential_rules.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Differential Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_rules.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Integral Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/legendre_transformation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Legendre Transformation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/principal_curvature.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Principal Curvature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/some_terminologies.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terminologies in Differential and Integral
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_7_9" >
        
          
          <label class="md-nav__link" for="__nav_6_2_7_9" id="__nav_6_2_7_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integral approx
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_7_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integral approx
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_approx/gauss_hermite_quad.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GaussHermite Quadrature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_approx/gaussian_quad.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gaussian quadrature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_approx/lagrange_interpolation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lagrange Interpolation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_approx/legendre_poly.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Legendre polynomials
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_approx/riemann_sum.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Riemann sum
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_approx/stone_weierstrass.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    StoneWeierstrass theorem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/differential_and_integral/integral_approx/taylor_polynomials.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Approximating Integrals using Taylor Polynomials
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_8" >
        
          
          <label class="md-nav__link" for="__nav_6_2_8" id="__nav_6_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linear algebra
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linear algebra
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_8_1" >
        
          
          <label class="md-nav__link" for="__nav_6_2_8_1" id="__nav_6_2_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Matrix
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Matrix
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/linear_transform_intuition.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linear Transform Intuition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/matrix.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Matrix Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/matrix_adv.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    More Matrix Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/matrix_decomp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matrix Decomposition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/matrix_derivative.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matrix Derivative
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/matrix_norm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matrix Norms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/matrix_ops_rules.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matrix/vector Multiplication and Derivative Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/positive_definite_mat.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Positive-definite matrix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/skew_mat.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Skew Symmetric
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/matrix/svd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Singular Value Decomposition (SVD)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_8_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2_8_2" id="__nav_6_2_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vector
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vector
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/vector/vector.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/vector/vector_field.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector Field
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/vector/vector_norm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector Normalization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/linear_algebra/vector/vector_products.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Products: dot, cross and exterior
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_9" >
        
          
          <label class="md-nav__link" for="__nav_6_2_9" id="__nav_6_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Optimization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Optimization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_9_1" >
        
          
          <label class="md-nav__link" for="__nav_6_2_9_1" id="__nav_6_2_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Approaches
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Approaches
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/expectation_maximization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Expectation Maximization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/lagrange_multipliers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lagrangian Multiplier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/primal_dual.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Primal-Dual Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_9_1_4" >
        
          
          <label class="md-nav__link" for="__nav_6_2_9_1_4" id="__nav_6_2_9_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Bio inspired
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_2_9_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_9_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Bio inspired
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/bio_inspired/ant_colony.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ant colony
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/bio_inspired/gene.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gene
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/bio_inspired/pso.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Particle Swarm Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_9_1_5" >
        
          
          <label class="md-nav__link" for="__nav_6_2_9_1_5" id="__nav_6_2_9_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Iterative gradients
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_2_9_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_9_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Iterative gradients
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/conjugate_gradient.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Conjugate Gradient
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/dogleg.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Powell's Dogleg Method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/gauss_newton.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gauss-Newton Method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/gradient_descent.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gradient Descent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/levenberg_marquardt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Levenberg-Marquardt's Method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/newton.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Newton's Method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/powell_conjugate_direction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Powell's Conjugate Direction Method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/runge_kutta.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runge-Kutta
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/approaches/iterative_gradients/summary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary of various methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_9_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2_9_2" id="__nav_6_2_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Problem statements
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_9_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Problem statements
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/convex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Convex Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/dp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/graph_optimization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graph Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/least_squares.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Least Squares Problem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/max_likelihood_est.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maximum Likelihood Estimation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/qp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quadratic Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/regularization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regularization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/optimization/problem_statements/saddle_point_and_hessian.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Saddle Points and Hessian in Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_10" >
        
          
          <label class="md-nav__link" for="__nav_6_2_10" id="__nav_6_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stats and probability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stats and probability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/baysian.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bayes' Theorem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/inferential_stats.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inferential Statistics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/information.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Information
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/riddles.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Probability, Combination and Permutation Riddles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/stats_evaluation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_10_6" >
        
          
          <label class="md-nav__link" for="__nav_6_2_10_6" id="__nav_6_2_10_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Distribution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_10_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_10_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Distribution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/distribution/chi_squared_dist.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chi-Squared Distribution () and Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/distribution/distribution.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/distribution/miltinomial_dist.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multinomial Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/distribution/normal_dist.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Normal Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/distribution/poisson_dist.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Poisson Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/distribution/t_dist.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    T Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_10_7" >
        
          
          <label class="md-nav__link" for="__nav_6_2_10_7" id="__nav_6_2_10_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Random process
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_10_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_10_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Random process
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/random_process/bernoulli_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bernoulli process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/random_process/gaussian_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gaussian Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/random_process/ornstein_uhlenbeck_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ornstein-Uhlenbeck (OU) Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/random_process/poisson_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Poisson Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/random_process/random_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Random/Stochastic Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/random_process/random_walk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Random Walk
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algebra/stats_and_probability/random_process/wiener_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wiener Process  (Brownian Motion )
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Finance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Finance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_1" >
        
          
          <label class="md-nav__link" for="__nav_6_3_1" id="__nav_6_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Eco law fin knowledge
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Eco law fin knowledge
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/eco_law_fin_knowledge/commercial_banking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commercial Banking for Business
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/eco_law_fin_knowledge/derivatives.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Derivative
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/eco_law_fin_knowledge/eco_law_fin_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Economics, Law and Finance Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/eco_law_fin_knowledge/equities.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Equities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/eco_law_fin_knowledge/ficc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fixed Income, Currencies and Commodities (FICC)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/eco_law_fin_knowledge/investment_banking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Investment Banking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/eco_law_fin_knowledge/legal.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Legal and Regulations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2" >
        
          
          <label class="md-nav__link" for="__nav_6_3_2" id="__nav_6_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Financing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Financing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/bond.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bond
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/bond_yield_modeling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    bond Yield Modeling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/financing_by_bonds_and_loans.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Financing ()
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/financing_interest_rate.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Financing Interest Rates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/loan.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/repo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repurchase Agreement (REPO, /)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/repo_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repurchase Agreement (REPO) Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/repo_risks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repurchase Agreement (REPO) Risks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/financing/triparty.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custodian and Triparty
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3_3" id="__nav_6_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Quant
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Quant
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/quant/alphas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alphas: The Excess Return
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/quant/barra_risk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Barra Risk Factor Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/quant/fix.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Financial Information eXchange (FIX)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/quant/hft_cpp_tricks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    High Frequency Trading C++ Tricks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/quant/hkex_derivative_realtime_data_access.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HKEX Orion Market Data Platform for Derivatives (OMD-D)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/quant/quant_trading.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quantitative Trading Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/quant/risks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Risks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_4" >
        
          
          <label class="md-nav__link" for="__nav_6_3_4" id="__nav_6_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Structured products
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Structured products
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/structured_products/black_scholes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Black scholes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/structured_products/structured_product_rfq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Structured product rfq
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../finance/structured_products/structured_products.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Structured Products
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mechanics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mechanics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanics/3d_printing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3d printing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" checked>
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Slam
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Slam
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_camera_calibration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lidar Camera Calibration and Simple Fusion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../personal_projects.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Personal Projects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ros.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ROS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_4" >
        
          
          <label class="md-nav__link" for="__nav_6_5_4" id="__nav_6_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Control
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Control
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/fuzzy_control.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fuzzy Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kalman_filter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kalman Filter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kalman_filter_nonlinear.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kalman filters for non-linear problems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/lqr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LQR (Linear Quadratic Regulator)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/mpc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Predictive Control (MPC)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/state_estimation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State Estimation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_4_7" >
        
          
          <label class="md-nav__link" for="__nav_6_5_4_7" id="__nav_6_5_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Imu
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_5_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Imu
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/imu/imu_noise_calibration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IMU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/imu/imu_preintegration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pre-integration in IMU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_4_8" >
        
          
          <label class="md-nav__link" for="__nav_6_5_4_8" id="__nav_6_5_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Kinematics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_5_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kinematics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/affine_trans.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Affine Transform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/homogeneous_trans.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homogeneous Transformation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/physics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Physics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/quaternion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quaternion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/rotation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rotation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/sim3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Similar Transform Group \(Sim(3)\) and \(sim(3)\)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_4_8_7" >
        
          
          <label class="md-nav__link" for="__nav_6_5_4_8_7" id="__nav_6_5_4_8_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Lie group and algebra
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_5_4_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5_4_8_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Lie group and algebra
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/lie_group_and_algebra/lie_and_robotics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lie and Robotics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/lie_group_and_algebra/lie_bracket.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lie Bracket
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/lie_group_and_algebra/lie_group_and_algebra.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lie Algebra and Group
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/kinematics/lie_group_and_algebra/verification_proof.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lie Group and Lie Algebra Proof for \(SO(3)\), \(SE(3)\), and \(Sim(3)\)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5_5" id="__nav_6_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Lidar slam
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Lidar slam
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/amcl.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lidar Localization - AMCL Adaptive Monte Carlo Localization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/amcl_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AMCL Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/google_cart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lidar Mapping Google Cartographer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/google_cart_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Cartographer Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/icp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Iterative Closest Point (ICP)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/lidar_hardware.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lidar hardware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/loam.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LOAM: Lidar Odometry and Mapping
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/loam_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LOAM (Lidar Odometry and Mapping) Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/ndt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Normal Distribution Transform (NDT)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/particle_filters.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Particle Filter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lidar_slam/pcl.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Point Cloud Library (PCL)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_6" >
        
          
          <label class="md-nav__link" for="__nav_6_5_6" id="__nav_6_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Path
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Path
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/aStar_and_dStar.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A and D Global Path Planning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/curves.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Curves
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/dwa_local_planning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic Window Approach to Collision Avoidance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/em_planner.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EM (Expectation-Maximization) Path Planner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/lattice.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lattice Motion Planning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/loop_closure.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loop Closure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/rrt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rapidly-exploring Random Tree (RRT)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/teb_local_planning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Timed Elastic Band
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path/tracking_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vehicle Properties/Measurements to Road/Track
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_7" checked>
        
          
          <label class="md-nav__link" for="__nav_6_5_7" id="__nav_6_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vslam
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vslam
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bundle_adjustment_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bundle Adjustment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bundle_adjustment_optimization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bundle Adjustment Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lucas_kanade_tracking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lucas-Kanade Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optical_flow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Optical Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pnp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PnP (Perspective-n-Point)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_7_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6_5_7_6" id="__nav_6_5_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dense reconstruction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_5_7_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_5_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dense reconstruction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bevformer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bevformer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dense_reconstruction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dense Reconstruction/Structure from Motion (SfM)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dtam.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Direct Tracking and Mapping (DTAM)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lsd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LSD-SLAM: Large-Scale Direct Monocular SLAM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="orbslam.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ORB-SLAM: a Versatile and Accurate Monocular SLAM System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="orbslam_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ORB SLAM Source Code Review
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ptam.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parallel Tracking and Mapping (PTAM)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="svo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SVO: Fast Semi-Direct Monocular Visual Odometry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vins.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VINS-Mono: A Robust and Versatile Monocular Visual-Inertial State Estimator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    VINS SLAM Source Code Review
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="vins_code.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    VINS SLAM Source Code Review
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#compile-and-launch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compile and Launch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compile and Launch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-pose_graph-4-process-has-died-and-feature_tracker-2-process-has-died" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error [pose_graph-4] process has died and [feature_tracker-2] process has died
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overall-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overall Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overall Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-main-work-in-processimu" class="md-nav__link">
    <span class="md-ellipsis">
      
        The main work in processIMU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-main-work-in-processimage" class="md-nav__link">
    <span class="md-ellipsis">
      
        The main work in processImage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimized-parameter-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimized Parameter Mapping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visual-initial-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual Initial Alignment
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#marginalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Marginalization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Marginalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marginalization-residuals-and-jacobians" class="md-nav__link">
    <span class="md-ellipsis">
      
        Marginalization Residuals and Jacobians
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-marginalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Marginalization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute-marginalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compute Marginalization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imu" class="md-nav__link">
    <span class="md-ellipsis">
      
        IMU
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IMU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imu-noise-and-covariance-propogation" class="md-nav__link">
    <span class="md-ellipsis">
      
        IMU Noise and Covariance Propogation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imu-residuals-and-jacobians" class="md-nav__link">
    <span class="md-ellipsis">
      
        IMU Residuals and Jacobians
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reprojection-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reprojection Error
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feature-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feature Tracking
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feature Tracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#brief-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        BRIEF Features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-publish" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feature Publish
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pose-graph-and-loop-closure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pose Graph and Loop Closure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pose Graph and Loop Closure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-visulization-and-buffer-storage-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Visulization and Buffer Storage Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relocalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relocalization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-closure-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loop Closure Detection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-closure-correction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loop Closure Correction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-pose-graph-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Pose Graph Optimization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_7_7" >
        
          
          <label class="md-nav__link" for="__nav_6_5_7_7" id="__nav_6_5_7_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_5_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5_7_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/ceres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ceres Optimization Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mgt and design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mgt and design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/ITOfficeConcepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    UML
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    UML
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/UML/UML.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UML (Unified Modeling Language)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Creational design patterns
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Creational design patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_1" >
        
          
          <label class="md-nav__link" for="__nav_7_3_1" id="__nav_7_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Builder
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Builder
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/creational_design_patterns/builder/builder.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Builder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_2" >
        
          
          <label class="md-nav__link" for="__nav_7_3_2" id="__nav_7_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Factory
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Factory
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/creational_design_patterns/factory/factory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Factory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3_3" id="__nav_7_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Prototype
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Prototype
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/creational_design_patterns/prototype/prototype.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prototype
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_4" >
        
          
          <label class="md-nav__link" for="__nav_7_3_4" id="__nav_7_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Proxy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Proxy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/creational_design_patterns/proxy/proxy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxy Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_5" >
        
          
          <label class="md-nav__link" for="__nav_7_3_5" id="__nav_7_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Singleton
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Singleton
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/creational_design_patterns/singleton/singleton.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Singleton
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/project_management/DesignThinking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Thinking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/project_management/Test.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tests in Project Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/project_management/agile.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agile
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/project_management/complex_system_naming_convention.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complex System Naming Convention
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/project_management/okr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OKR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    System design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    System design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/system_design/FST_HFSM.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Behavior Tree (BT) and Hierarchical Finite State Machine (HFSM)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/system_design/genai_design.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Enterprise Generative AI (NLP) Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/system_design/microservice.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microservice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/system_design/obj_oriented_programming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Four Concepts of Object Oriented Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/system_design/system_design.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mgt_and_design/system_design/web_server_system_design.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Design: High-Performance Web Server System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Network
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/http_headers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP Headers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/networks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Blockchain
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blockchain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/asset_tokenization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Asset Tokenization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/blockchain.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blockchain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/corda.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    R3's Corda
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/etherum.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ethereum
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/quorum.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JP Morgans Quorum
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3_6" >
        
          
          <label class="md-nav__link" for="__nav_8_3_6" id="__nav_8_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3_6_1" >
        
          
          <label class="md-nav__link" for="__nav_8_3_6_1" id="__nav_8_3_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ethereum
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_3_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ethereum
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3_6_1_1" >
        
          
          <label class="md-nav__link" for="__nav_8_3_6_1_1" id="__nav_8_3_6_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Smart contract
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_8_3_6_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3_6_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Smart contract
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3_6_1_1_1" >
        
          
          <label class="md-nav__link" for="__nav_8_3_6_1_1_1" id="__nav_8_3_6_1_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nft
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_8_3_6_1_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3_6_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nft
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/examples/ethereum/smart_contract/nft/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Make NFT Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3_6_1_1_2" >
        
          
          <label class="md-nav__link" for="__nav_8_3_6_1_1_2" id="__nav_8_3_6_1_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Yuqi coin
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_8_3_6_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3_6_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Yuqi coin
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/examples/ethereum/smart_contract/yuqi_coin/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YuqiCoin Demo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3_6_2" >
        
          
          <label class="md-nav__link" for="__nav_8_3_6_2" id="__nav_8_3_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tcn
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_3_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tcn
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/blockchain/examples/tcn/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tokenized Collateral Network - DvP Trading Simulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Message queue
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Message queue
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/message_queue/dpdk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Plane Development Kit (DPDK)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/message_queue/dpdk_apis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Useful DPDK APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/message_queue/dpdk_udp_epoll.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Plane Development Kit (DPDK), UDP and EPoll
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/message_queue/kafka.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/message_queue/message_queue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Message Queue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/message_queue/packet_transmission_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TCP/UDP Packet Treansmission Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/message_queue/zero_mq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Example Framework: ZeroMQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" >
        
          
          <label class="md-nav__link" for="__nav_8_5" id="__nav_8_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Multi media
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Multi media
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/multi-media/hologram.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hologram
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/multi-media/mp4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Video and Audio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_6" >
        
          
          <label class="md-nav__link" for="__nav_8_6" id="__nav_8_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/access_mgt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/authentication.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/common_hacks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cyber Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/ssh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSH (Secure Shell)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/terminologies.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Terminologies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_6_6" >
        
          
          <label class="md-nav__link" for="__nav_8_6_6" id="__nav_8_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Certs and keys
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Certs and keys
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/certs_and_keys/certificate.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Certificate
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/certs_and_keys/certificate_gen_walkthrough.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cert generation example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/certs_and_keys/diff_file_extensions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Different File Extensions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/security/certs_and_keys/secure_tunneling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Secure Tunneling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_7" >
        
          
          <label class="md-nav__link" for="__nav_8_7" id="__nav_8_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Server
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Server
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/server/server_softwares.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Server Softwares
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/server/social_app_server.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Considerations about A Social App Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/server/web_concepts_and_software.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Web Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_8" >
        
          
          <label class="md-nav__link" for="__nav_8_8" id="__nav_8_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tcpip
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tcpip
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/tcpip/data_communication.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Communication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/tcpip/tcp_packet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TCP/IP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/tcpip/udp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    User Datagram Protocol (UDP)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/tcpip/websocket.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Websocket
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_9" >
        
          
          <label class="md-nav__link" for="__nav_8_9" id="__nav_8_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Web crawling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web crawling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/web_crawling/web_crawling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web Crawling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cpp
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cpp
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/asm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ASM (Assembly)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_2" >
        
          
          <label class="md-nav__link" for="__nav_9_1_2" id="__nav_9_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Async and threading
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Async and threading
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/cache_sharing_coherence.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CPU Cache Sharing Coherence and Memory Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/coroutine.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coroutine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/coroutine_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coroutine Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/multi_threads_and_procs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi Threads and Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/mutex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mutex Under the Hood
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/remote_procedure_call.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Remote Procedure Call (RPC)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/semaphore.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semaphore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_2_8" >
        
          
          <label class="md-nav__link" for="__nav_9_1_2_8" id="__nav_9_1_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concurrency
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concurrency
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/concurrency/async.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Async
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/concurrency/concurrency.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concurrency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/async_and_threading/concurrency/hardware_concurrency.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thread Hardware Concurrency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_3" >
        
          
          <label class="md-nav__link" for="__nav_9_1_3" id="__nav_9_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ctor dtor gc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ctor dtor gc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/RAII.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resource Acquisition Is Initialization (RAII)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/ctor_dtor_gc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Garbage Collection, Constructor and Destructor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/five_ctors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Constructor Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/global_objs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Global Objects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/initialization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Initialization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/virtual_methods.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Virtual functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/virtual_perf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Virtual Method Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ctor_dtor_gc/virtual_tbl_and_inheritance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Virtual Table and Inheritance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_4" >
        
          
          <label class="md-nav__link" for="__nav_9_1_4" id="__nav_9_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Meta programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Meta programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/cast.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cast and conversion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/conccept_and_requires.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concept and Requires (since C++20)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/crtp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Curiously Recurring Template Pattern (CRTP)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/meta_programming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Meta Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/overload_override_overwrite.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    overload, override, overwrite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/preprocessing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preprocessing work
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/sfinae.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Substitution Failure Is Not An Error (SFINAE)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/meta_programming/template_deduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Template
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_5" >
        
          
          <label class="md-nav__link" for="__nav_9_1_5" id="__nav_9_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/compilation_flags.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Compilation Flags
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/const.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Const
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/cpp_misc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some C++ Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/cpp_misc_adv.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some C++ Advanced Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/exception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exception handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/personal_difficult_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Personal Encountered Difficult Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/practice_tips.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Practice Tips
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_5_9" >
        
          
          <label class="md-nav__link" for="__nav_9_1_5_9" id="__nav_9_1_5_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Debug
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_5_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Debug
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/debug/debug.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debug
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_5_10" >
        
          
          <label class="md-nav__link" for="__nav_9_1_5_10" id="__nav_9_1_5_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sdk making
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sdk making
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/sdk_making/make_sdk.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Make a c++ SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_5_11" >
        
          
          <label class="md-nav__link" for="__nav_9_1_5_11" id="__nav_9_1_5_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_5_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/testing/google_benchmark.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Benchmark
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/misc/testing/google_test.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GoogleTest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_6" >
        
          
          <label class="md-nav__link" for="__nav_9_1_6" id="__nav_9_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Optimization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Optimization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/branch_prediction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Branch Prediction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/compiler_optimization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/cpu_affinity_isolcpu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Processor Affinity and CPU Isolation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/instrusive.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intrusive and non-intrusive containers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common optimization practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/simd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SIMD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_6_7" >
        
          
          <label class="md-nav__link" for="__nav_9_1_6_7" id="__nav_9_1_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cuda
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_6_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cuda
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/cuda/cuda.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CUDA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/cuda/cuda_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CUDA practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/cuda/gemm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GEMM (General Matrix Multiplication)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_6_8" >
        
          
          <label class="md-nav__link" for="__nav_9_1_6_8" id="__nav_9_1_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Memory
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Memory
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/memory/allocator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Allocator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/memory/atomicity.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Atomicity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/memory/cache.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/memory/memory_things.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Something About Memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/memory/shared_mem_for_ipc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shared Memory for Inter-Process Communication (IPC)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_6_9" >
        
          
          <label class="md-nav__link" for="__nav_9_1_6_9" id="__nav_9_1_6_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Thread pool
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_6_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_6_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Thread pool
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/thread_pool/thread_pool.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thread Pool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_6_10" >
        
          
          <label class="md-nav__link" for="__nav_9_1_6_10" id="__nav_9_1_6_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vtune profiling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_1_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_6_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vtune profiling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/optimization/vtune_profiling/vtune_profiling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VTune
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_7" >
        
          
          <label class="md-nav__link" for="__nav_9_1_7" id="__nav_9_1_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ref and ptr
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ref and ptr
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ref_and_ptr/lvalue_rvalue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rvalue vs Lvalue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ref_and_ptr/lvalue_rvalue_performance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lvalue vs Rvalue Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ref_and_ptr/pointer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pointers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ref_and_ptr/reference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/ref_and_ptr/smart_ptr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Smart Pointer's Realization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1_8" >
        
          
          <label class="md-nav__link" for="__nav_9_1_8" id="__nav_9_1_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stl
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stl
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/stl/algo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    STL Algo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/stl/conditional.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Conditional
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/stl/container.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    STL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/stl/ptr_and_ref.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    STL Pointer and Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/cpp/stl/thread_safety.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    STL Thread Safety
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Java
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Java
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/containers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Primitives and Containers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/java_advanced.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Advanced JAVA Topics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/java_oop.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java OOP (Object Oriented Programming)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/java_useful_pkgs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Useful Packages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/jvm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Virtual Machine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/maven.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maven
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/mq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MQ (Message Queue)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/multi_threading.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Concurrency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2_10" >
        
          
          <label class="md-nav__link" for="__nav_9_2_10" id="__nav_9_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Java related languages
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Java related languages
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/java_related_languages/gradle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gradle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/java_related_languages/groovy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Groovy Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/java_related_languages/kotlin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kotlin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/java_related_languages/scala.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scala
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2_11" >
        
          
          <label class="md-nav__link" for="__nav_9_2_11" id="__nav_9_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Obj oriented programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Obj oriented programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/obj_oriented_programming/OOP_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Some Basic OOP Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/obj_oriented_programming/design_pattern.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Something about Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2_12" >
        
          
          <label class="md-nav__link" for="__nav_9_2_12" id="__nav_9_2_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Servlet
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Servlet
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/servlet/rest_api.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/servlet/servlet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Servlet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/servlet/tomcat.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tomcat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/servlet/tomcat_and_servlet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tomcat and Servlet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2_13" >
        
          
          <label class="md-nav__link" for="__nav_9_2_13" id="__nav_9_2_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Spring
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Spring
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/spring/api_mgt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Hosting For External Use
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/spring/dao.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DAO (Data Access Object)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/spring/spring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/spring/spring_enterprise_project_arch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spring Enterprise Project Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/spring/spring_mvc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spring MVC Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/java/spring/spring_performance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spring Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3" id="__nav_9_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Js
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Js
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/build_tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JS Frontend Build and Development Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/css.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cascading Style Sheets (CSS)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/js.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaScript
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3_4" >
        
          
          <label class="md-nav__link" for="__nav_9_3_4" id="__nav_9_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    App
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    App
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/app/app.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    APP Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_9_3_4_2" id="__nav_9_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Android
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Android
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/app/android/android.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Very Basic Android Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3_4_3" id="__nav_9_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Uni app
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Uni app
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/app/uni_app/uni_app.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Uni App
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3_5" >
        
          
          <label class="md-nav__link" for="__nav_9_3_5" id="__nav_9_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    React
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    React
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/react/react.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    React
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/react/react_interview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Typical React Interview Questions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/react/react_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    React Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3_6" >
        
          
          <label class="md-nav__link" for="__nav_9_3_6" id="__nav_9_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vue
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vue
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/vue/vue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/js/vue/vue_adv.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Vue Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4" >
        
          
          <label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/cpp_to_python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C++ Code Be Used For Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/multi_threading_and_processing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Multi Threading and Multiprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/python_adv.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Advanced Usage/Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/python_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/python_interpreter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Interpreters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/python_mem_obj_gc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Memory Investigation, Object Management, and Garbage Collection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/python_software_dev.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Software Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8" id="__nav_9_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ai
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ai
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/ai_dev_concerns.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python for AI Server Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/pandas_and_numpy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Numpy and Pandas practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_3" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_3" id="__nav_9_4_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_4_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/agent/agent.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Agent Development Beginner Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_3_2" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_3_2" id="__nav_9_4_8_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_9_4_8_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/agent/examples/checkin_agent_demo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Checkin App Agent Demo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_3_2_2" id="__nav_9_4_8_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Skill example gog 1.0.0
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_9_4_8_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Skill example gog 1.0.0
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/agent/examples/skill-example-gog-1.0.0/SKILL.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    gog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_4" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_4" id="__nav_9_4_8_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Comfy ui
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_4_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Comfy ui
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/comfy_ui/audio_video_sync_workflow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ComfyUI Audio &amp; Video Lip Sync Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/comfy_ui/comfy_ui.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comfy UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/comfy_ui/comfy_ui_audio.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comfy UI Audio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/comfy_ui/comfy_ui_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comfy ui practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_5" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_5" id="__nav_9_4_8_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Lang chain
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_4_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Lang chain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/lang_chain/lang_chain_agent_implementation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangChain Agent Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/lang_chain/lang_chain_basics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangChain Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/lang_chain/langfuse_monitoring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Langfuse monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_6" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_6" id="__nav_9_4_8_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Llm server
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_4_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Llm server
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/llm_server/vllm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Hosting by VLLM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_7" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_7" id="__nav_9_4_8_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Pytorch
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_4_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Pytorch
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/pytorch/cuda.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cuda with python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/pytorch/dp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pytorch (Distributed) Data Parallel (DDP)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/pytorch/pytorch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PyTorch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_8_8" >
        
          
          <label class="md-nav__link" for="__nav_9_4_8_8" id="__nav_9_4_8_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Spacy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_9_4_8_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_8_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Spacy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/ai/spacy/spacy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spacy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_9" >
        
          
          <label class="md-nav__link" for="__nav_9_4_9" id="__nav_9_4_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Server
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Server
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/server/fastapi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fast API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../programming/python/server/webserver.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Webserver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#compile-and-launch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compile and Launch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compile and Launch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-pose_graph-4-process-has-died-and-feature_tracker-2-process-has-died" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error [pose_graph-4] process has died and [feature_tracker-2] process has died
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overall-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overall Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overall Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-main-work-in-processimu" class="md-nav__link">
    <span class="md-ellipsis">
      
        The main work in processIMU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-main-work-in-processimage" class="md-nav__link">
    <span class="md-ellipsis">
      
        The main work in processImage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimized-parameter-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimized Parameter Mapping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visual-initial-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual Initial Alignment
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#marginalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Marginalization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Marginalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marginalization-residuals-and-jacobians" class="md-nav__link">
    <span class="md-ellipsis">
      
        Marginalization Residuals and Jacobians
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-marginalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Marginalization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute-marginalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compute Marginalization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imu" class="md-nav__link">
    <span class="md-ellipsis">
      
        IMU
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IMU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imu-noise-and-covariance-propogation" class="md-nav__link">
    <span class="md-ellipsis">
      
        IMU Noise and Covariance Propogation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imu-residuals-and-jacobians" class="md-nav__link">
    <span class="md-ellipsis">
      
        IMU Residuals and Jacobians
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reprojection-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reprojection Error
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feature-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feature Tracking
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feature Tracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#brief-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        BRIEF Features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-publish" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feature Publish
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pose-graph-and-loop-closure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pose Graph and Loop Closure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pose Graph and Loop Closure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-visulization-and-buffer-storage-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Visulization and Buffer Storage Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relocalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relocalization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-closure-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loop Closure Detection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-closure-correction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loop Closure Correction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-pose-graph-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Pose Graph Optimization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="vins-slam-source-code-review">VINS SLAM Source Code Review</h1>
<h2 id="compile-and-launch">Compile and Launch</h2>
<h3 id="error-pose_graph-4-process-has-died-and-feature_tracker-2-process-has-died">Error <code>[pose_graph-4] process has died</code> and <code>[feature_tracker-2] process has died</code></h3>
<p>Error <code>[pose_graph-4] process has died</code> and <code>[feature_tracker-2] process has died</code> may occur after running <code>roslaunch vins_estimator euroc.launch</code>.
The root cause is <code>cv_bridge</code> having a wrong version.</p>
<p><code>cv_bridge</code> is used to convert between ros images and OpenCV images.</p>
<p>First, prepare <code>OpenCV 3.4</code> by <code>git checkout 3.4</code>, and compile the 3.4 version OpenCV.</p>
<p>In Ubuntu20.04, go to <code>/opt/ros/noetic/share/cv_bridge/cmake/</code> and edit the config <code>sudo gedit cv_bridgeConfig.cmake</code>, changing the relevant OpenCV uses to using 3.4 version.
In detail, there are</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># if(NOT &quot;include;/usr/include/opencv4 &quot; STREQUAL &quot; &quot;)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">if</span><span class="o">(</span>NOT<span class="w"> </span><span class="s2">&quot;include;/home/yuqi/code/code/opencv/include/opencv&quot;</span><span class="w"> </span>STREQUAL<span class="w"> </span><span class="s2">&quot; &quot;</span><span class="o">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>...
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1">#  set(_include_dirs &quot;include;/usr/include/opencv4&quot;)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">   </span>set<span class="o">(</span>_include_dirs<span class="w"> </span><span class="s2">&quot;include;/home/yuqi/code/code/opencv/include/opencv&quot;</span><span class="o">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>...
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c1"># set(libraries &quot;cv_bridge;/usr/lib/x86_64-linux-gnu/libopencv_calib3d.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_dnn.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_features2d.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_flann.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_highgui.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_ml.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_objdetect.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_photo.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_stitching.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_video.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_videoio.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_aruco.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_bgsegm.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_bioinspired.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_ccalib.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_datasets.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_dnn_objdetect.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_dnn_superres.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_dpm.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_face.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_freetype.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_fuzzy.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_hdf.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_hfs.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_img_hash.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_line_descriptor.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_optflow.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_phase_unwrapping.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_plot.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_quality.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_reg.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_rgbd.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_saliency.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_shape.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_stereo.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_structured_light.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_superres.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_surface_matching.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_text.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_tracking.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_videostab.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_viz.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_ximgproc.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_xobjdetect.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_xphoto.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_core.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_imgproc.so.4.2.0;/usr/lib/x86_64-linux-gnu/libopencv_imgcodecs.so.4.2.0&quot;)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>set<span class="o">(</span>libraries<span class="w"> </span><span class="s2">&quot;cv_bridge;/home/yuqi/code/code/opencv/build/lib/libopencv_calib3d.so.3.4;/home/yuqi/code/code/opencv/build/lib/libopencv_imgproc.so.3.4;/home/yuqi/code/code/opencv/build/lib/libopencv_core.so.3.4;/home/yuqi/code/code/opencv/build/lib/libopencv_highgui.so.3.4;&quot;</span><span class="o">)</span>
</code></pre></div>
<h2 id="overall-structure">Overall Structure</h2>
<p>Start from <code>estimator_node</code>, VINS first registers publishing/listening messages, then processes IMU and image data in a loop.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vins_estimator&quot;</span><span class="p">);</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">);</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">registerPub</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_imu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">IMU_TOPIC</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">imu_callback</span><span class="p">,</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">TransportHints</span><span class="p">().</span><span class="n">tcpNoDelay</span><span class="p">());</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/feature_tracker/feature&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">feature_callback</span><span class="p">);</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_restart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/feature_tracker/restart&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">restart_callback</span><span class="p">);</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_relo_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/pose_graph/match_points&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">relocalization_callback</span><span class="p">);</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">measurement_process</span><span class="p">{</span><span class="n">process</span><span class="p">};</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="c1">// ros::spin() will not return until the node has been shutdown, either through a call to ros::shutdown() or a Ctrl-C.</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="p">}</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="kt">void</span><span class="w"> </span><span class="nf">registerPub</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="p">{</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">    </span><span class="n">pub_latest_odometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;imu_propagate&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span><span class="n">pub_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Path</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span><span class="n">pub_relo_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Path</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;relocalization_path&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="n">pub_odometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;odometry&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">    </span><span class="n">pub_point_cloud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;point_cloud&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">    </span><span class="n">pub_margin_cloud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;history_cloud&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span><span class="n">pub_key_poses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">Marker</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;key_poses&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span><span class="n">pub_camera_pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;camera_pose&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">    </span><span class="n">pub_camera_pose_visual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">MarkerArray</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;camera_pose_visual&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">    </span><span class="n">pub_keyframe_pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;keyframe_pose&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">    </span><span class="n">pub_keyframe_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;keyframe_point&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span><span class="n">pub_extrinsic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;extrinsic&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">    </span><span class="n">pub_relo_relative_pose</span><span class="o">=</span><span class="w">  </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;relo_relative_pose&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span><span class="n">cameraposevisual</span><span class="p">.</span><span class="n">setScale</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">    </span><span class="n">cameraposevisual</span><span class="p">.</span><span class="n">setLineWidth</span><span class="p">(</span><span class="mf">0.05</span><span class="p">);</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span><span class="n">keyframebasevisual</span><span class="p">.</span><span class="n">setScale</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">    </span><span class="n">keyframebasevisual</span><span class="p">.</span><span class="n">setLineWidth</span><span class="p">(</span><span class="mf">0.01</span><span class="p">);</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="p">}</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="c1">// thread: visual-inertial odometry</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="kt">void</span><span class="w"> </span><span class="nf">process</span><span class="p">()</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="p">{</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImuConstPtr</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloudConstPtr</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">measurements</span><span class="p">;</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">measurement</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">measurements</span><span class="p">)</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">        </span><span class="p">{</span><span class="w">    </span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="w">            </span><span class="c1">// measurement.first is the IMU data</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">imu_msg</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">measurement</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="w">                </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="w">                </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="w">                </span><span class="n">dz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="w">                </span><span class="n">rx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="w">                </span><span class="n">ry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="w">                </span><span class="n">rz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="w">                </span><span class="n">estimator</span><span class="p">.</span><span class="n">processIMU</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="p">,</span><span class="w"> </span><span class="n">dz</span><span class="p">),</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">ry</span><span class="p">,</span><span class="w"> </span><span class="n">rz</span><span class="p">));</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">            </span><span class="c1">// measurement.second is the Image feature point data</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">img_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measurement</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="w">            </span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">image</span><span class="p">;</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">feature_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">NUM_OF_CAM</span><span class="p">;</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">camera_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">NUM_OF_CAM</span><span class="p">;</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">p_u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">p_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">velocity_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">velocity_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a><span class="w">                </span><span class="n">ROS_ASSERT</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="w">                </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">xyz_uv_velocity</span><span class="p">;</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a><span class="w">                </span><span class="n">xyz_uv_velocity</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">p_u</span><span class="p">,</span><span class="w"> </span><span class="n">p_v</span><span class="p">,</span><span class="w"> </span><span class="n">velocity_x</span><span class="p">,</span><span class="w"> </span><span class="n">velocity_y</span><span class="p">;</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a><span class="w">                </span><span class="n">image</span><span class="p">[</span><span class="n">feature_id</span><span class="p">].</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">camera_id</span><span class="p">,</span><span class="w">  </span><span class="n">xyz_uv_velocity</span><span class="p">);</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="w">            </span><span class="n">estimator</span><span class="p">.</span><span class="n">processImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">);</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a><span class="w">            </span><span class="c1">// after loading and processing data, publish them</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="w">            </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Header</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">;</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a><span class="w">            </span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;world&quot;</span><span class="p">;</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a><span class="w">            </span><span class="n">pubOdometry</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="p">);</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a><span class="w">            </span><span class="n">pubKeyPoses</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="p">);</span>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="w">            </span><span class="n">pubCameraPose</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="p">);</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a><span class="w">            </span><span class="n">pubPointCloud</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="p">);</span>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a><span class="w">            </span><span class="n">pubTF</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="p">);</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a><span class="w">            </span><span class="n">pubKeyframe</span><span class="p">(</span><span class="n">estimator</span><span class="p">);</span>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a><span class="p">}</span>
</code></pre></div>
<h3 id="the-main-work-in-processimu">The main work in <code>processIMU</code></h3>
<p><code>processIMU</code> describes how pre-integration takes into account of IMU data to a corresponding frame.</p>
<p><code>Bas</code> <span class="arithmatex">\(\mathbf{b}_a\)</span> and <code>Bgs</code> <span class="arithmatex">\(\mathbf{b}_g\)</span> are pre-computed biases from IMU pre-integration.
They are used as assumed noises to be subtracted from the computed rotation/orientation <code>Rs[j]</code> <span class="arithmatex">\(\mathbf{R}_j\)</span>, position <code>Ps[j]</code> <span class="arithmatex">\(\mathbf{p}_j\)</span> and velocity <code>Vs[j]</code> <span class="arithmatex">\(\mathbf{v}_j\)</span></p>
<p>From each IMU reading obatin linear acceleration <code>linear_acceleration</code> <span class="arithmatex">\(\hat{\mathbf{a}}_{t}\)</span> and angular acceleration <code>angular_velocity</code> <span class="arithmatex">\(\hat{\mathbf{\omega}}_{t}\)</span>, then compute <code>Rs[j]</code> <span class="arithmatex">\(\mathbf{R}_j\)</span>, <code>Ps[j]</code> <span class="arithmatex">\(\mathbf{p}_j\)</span> and <code>Vs[j]</code> <span class="arithmatex">\(\mathbf{v}_j\)</span>.</p>
<p><span class="arithmatex">\(\mathbf{a}_{t} = \frac{1}{2} (\hat{\mathbf{a}}_{t,t-1} + \hat{\mathbf{a}}_{t,t})\)</span> assumes linear interpolation, 
that acceleration is transformed/rotated linearly between <span class="arithmatex">\(\mathbf{R}_{j, t-1}\)</span> and <span class="arithmatex">\(\mathbf{R}_{j, t}\)</span>.</p>
<div class="arithmatex">\[
\begin{align*}
\hat{\mathbf{a}}_{t, t-1} &amp;= \mathbf{R}_{j, t-1} (\mathbf{a}_{t-1} - \mathbf{b}_a) - \mathbf{g}_{earth} \\\\
{\mathbf{\omega}}_{t} &amp;= \frac{1}{2} (\mathbf{\omega}_{t-1} + \hat{\mathbf{\omega}}_{t}) - \mathbf{b}_\omega \\\\
{\mathbf{R}}_{j, t} &amp;= \mathbf{R}_{j, t-1} \cdot ({\mathbf{\omega}}_{t} \cdot \delta t)^\wedge \\\\
\hat{\mathbf{a}}_{t,t} &amp;= {\mathbf{R}}_{j, t} (\hat{\mathbf{a}}_{t} - \mathbf{b}_a) - \mathbf{g}_{earth} \\\\
\mathbf{a}_{t} &amp;= \frac{1}{2} (\hat{\mathbf{a}}_{t,t-1} + \hat{\mathbf{a}}_{t,t}) \\\\
\mathbf{p}_{j, t} &amp;= \mathbf{p}_{j, t-1} + \mathbf{v}_{j, t-1} \cdot \delta t + \frac{1}{2} \mathbf{a}_{t} (\delta t)^2 \\\\
\mathbf{v}_{j, t} &amp;= \mathbf{v}_{j, t-1} + \mathbf{a}_{j, t} \cdot \delta t 
\end{align*}
\]</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Estimator</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Ps</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"> </span><span class="c1">// position</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Vs</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"> </span><span class="c1">// velocity</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">Rs</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"> </span><span class="c1">// angle/orientation</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Bas</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"> </span><span class="c1">// acceleration bias</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Bgs</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"> </span><span class="c1">// gyro/rotation bias</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="n">IntegrationBase</span><span class="w"> </span><span class="o">*</span><span class="n">pre_integrations</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">acc_0</span><span class="p">,</span><span class="w"> </span><span class="n">gyr_0</span><span class="p">;</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt_buf</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3d</span><span class="o">&gt;</span><span class="w"> </span><span class="n">linear_acceleration_buf</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3d</span><span class="o">&gt;</span><span class="w"> </span><span class="n">angular_velocity_buf</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="p">}</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="kt">void</span><span class="w"> </span><span class="n">Estimator</span><span class="o">::</span><span class="n">processIMU</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linear_acceleration</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">angular_velocity</span><span class="p">)</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="p">{</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="c1">// push_back to store imu readings</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="n">pre_integrations</span><span class="p">[</span><span class="n">frame_count</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">linear_acceleration</span><span class="p">,</span><span class="w"> </span><span class="n">angular_velocity</span><span class="p">);</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">    </span><span class="n">tmp_pre_integration</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">linear_acceleration</span><span class="p">,</span><span class="w"> </span><span class="n">angular_velocity</span><span class="p">);</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="n">dt_buf</span><span class="p">[</span><span class="n">frame_count</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">dt</span><span class="p">);</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">    </span><span class="n">linear_acceleration_buf</span><span class="p">[</span><span class="n">frame_count</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">linear_acceleration</span><span class="p">);</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">    </span><span class="n">angular_velocity_buf</span><span class="p">[</span><span class="n">frame_count</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">angular_velocity</span><span class="p">);</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">    </span><span class="c1">// use the obtained imu linear acc and angular acc to compute `Rs`, `Ps` and `Vs`</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">    </span><span class="c1">// update `acc_0` and `gyr_0` to using the crrent time imu reading</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_count</span><span class="p">;</span><span class="w">         </span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_acc_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">acc_0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">g</span><span class="p">;</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_gyr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">gyr_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">angular_velocity</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bgs</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">    </span><span class="n">Rs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">deltaQ</span><span class="p">(</span><span class="n">un_gyr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="p">).</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_acc_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">linear_acceleration</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">g</span><span class="p">;</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">un_acc_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">un_acc_1</span><span class="p">);</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">    </span><span class="n">Ps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Vs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">un_acc</span><span class="p">;</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">    </span><span class="n">Vs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">un_acc</span><span class="p">;</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">    </span><span class="n">acc_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linear_acceleration</span><span class="p">;</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">    </span><span class="n">gyr_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angular_velocity</span><span class="p">;</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="p">}</span>
</code></pre></div>
<h3 id="the-main-work-in-processimage">The main work in <code>processImage</code></h3>
<p>In previous <code>process</code>, each image feature id is defined with 3d position <code>xyz</code>, image pixel location <code>uv</code> and its <code>velocity</code>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">img_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measurement</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">img_msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="n">xyz_uv_velocity</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">p_u</span><span class="p">,</span><span class="w"> </span><span class="n">p_v</span><span class="p">,</span><span class="w"> </span><span class="n">velocity_x</span><span class="p">,</span><span class="w"> </span><span class="n">velocity_y</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="n">image</span><span class="p">[</span><span class="n">feature_id</span><span class="p">].</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">camera_id</span><span class="p">,</span><span class="w">  </span><span class="n">xyz_uv_velocity</span><span class="p">);</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">}</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="n">estimator</span><span class="p">.</span><span class="n">processImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">);</span>
</code></pre></div></p>
<p>Inside <code>processImage</code>, first decide which frame to remove in marginalization to maintain the sliding window size: the oldest frame or the previous frame just before the current input image frame by <code>addFeatureCheckParallax</code>, and the criteria is the degree of mean parallax:
* large parallax indicates significant camera movement, the recent image frames should be kept, and the old frame should be marginalized out
* small parallax indicates insignificant camera movement, the recent image frames are similar to each other, and the recent second image frame should be marginalized out</p>
<p><code>initialStructure</code> computes the transform between each camera frame and globally the position of 3d feature points</p>
<p><code>solveOdometry</code> triangulates image pixels to estimate the depth of the 3d features.
Then, run optimization for the below variables and perform marginalization to remove camera frames
* IMU poses and speeds in a sliding window
* Camera poses
* Time offset between IMU and camera reading time</p>
<p><code>slideWindow</code> moves the sliding window forward one frame, with action inclduing updating pointers and disassociate 3d features.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Estimator::processImage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Header</span><span class="w"> </span><span class="o">&amp;</span><span class="n">header</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="c1">// parallax checking returns true when</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="c1">// frame_count &lt; 2: sliding window has no or just one frame</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="c1">// last_track_num &lt; 20: too few feature points shared between this input image and those recorded in this window, </span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="c1">//     indicating this image has rich new features (possibly entered into a new scene)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="c1">// parallax_num == 0: no shared feature points between this input image and last two frames</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="c1">// parallax_sum / parallax_num &gt;= MIN_PARALLAX: through `parallax_sum += compensatedParallax2(it_per_id, frame_count);`,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="c1">//     compute mean parallax; `compensatedParallax2` takes feature points from the second last image and the third last </span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="c1">//     image, and compute the parallax difference;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="c1">//     large `parallax_sum` means the second last image and the third last image have somewahr big translation/rotation in between</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f_manager</span><span class="p">.</span><span class="n">addFeatureCheckParallax</span><span class="p">(</span><span class="n">frame_count</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">td</span><span class="p">))</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">        </span><span class="n">marginalization_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MARGIN_OLD</span><span class="p">;</span><span class="w"> </span><span class="c1">// remove the oldest frame in marginalization</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">        </span><span class="n">marginalization_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MARGIN_SECOND_NEW</span><span class="p">;</span><span class="w"> </span><span class="c1">// remove the second new frame in marginalization</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">    </span><span class="c1">// 1. from image frames take each frame associated pre-integration&#39;s acceleration, </span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">    </span><span class="c1">//    and compute the acceleration variation, </span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="c1">//    if too small, IMU sees little movements</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">    </span><span class="c1">// 2. for every feature, associate it in all image frames, </span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">    </span><span class="c1">//    where this feature is located in the image pixel (u,v)</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="c1">//    in other words, track this feature how it moves across consecutive images having observed this feature</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">    </span><span class="c1">// 3. `relativePose(relative_R, relative_T, l)` finds the transform between the image frames within a sliding window</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">    </span><span class="c1">//    then compute the mean parallax for each of the transforms (parallax is just the norm of the diff between two corresponding points),</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">    </span><span class="c1">//    until found two frames with parallax large enough (camera has moved a great distance) for SFM</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">    </span><span class="c1">// 4. `sfm.construct(...)` takes the above estimated `relative_R, relative_T` as the initial guesses and solve PnP </span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="c1">//    for the 3d representations of 2d points for all image frames in the sliding window.</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">    </span><span class="c1">//    Combined, the 3d features are stored in `sfm_tracked_points`</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">    </span><span class="c1">// 5. With the obatined 3d features, again perform PnP for all 3d features `sfm_tracked_points` against their 2d image pixels, and found rotation and translation of all frames in the sliding window</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">    </span><span class="c1">// 6. Finally, `visualInitialAlign()` is performed to adjust IMU pre-integration result to be aligned in time with the computed 3d features</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialStructure</span><span class="p">();</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">        </span><span class="n">solver_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NON_LINEAR</span><span class="p">;</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">        </span><span class="c1">// 1. `f_manager.triangulate(Ps, tic, ric)` finds the depth of a 3d feature </span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">        </span><span class="c1">//    by `it_per_id-&gt;estimated_depth = svd_V[2] / svd_V[3]`</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">        </span><span class="c1">// 2. `optimization()` optimizes</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">        </span><span class="c1">//    * IMU poses and speeds in a sliding window</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">        </span><span class="c1">//    * Camera poses</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">        </span><span class="c1">//    * Time offset between IMU and camera reading time</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">        </span><span class="c1">//    after having finished optimization, compute marginalization</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">        </span><span class="n">solveOdometry</span><span class="p">();</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="w">        </span><span class="c1">// depending on the flag `marginalization_flag`,</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="w">        </span><span class="c1">// remove the oldest frame or the most recent second frame, content including some pointer moving/updating and disassociate features from the to-be-removed frame</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="w">        </span><span class="n">slideWindow</span><span class="p">();</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="w">        </span><span class="n">f_manager</span><span class="p">.</span><span class="n">removeFailures</span><span class="p">();</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="w">        </span><span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Initialization finish!&quot;</span><span class="p">);</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="w">        </span><span class="n">last_R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="p">];</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="w">        </span><span class="n">last_P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ps</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="p">];</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="w">        </span><span class="n">last_R0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="w">        </span><span class="n">last_P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ps</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="w">        </span><span class="n">slideWindow</span><span class="p">();</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="p">}</span>
</code></pre></div>
<h2 id="optimization">Optimization</h2>
<p>Recall in VINS that the objective constains three items:</p>
<div class="arithmatex">\[
\min_{\mathbf{\mathcal{X}}}
\underbrace{\big|\big|
    \mathbf{r}_p - H_p \mathbf{\mathcal{X}}
\big|\big|^2}_{
\text{Marginalization residuals}}
+
\underbrace{\sum_{k_i \in \mathcal{B}} 
\Big|\Big|
    \mathbf{r}_\mathcal{B} ( \hat{\mathbf{z}}_{\tiny{BK}} ,\mathbf{\mathcal{X}} )
\Big|\Big|^2}_{
\text{IMU measurement residuals}}+ 
\underbrace{\sum_{(j,l) \in \mathcal{C}} 
\rho\Big( \big|\big|
    \mathbf{r}_\mathcal{C} ( \hat{\mathbf{z}}_{\tiny{C_jl}},\mathbf{\mathcal{X}} )
\big|\big|^2 \Big)}_{
\text{Visual measurement residuals}}
\]</div>
<p>where <span class="arithmatex">\(\rho(e)\)</span> is a Huber norm. </p>
<p>Variables <span class="arithmatex">\(\mathcal{X}\)</span> to be optimized (<code>problem.AddParameterBlock</code>):
* IMU poses <code>para_Pose</code> and speeds <code>para_SpeedBias</code> in a sliding window
* Camera poses <code>para_Ex_Pose</code>
* Time offset between IMU and camera reading time <code>para_Td</code> (optional)</p>
<p>Residuals to be reduced (<code>AddResidualBlock</code>):
* Marginalization error (<code>MarginalizationFactor</code>)
* IMU (<code>IMUFactor</code>)
* Visual feature reprojection error (<code>ProjectionFactor</code>)</p>
<p>The above three residual factors are actual ceres' <code>class CostFunction</code> where <code>Evaluate(...)</code> must be defined to compute residuals and Jacobians.</p>
<p>With the above defined residuals, the optimization problem can solved by <code>ceres::Solve(options, &amp;problem, &amp;summary);</code>.</p>
<p>Depending on marganizalition flag: either remove the oldest frame or the second last frame, add and remove different items to/from the sliding window.
* To remove the oldest frame: this means the camera has moved a significant amount of distance, so that need to add new IMU and projection residuals as well as marginalization
* To remove the second last frame: this means the camera does not move a lot, just need to do with marginalization residuals</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Estimator::optimization</span><span class="p">()</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="n">ceres</span><span class="o">::</span><span class="n">Problem</span><span class="w"> </span><span class="n">problem</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="n">ceres</span><span class="o">::</span><span class="n">LossFunction</span><span class="w"> </span><span class="o">*</span><span class="n">loss_function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">CauchyLoss</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="c1">// void Problem::AddParameterBlock(double *values, int size, LocalParameterization *local_parameterization)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">LocalParameterization</span><span class="w"> </span><span class="o">*</span><span class="n">local_parameterization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PoseLocalParameterization</span><span class="p">();</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">AddParameterBlock</span><span class="p">(</span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">SIZE_POSE</span><span class="p">,</span><span class="w"> </span><span class="n">local_parameterization</span><span class="p">);</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">AddParameterBlock</span><span class="p">(</span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">SIZE_SPEEDBIAS</span><span class="p">);</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_OF_CAM</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">LocalParameterization</span><span class="w"> </span><span class="o">*</span><span class="n">local_parameterization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PoseLocalParameterization</span><span class="p">();</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">AddParameterBlock</span><span class="p">(</span><span class="n">para_Ex_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">SIZE_POSE</span><span class="p">,</span><span class="w"> </span><span class="n">local_parameterization</span><span class="p">);</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ESTIMATE_TD</span><span class="p">)</span><span class="w"> </span><span class="c1">// time offset between IMU and camera</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">AddParameterBlock</span><span class="p">(</span><span class="n">para_Td</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">    </span><span class="c1">// ResidualBlockId Problem::AddResidualBlock(CostFunction *cost_function, LossFunction *loss_function, const vector&lt;double*&gt; parameter_blocks)</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">last_marginalization_info</span><span class="p">)</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">        </span><span class="c1">// construct new marginlization_factor</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">        </span><span class="n">MarginalizationFactor</span><span class="w"> </span><span class="o">*</span><span class="n">marginalization_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MarginalizationFactor</span><span class="p">(</span><span class="n">last_marginalization_info</span><span class="p">);</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">AddResidualBlock</span><span class="p">(</span><span class="n">marginalization_factor</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">                                 </span><span class="n">last_marginalization_parameter_blocks</span><span class="p">);</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">WINDOW_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pre_integrations</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">sum_dt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">10.0</span><span class="p">)</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="w">        </span><span class="n">IMUFactor</span><span class="o">*</span><span class="w"> </span><span class="n">imu_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IMUFactor</span><span class="p">(</span><span class="n">pre_integrations</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">AddResidualBlock</span><span class="p">(</span><span class="n">imu_factor</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f_manager</span><span class="p">.</span><span class="n">feature</span><span class="p">)</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_frame</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">)</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="w">            </span><span class="n">ProjectionFactor</span><span class="w"> </span><span class="o">*</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProjectionFactor</span><span class="p">(</span><span class="n">pts_i</span><span class="p">,</span><span class="w"> </span><span class="n">pts_j</span><span class="p">);</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="w">            </span><span class="n">problem</span><span class="p">.</span><span class="n">AddResidualBlock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">loss_function</span><span class="p">,</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">imu_i</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">imu_j</span><span class="p">],</span><span class="w"> </span><span class="n">para_Ex_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">para_Feature</span><span class="p">[</span><span class="n">feature_index</span><span class="p">]);</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">relocalization_info</span><span class="p">)</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">LocalParameterization</span><span class="w"> </span><span class="o">*</span><span class="n">local_parameterization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PoseLocalParameterization</span><span class="p">();</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="w">        </span><span class="n">problem</span><span class="p">.</span><span class="n">AddParameterBlock</span><span class="p">(</span><span class="n">relo_Pose</span><span class="p">,</span><span class="w"> </span><span class="n">SIZE_POSE</span><span class="p">,</span><span class="w"> </span><span class="n">local_parameterization</span><span class="p">);</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f_manager</span><span class="p">.</span><span class="n">feature</span><span class="p">)</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">match_points</span><span class="p">[</span><span class="n">retrive_feature_index</span><span class="p">].</span><span class="n">z</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_id</span><span class="p">)</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="w">                </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">match_points</span><span class="p">[</span><span class="n">retrive_feature_index</span><span class="p">].</span><span class="n">x</span><span class="p">(),</span><span class="w"> </span><span class="n">match_points</span><span class="p">[</span><span class="n">retrive_feature_index</span><span class="p">].</span><span class="n">y</span><span class="p">(),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="w">                </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">point</span><span class="p">;</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="w">                </span><span class="n">ProjectionFactor</span><span class="w"> </span><span class="o">*</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProjectionFactor</span><span class="p">(</span><span class="n">pts_i</span><span class="p">,</span><span class="w"> </span><span class="n">pts_j</span><span class="p">);</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="w">                </span><span class="n">problem</span><span class="p">.</span><span class="n">AddResidualBlock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">loss_function</span><span class="p">,</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">start</span><span class="p">],</span><span class="w"> </span><span class="n">relo_Pose</span><span class="p">,</span><span class="w"> </span><span class="n">para_Ex_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">para_Feature</span><span class="p">[</span><span class="n">feature_index</span><span class="p">]);</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="w">                </span><span class="n">retrive_feature_index</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="w">            </span><span class="p">}</span><span class="w">     </span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a><span class="w">    </span><span class="n">ceres</span><span class="o">::</span><span class="n">Solver</span><span class="o">::</span><span class="n">Options</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">linear_solver_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">DENSE_SCHUR</span><span class="p">;</span>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">trust_region_strategy_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">DOGLEG</span><span class="p">;</span>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">max_num_iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NUM_ITERATIONS</span><span class="p">;</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a><span class="w">    </span><span class="n">ceres</span><span class="o">::</span><span class="n">Solver</span><span class="o">::</span><span class="n">Summary</span><span class="w"> </span><span class="n">summary</span><span class="p">;</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a><span class="w">    </span><span class="n">ceres</span><span class="o">::</span><span class="n">Solve</span><span class="p">(</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">summary</span><span class="p">);</span>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a><span class="w">    </span><span class="c1">// To marginalize out the oldest frame from the sliding window</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marginalization_flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MARGIN_OLD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="w">        </span><span class="n">MarginalizationInfo</span><span class="w"> </span><span class="o">*</span><span class="n">marginalization_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MarginalizationInfo</span><span class="p">();</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a><span class="w">        </span><span class="c1">// `drop_set` push_back the frame with pose at the start of the sliding window</span>
<a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a><span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">drop_set</span><span class="p">;</span>
<a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">last_marginalization_parameter_blocks</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">last_marginalization_parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a><span class="w">                </span><span class="n">last_marginalization_parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a><span class="w">                </span><span class="n">drop_set</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="w">        </span><span class="c1">// construct new marginlization_factor</span>
<a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a><span class="w">        </span><span class="n">MarginalizationFactor</span><span class="w"> </span><span class="o">*</span><span class="n">marginalization_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MarginalizationFactor</span><span class="p">(</span><span class="n">last_marginalization_info</span><span class="p">);</span>
<a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a><span class="w">        </span><span class="n">ResidualBlockInfo</span><span class="w"> </span><span class="o">*</span><span class="n">residual_block_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResidualBlockInfo</span><span class="p">(</span><span class="n">marginalization_factor</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a><span class="w">                                                                       </span><span class="n">last_marginalization_parameter_blocks</span><span class="p">,</span>
<a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a><span class="w">                                                                       </span><span class="n">drop_set</span><span class="p">);</span>
<a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a>
<a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a><span class="w">        </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">addResidualBlockInfo</span><span class="p">(</span><span class="n">residual_block_info</span><span class="p">);</span>
<a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a>
<a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a><span class="w">        </span><span class="c1">// `sum_dt` is the accumulated dt from imu reading, should not be too big, otherwise pre-integration might have a bad approximation</span>
<a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pre_integrations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">sum_dt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10.0</span><span class="p">)</span>
<a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a><span class="w">            </span><span class="n">IMUFactor</span><span class="o">*</span><span class="w"> </span><span class="n">imu_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IMUFactor</span><span class="p">(</span><span class="n">pre_integrations</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a><span class="w">            </span><span class="n">ResidualBlockInfo</span><span class="w"> </span><span class="o">*</span><span class="n">residual_block_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResidualBlockInfo</span><span class="p">(</span><span class="n">imu_factor</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a><span class="w">                                                                       </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">{</span><span class="n">para_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span>
<a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a><span class="w">                                                                       </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>
<a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a><span class="w">            </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">addResidualBlockInfo</span><span class="p">(</span><span class="n">residual_block_info</span><span class="p">);</span>
<a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>
<a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a><span class="w">        </span><span class="c1">// add visual/projection error</span>
<a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f_manager</span><span class="p">.</span><span class="n">feature</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">imu_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">start_frame</span><span class="p">,</span><span class="w"> </span><span class="n">imu_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_frame</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a><span class="w">                </span><span class="n">imu_j</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a><span class="w">                </span><span class="n">ProjectionFactor</span><span class="w"> </span><span class="o">*</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProjectionFactor</span><span class="p">(</span><span class="n">pts_i</span><span class="p">,</span><span class="w"> </span><span class="n">pts_j</span><span class="p">);</span>
<a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a><span class="w">                </span><span class="n">ResidualBlockInfo</span><span class="w"> </span><span class="o">*</span><span class="n">residual_block_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResidualBlockInfo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">loss_function</span><span class="p">,</span>
<a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a><span class="w">                                                                               </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">{</span><span class="n">para_Pose</span><span class="p">[</span><span class="n">imu_i</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">imu_j</span><span class="p">],</span><span class="w"> </span><span class="n">para_Ex_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">para_Feature</span><span class="p">[</span><span class="n">feature_index</span><span class="p">]},</span>
<a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a><span class="w">                                                                               </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">});</span>
<a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a><span class="w">                </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">addResidualBlockInfo</span><span class="p">(</span><span class="n">residual_block_info</span><span class="p">);</span>
<a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>
<a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a><span class="w">        </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">preMarginalize</span><span class="p">();</span>
<a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a><span class="w">        </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">marginalize</span><span class="p">();</span>
<a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>
<a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">addr_shift</span><span class="p">;</span>
<a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">WINDOW_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a><span class="w">            </span><span class="n">addr_shift</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a><span class="w">            </span><span class="n">addr_shift</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a><span class="w">    </span><span class="c1">// To marginalize out the second last frame from the sliding window</span>
<a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a><span class="w">        </span><span class="n">MarginalizationInfo</span><span class="w"> </span><span class="o">*</span><span class="n">marginalization_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MarginalizationInfo</span><span class="p">();</span>
<a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a><span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">drop_set</span><span class="p">;</span>
<a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>
<a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a><span class="w">        </span><span class="c1">// `drop_set` push_back the second last frame from the sliding window</span>
<a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">last_marginalization_parameter_blocks</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a><span class="w">            </span><span class="n">ROS_ASSERT</span><span class="p">(</span><span class="n">last_marginalization_parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">last_marginalization_parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a><span class="w">                </span><span class="n">drop_set</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a><span class="w">        </span><span class="c1">// construct new marginlization_factor</span>
<a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a><span class="w">        </span><span class="n">MarginalizationFactor</span><span class="w"> </span><span class="o">*</span><span class="n">marginalization_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MarginalizationFactor</span><span class="p">(</span><span class="n">last_marginalization_info</span><span class="p">);</span>
<a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a><span class="w">        </span><span class="n">ResidualBlockInfo</span><span class="w"> </span><span class="o">*</span><span class="n">residual_block_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResidualBlockInfo</span><span class="p">(</span><span class="n">marginalization_factor</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a><span class="w">                                                                       </span><span class="n">last_marginalization_parameter_blocks</span><span class="p">,</span>
<a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a><span class="w">                                                                       </span><span class="n">drop_set</span><span class="p">);</span>
<a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>
<a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a><span class="w">        </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">addResidualBlockInfo</span><span class="p">(</span><span class="n">residual_block_info</span><span class="p">);</span>
<a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>
<a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a><span class="w">        </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">preMarginalize</span><span class="p">();</span>
<a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a><span class="w">        </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">marginalize</span><span class="p">();</span>
<a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>
<a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">addr_shift</span><span class="p">;</span>
<a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">WINDOW_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a><span class="w">            </span><span class="n">addr_shift</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a><span class="w">            </span><span class="n">addr_shift</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a>
<a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a><span class="p">}</span>
</code></pre></div>
<p><code>addResidualBlockInfo</code> pushes back <code>ResidualBlockInfo *residual_block_info</code> to <code>factors</code>.
The parameters to be added to marginalization matrix are set in <code>_parameter_blocks</code>, while those to be removed are set in <code>_drop_set</code>.</p>
<p><code>MarginalizationInfo</code> itself is the class that manages adding/removing frames' associated data into/from the sliding window.</p>
<p>The add/remove action is done through mapping, that every parameter <code>double *addr = parameter_blocks[i]</code> is managed by a pointer, translated to an addr by <code>reinterpret_cast&lt;long&gt;(addr)</code> to a <code>long</code>.
This saves the effort to permutate matrix since data blocks are retrived through mapping.</p>
<p>Both <code>parameter_block_size</code> and <code>parameter_block_idx</code> are <code>std::unordered_map&lt;long, int&gt;</code>, in which <code>long</code> as the key is used to represent a pointer addr, and <code>int</code> as the value is the size of a parameter block.
Later in the marginalization process, they will be used to determine which parameter blocks are to kept and which are to be removed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ResidualBlockInfo</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">ResidualBlockInfo</span><span class="p">(</span><span class="n">ceres</span><span class="o">::</span><span class="n">CostFunction</span><span class="w"> </span><span class="o">*</span><span class="n">_cost_function</span><span class="p">,</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">LossFunction</span><span class="w"> </span><span class="o">*</span><span class="n">_loss_function</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">_parameter_blocks</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_drop_set</span><span class="p">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">cost_function</span><span class="p">(</span><span class="n">_cost_function</span><span class="p">),</span><span class="w"> </span><span class="n">loss_function</span><span class="p">(</span><span class="n">_loss_function</span><span class="p">),</span><span class="w"> </span><span class="n">parameter_blocks</span><span class="p">(</span><span class="n">_parameter_blocks</span><span class="p">),</span><span class="w"> </span><span class="n">drop_set</span><span class="p">(</span><span class="n">_drop_set</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Evaluate</span><span class="p">();</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="n">ceres</span><span class="o">::</span><span class="n">CostFunction</span><span class="w"> </span><span class="o">*</span><span class="n">cost_function</span><span class="p">;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="n">ceres</span><span class="o">::</span><span class="n">LossFunction</span><span class="w"> </span><span class="o">*</span><span class="n">loss_function</span><span class="p">;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">parameter_blocks</span><span class="p">;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">drop_set</span><span class="p">;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">raw_jacobians</span><span class="p">;</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Dynamic</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Dynamic</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobians</span><span class="p">;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">residuals</span><span class="p">;</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">localSize</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="p">};</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="kt">void</span><span class="w"> </span><span class="nf">MarginalizationInfo::addResidualBlockInfo</span><span class="p">(</span><span class="n">ResidualBlockInfo</span><span class="w"> </span><span class="o">*</span><span class="n">residual_block_info</span><span class="p">)</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="p">{</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">    </span><span class="n">factors</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">residual_block_info</span><span class="p">);</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">parameter_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residual_block_info</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">;</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameter_block_sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residual_block_info</span><span class="o">-&gt;</span><span class="n">cost_function</span><span class="o">-&gt;</span><span class="n">parameter_block_sizes</span><span class="p">();</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span><span class="c1">// add new parameter_blocks</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">    </span><span class="c1">// set new parameter pointed `parameter_block_size` to the size of one parameter</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">residual_block_info</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameter_block_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">        </span><span class="n">parameter_block_size</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">addr</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">    </span><span class="c1">// remove parameter_blocks</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">    </span><span class="c1">// set the to be dropped set corresponding `parameter_block_idx` to zero</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">residual_block_info</span><span class="o">-&gt;</span><span class="n">drop_set</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">residual_block_info</span><span class="o">-&gt;</span><span class="n">drop_set</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">        </span><span class="n">parameter_block_idx</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">addr</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="p">}</span>
</code></pre></div>
<p>The residuals are of the type <code>ResidualBlockInfo</code>, where <code>cost_function-&gt;Evaluate(parameter_blocks.data(), residuals.data(), raw_jacobians);</code> is defined to compute the residual vector and the Jacobian matrices (known Jacobians can help ceres converge).
If <code>loss_function</code> is defined, residuals are scaled by the loss function.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ResidualBlockInfo::Evaluate</span><span class="p">()</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">        </span><span class="n">jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">resize</span><span class="p">(</span><span class="n">cost_function</span><span class="o">-&gt;</span><span class="n">num_residuals</span><span class="p">(),</span><span class="w"> </span><span class="n">block_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="n">raw_jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">();</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="c1">// bool CostFunction::Evaluate(double const *const *parameters, double *residuals, double **jacobians) const</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="n">cost_function</span><span class="o">-&gt;</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">parameter_blocks</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">residuals</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">raw_jacobians</span><span class="p">);</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loss_function</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">        </span><span class="n">sq_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residuals</span><span class="p">.</span><span class="n">squaredNorm</span><span class="p">();</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">        </span><span class="n">loss_function</span><span class="o">-&gt;</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">sq_norm</span><span class="p">,</span><span class="w"> </span><span class="n">rho</span><span class="p">);</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">parameter_blocks</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">            </span><span class="n">jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_rho1_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha_sq_norm_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">residuals</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">residuals</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="w">        </span><span class="n">residuals</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">residual_scaling_</span><span class="p">;</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="p">}</span>
</code></pre></div>
<h3 id="optimized-parameter-mapping">Optimized Parameter Mapping</h3>
<p><code>para_Pose</code> and <code>para_SpeedBias</code> are the two parameter blocks for ceres that have the below mapping relationship to <code>Rs[j]</code> <span class="arithmatex">\(\mathbf{R}_j\)</span>, <code>Ps[j]</code> <span class="arithmatex">\(\mathbf{p}_j\)</span> and <code>Vs[j]</code> <span class="arithmatex">\(\mathbf{v}_j\)</span> <code>Bas</code> <span class="arithmatex">\(\mathbf{b}_a\)</span> and <code>Bgs</code> <span class="arithmatex">\(\mathbf{b}_g\)</span>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">Rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rot_diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Quaterniond</span><span class="p">(</span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]).</span><span class="n">normalized</span><span class="p">().</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">Ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rot_diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">                        </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">                        </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">origin_P0</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="n">Vs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rot_diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">                            </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">                            </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">Bas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">                  </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">                  </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">Bgs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">                  </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">                  </span><span class="n">para_SpeedBias</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">8</span><span class="p">]);</span>
</code></pre></div>
<h2 id="visual-initial-alignment">Visual Initial Alignment</h2>
<p><code>visualInitialAlign()</code> prepares some initial guesses for <code>para_Pose</code> and <code>para_SpeedBias</code> to be optimized.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">Estimator::visualInitialAlign</span><span class="p">()</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_g</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="n">VectorXd</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VisualIMUAlignment</span><span class="p">(</span><span class="n">all_image_frame</span><span class="p">,</span><span class="w"> </span><span class="n">Bgs</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="c1">// change state</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frame_count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">Ri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">[</span><span class="n">Headers</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">()].</span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">[</span><span class="n">Headers</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">()].</span><span class="n">T</span><span class="p">;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="n">Ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pi</span><span class="p">;</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">        </span><span class="n">Rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ri</span><span class="p">;</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">        </span><span class="n">all_image_frame</span><span class="p">[</span><span class="n">Headers</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">()].</span><span class="n">is_key_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">    </span><span class="n">VectorXd</span><span class="w"> </span><span class="n">dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f_manager</span><span class="p">.</span><span class="n">getDepthVector</span><span class="p">();</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">    </span><span class="n">f_manager</span><span class="p">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">Ps</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">TIC_TMP</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">RIC</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">tail</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">())(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">WINDOW_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">        </span><span class="n">pre_integrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">repropagate</span><span class="p">(</span><span class="n">Vector3d</span><span class="o">::</span><span class="n">Zero</span><span class="p">(),</span><span class="w"> </span><span class="n">Bgs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">        </span><span class="n">Ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">TIC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">TIC</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">kv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">    </span><span class="n">map</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">ImageFrame</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">frame_i</span><span class="p">;</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">frame_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">frame_i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">frame_i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">is_key_frame</span><span class="p">)</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">            </span><span class="n">kv</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">            </span><span class="n">Vs</span><span class="p">[</span><span class="n">kv</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">segment</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f_manager</span><span class="p">.</span><span class="n">feature</span><span class="p">)</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">        </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">used_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">it_per_id</span><span class="p">.</span><span class="n">used_num</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">start_frame</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">WINDOW_SIZE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="w">        </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">estimated_depth</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="w">    </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">g2R</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">R0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">x</span><span class="p">();</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="w">    </span><span class="n">R0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">ypr2R</span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="p">{</span><span class="o">-</span><span class="n">yaw</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R0</span><span class="p">;</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g</span><span class="p">;</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="w">    </span><span class="c1">//Matrix3d rot_diff = R0 * Rs[0].transpose();</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="w">    </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">rot_diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R0</span><span class="p">;</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">frame_count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="w">        </span><span class="n">Ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rot_diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ps</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a><span class="w">        </span><span class="n">Rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rot_diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a><span class="w">        </span><span class="n">Vs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rot_diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Vs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="p">}</span>
</code></pre></div>
<p><code>VisualIMUAlignment()</code> consists of two steps <code>solveGyroscopeBias(...)</code> that computes an initial guess of <code>delta_bg</code> <span class="arithmatex">\(\mathbf{b}_{\omega}\)</span>, and <code>LinearAlignment(...)</code></p>
<ul>
<li><code>solveGyroscopeBias(...)</code></li>
</ul>
<p>Define the <span class="arithmatex">\(i\)</span>-th and <span class="arithmatex">\(j\)</span>-th frame rotation difference (the <span class="arithmatex">\(j\)</span>-th frame is the next frame to the <span class="arithmatex">\(i\)</span>-th's: <span class="arithmatex">\(j=i+1\)</span>): <code>q_ij</code> by <span class="arithmatex">\(R_{ij}=R_{i}^\top R_{j}\)</span>.</p>
<p>Then define <span class="arithmatex">\(A\mathbf{x}=\mathbf{b}\)</span> such that</p>
<div class="arithmatex">\[
\begin{align*}
A_{3 \times 3} &amp;= \sum_{i} \Big(\frac{\partial R_j}{\partial \mathbf{b}_{\omega}}\Big)^\top \frac{\partial R_j}{\partial \mathbf{b}_{\omega}} \\\\
\mathbf{b}_{3 \times 1} &amp;= \sum_{i} \Big(\frac{\partial R_j}{\partial \mathbf{b}_{\omega}}\Big)^\top \big( 2 \Delta R_j R_{ij} \big)
\end{align*}
\]</div>
<p>LDLT solves <span class="arithmatex">\(A\mathbf{x}=\mathbf{b}\)</span>, where <span class="arithmatex">\(\mathbf{x}\)</span> refers to <span class="arithmatex">\(\Delta \mathbf{b}_{\omega}\)</span></p>
<ul>
<li><code>LinearAlignment(...)</code></li>
</ul>
<p>Define <span class="arithmatex">\(A_{\text{tmp, i}} \in \mathbb{R}^{6 \times 10}\)</span> as the Jacobian partial on position and velocity, and <span class="arithmatex">\(\mathbf{b}_{\text{tmp, i}} \in \mathbb{R}^{6}\)</span> as the residuals of position and velocity, where <span class="arithmatex">\(i\)</span> denotes the <span class="arithmatex">\(i\)</span>-th frame.</p>
<div class="arithmatex">\[
\begin{align*}
A_{\text{tmp, i}} &amp;= 
\begin{bmatrix}
    \frac{\partial \mathbf{p}}{\partial \mathbf{p}}
    &amp; \frac{\partial \mathbf{p}}{\partial \mathbf{v}}
    &amp; \frac{\partial \mathbf{p}}{\partial \mathbf{a}}
    &amp; \frac{\partial \mathbf{p}}{\partial s} \\\\
    \frac{\partial \mathbf{v}}{\partial \mathbf{p}}
    &amp; \frac{\partial \mathbf{v}}{\partial \mathbf{v}}
    &amp; \frac{\partial \mathbf{v}}{\partial \mathbf{a}}
    &amp; \frac{\partial \mathbf{v}}{\partial s}
\end{bmatrix}
\\\\ &amp;=
\begin{bmatrix}
    -\mathbf{I}_{3 \times 3} \cdot (\delta t)
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \frac{1}{2} R_i^\top \cdot (\delta t)^2
    &amp; \frac{1}{100} R_i^\top (\mathbf{t}_j - \mathbf{t}_i) \\\\
    -\mathbf{I}_{3 \times 3}
    &amp; R_i^\top R_j
    &amp; R_i^\top \cdot (\delta t)
    &amp; \mathbf{0}_{3 \times 3}
\end{bmatrix} \\\\
\space \\\\
\mathbf{b}_{\text{tmp, i}} &amp;= 
\begin{bmatrix}
    \Delta \mathbf{p}_j + R_i^\top R_j \mathbf{t}_{ce} - \mathbf{t}_{ce} \\\\
    \Delta \mathbf{v}_j
\end{bmatrix}
\end{align*}
\]</div>
<p>where <span class="arithmatex">\(\mathbf{t}_{ce}\)</span> is camera extrinsics.</p>
<p>Then define <span class="arithmatex">\(A\mathbf{x}=\mathbf{b}\)</span>, where <span class="arithmatex">\(A \in \mathbb{R}^{\big((n \times 3) + 3 + 1\big) \times \big((n \times 3) + 3 + 1\big)}\)</span> and <span class="arithmatex">\(\mathbf{b} \in \mathbb{R}^{(n \times 3) + 3 + 1}\)</span> <span class="arithmatex">\(n\)</span> is the total number of frames.</p>
<div class="arithmatex">\[
\begin{align*}
A &amp;= 
\begin{bmatrix}
    \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{1:3, 1:3} 
    &amp; \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{1:3, 4:6} 
    &amp; \mathbf{0}_{3 \times 3} &amp; &amp; &amp; &amp; \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{1:3, 7:10}  \\\\
    \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{4:6, 1:3} 
    &amp; \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{4:6, 4:6} + \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{1:3, 1:3} 
    &amp; \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{1:3, 4:6} 
    &amp; &amp; &amp; 
    &amp; \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{4:6, 7:10} +  \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{1:3, 7:10}  \\\\
    \mathbf{0}_{3 \times 3} &amp; \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{4:6, 1:3} 
    &amp; \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{4:6, 4:6} + \Big( A_{\text{tmp, 3}}^\top A_{\text{tmp, 3}} \Big)_{1:3, 1:3} 
    &amp; &amp; &amp; 
    &amp; \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{4:6, 7:10} +  \Big( A_{\text{tmp, 3}}^\top A_{\text{tmp, 3}} \Big)_{1:3, 7:10}  \\\\
\space \\\\
    &amp; &amp; &amp; &amp; \ddots &amp; &amp; &amp; 
\\\\ 
\space \\\\
    \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{7:10, 1:3} 
    &amp; \Big( A_{\text{tmp, 1}}^\top A_{\text{tmp, 1}} \Big)_{7:10, 4:6} +  \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{7:10, 1:3}
    &amp; \Big( A_{\text{tmp, 2}}^\top A_{\text{tmp, 2}} \Big)_{7:10, 4:6} +  \Big( A_{\text{tmp, 3}}^\top A_{\text{tmp, 3}} \Big)_{7:10, 1:3}
    &amp; &amp; &amp; 
    &amp; \sum_i \Big( A_{\text{tmp, i}}^\top A_{\text{tmp, i}} \Big)_{7:10, 7:10} 
\end{bmatrix} \\\\
\mathbf{b} &amp;= 
\begin{bmatrix}
    \mathbf{b}_{\text{tmp, 1}, 1:3} \\\\
    \mathbf{b}_{\text{tmp, 1}, 4:6} + \mathbf{b}_{\text{tmp, 2}, 1:3} \\\\
    \mathbf{b}_{\text{tmp, 2}, 4:6} + \mathbf{b}_{\text{tmp, 3}, 1:3} \\\\
    \vdots \\\\
    \sum_i \mathbf{b}_{\text{tmp, i}, 7:10}
\end{bmatrix}
\end{align*}
\]</div>
<p>LDLT solves <span class="arithmatex">\(A\mathbf{x}=\mathbf{b}\)</span>, where <span class="arithmatex">\(\mathbf{x}\)</span> refers to <span class="arithmatex">\([\mathbf{p}_1, \mathbf{p}_2, ..., \mathbf{p}_n, \mathbf{a}, s]\)</span></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">VisualIMUAlignment</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">ImageFrame</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">all_image_frame</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3d</span><span class="o">*</span><span class="w"> </span><span class="n">Bgs</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">VectorXd</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="n">solveGyroscopeBias</span><span class="p">(</span><span class="n">all_image_frame</span><span class="p">,</span><span class="w"> </span><span class="n">Bgs</span><span class="p">);</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="n">LinearAlignment</span><span class="p">(</span><span class="n">all_image_frame</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="p">}</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">solveGyroscopeBias</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">ImageFrame</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">all_image_frame</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3d</span><span class="o">*</span><span class="w"> </span><span class="n">Bgs</span><span class="p">)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="p">{</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">frame_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">next</span><span class="p">(</span><span class="n">frame_i</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">frame_i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">        </span><span class="n">frame_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">(</span><span class="n">frame_i</span><span class="p">);</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">q_ij</span><span class="p">(</span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">        </span><span class="n">tmp_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">jacobian</span><span class="p">.</span><span class="k">template</span><span class="w"> </span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_R</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="p">);</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">        </span><span class="n">tmp_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">delta_q</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q_ij</span><span class="p">).</span><span class="n">vec</span><span class="p">();</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">        </span><span class="n">A</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tmp_A</span><span class="p">;</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tmp_b</span><span class="p">;</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="n">delta_bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">ldlt</span><span class="p">().</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">WINDOW_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">        </span><span class="n">Bgs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">delta_bg</span><span class="p">;</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="p">}</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="c1">// camera extrinsic rotation</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RIC</span><span class="p">;</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="c1">// camera extrinsic translation</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TIC</span><span class="p">;</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">LinearAlignment</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">ImageFrame</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">all_image_frame</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">VectorXd</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="p">{</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">all_frame_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_frame_count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">    </span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">A</span><span class="p">{</span><span class="n">n_state</span><span class="p">,</span><span class="w"> </span><span class="n">n_state</span><span class="p">};</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">    </span><span class="n">A</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">    </span><span class="n">VectorXd</span><span class="w"> </span><span class="n">b</span><span class="p">{</span><span class="n">n_state</span><span class="p">};</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">    </span><span class="n">map</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">ImageFrame</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">frame_i</span><span class="p">;</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">    </span><span class="n">map</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">ImageFrame</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">frame_j</span><span class="p">;</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">frame_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">next</span><span class="p">(</span><span class="n">frame_i</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">all_image_frame</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">frame_i</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="w">        </span><span class="n">frame_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">(</span><span class="n">frame_i</span><span class="p">);</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="w">        </span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">tmp_A</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="w">        </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">        </span><span class="n">VectorXd</span><span class="w"> </span><span class="n">tmp_b</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="w">        </span><span class="n">tmp_b</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">sum_dt</span><span class="p">;</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">        </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="w">        </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="w">        </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">;</span><span class="w">     </span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="w">        </span><span class="n">tmp_b</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">delta_p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">TIC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">TIC</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="w">        </span><span class="c1">//cout &lt;&lt; &quot;delta_p   &quot; &lt;&lt; frame_j-&gt;second.pre_integration-&gt;delta_p.transpose() &lt;&lt; endl;</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a><span class="w">        </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="w">        </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a><span class="w">        </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_i</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="w">        </span><span class="n">tmp_b</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_j</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">delta_v</span><span class="p">;</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="w">        </span><span class="c1">//cout &lt;&lt; &quot;delta_v   &quot; &lt;&lt; frame_j-&gt;second.pre_integration-&gt;delta_v.transpose() &lt;&lt; endl;</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a><span class="w">        </span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cov_inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;::</span><span class="n">Zero</span><span class="p">();</span>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="w">        </span><span class="c1">//cov.block&lt;6, 6&gt;(0, 0) = IMU_cov[i + 1];</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a><span class="w">        </span><span class="c1">//MatrixXd cov_inv = cov.inverse();</span>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a><span class="w">        </span><span class="n">cov_inv</span><span class="p">.</span><span class="n">setIdentity</span><span class="p">();</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a><span class="w">        </span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">r_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cov_inv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tmp_A</span><span class="p">;</span>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="w">        </span><span class="n">VectorXd</span><span class="w"> </span><span class="n">r_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_A</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cov_inv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tmp_b</span><span class="p">;</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a><span class="w">        </span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">r_A</span><span class="p">.</span><span class="n">topLeftCorner</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a><span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">segment</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">r_b</span><span class="p">.</span><span class="n">head</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a>
<a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a><span class="w">        </span><span class="n">A</span><span class="p">.</span><span class="n">bottomRightCorner</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">r_A</span><span class="p">.</span><span class="n">bottomRightCorner</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a><span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">tail</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">r_b</span><span class="p">.</span><span class="n">tail</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a>
<a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a><span class="w">        </span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">n_state</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">r_A</span><span class="p">.</span><span class="n">topRightCorner</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a><span class="w">        </span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n_state</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">r_A</span><span class="p">.</span><span class="n">bottomLeftCorner</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">;</span>
<a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">;</span>
<a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">ldlt</span><span class="p">().</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a>
<a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a><span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">segment</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n_state</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a><span class="w">    </span><span class="n">RefineGravity</span><span class="p">(</span><span class="n">all_image_frame</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a><span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">tail</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">())(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.0</span><span class="p">;</span>
<a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a><span class="p">}</span>
</code></pre></div>
<p><code>triangulate(...)</code> estimates depth of a 3d world point by two corresponding two points from two chronologically sequential frames.
The result is removed of scale <code>it_per_id.estimated_depth = svd_V[2] / svd_V[3];</code>.
In the later part of <code>visualInitialAlign()</code>, the scale is multiplied back <code>it_per_id.estimated_depth *= s;</code>, where the scale <code>s</code> is the result from <code>LinearAlignment(...)</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">FeatureManager::triangulate</span><span class="p">(</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Ps</span><span class="p">[],</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">tic</span><span class="p">[],</span><span class="w"> </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">ric</span><span class="p">[])</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">feature</span><span class="p">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">imu_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">start_frame</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">imu_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">svd_A</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_frame</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">)</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">            </span><span class="n">imu_j</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ps</span><span class="p">[</span><span class="n">imu_j</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="n">imu_j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tic</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rs</span><span class="p">[</span><span class="n">imu_j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ric</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R0</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="p">);</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R0</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R1</span><span class="p">;</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">            </span><span class="n">P</span><span class="p">.</span><span class="n">leftCols</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">            </span><span class="n">P</span><span class="p">.</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_frame</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">normalized</span><span class="p">();</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">            </span><span class="n">svd_A</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">svd_idx</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">            </span><span class="n">svd_A</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">svd_idx</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu_i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">imu_j</span><span class="p">)</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector4d</span><span class="w"> </span><span class="n">svd_V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">JacobiSVD</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="o">&gt;</span><span class="p">(</span><span class="n">svd_A</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">ComputeThinV</span><span class="p">).</span><span class="n">matrixV</span><span class="p">().</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="w">        </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">estimated_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svd_V</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">svd_V</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="p">}</span>
</code></pre></div>
<h2 id="marginalization">Marginalization</h2>
<p>Marginalization runs in <code>Estimator::optimization()</code>.</p>
<p>First run <code>preMarginalize()</code>, then run <code>marginalize()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">TicToc</span><span class="w"> </span><span class="n">t_pre_margin</span><span class="p">;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">ROS_DEBUG</span><span class="p">(</span><span class="s">&quot;begin marginalization&quot;</span><span class="p">);</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">preMarginalize</span><span class="p">();</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">ROS_DEBUG</span><span class="p">(</span><span class="s">&quot;end pre marginalization, %f ms&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_pre_margin</span><span class="p">.</span><span class="n">toc</span><span class="p">());</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">TicToc</span><span class="w"> </span><span class="n">t_margin</span><span class="p">;</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="n">ROS_DEBUG</span><span class="p">(</span><span class="s">&quot;begin marginalization&quot;</span><span class="p">);</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">marginalize</span><span class="p">();</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">ROS_DEBUG</span><span class="p">(</span><span class="s">&quot;end marginalization, %f ms&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_margin</span><span class="p">.</span><span class="n">toc</span><span class="p">());</span>
</code></pre></div>
<h3 id="marginalization-residuals-and-jacobians">Marginalization Residuals and Jacobians</h3>
<div class="arithmatex">\[
\min_{\mathbf{\mathcal{X}}}
\underbrace{\big|\big|
    \mathbf{r}_p - H_p \mathbf{\mathcal{X}}
\big|\big|^2}_{
\text{Marginalization residuals}}
\]</div>
<p>The Jacobians and residuals of marginalization are first used in <code>MarginalizationFactor *marginalization_factor = new MarginalizationFactor(last_marginalization_info);</code> in <code>optimization()</code> then added to ceres optimization <code>problem.AddResidualBlock(marginalization_factor, NULL, last_marginalization_parameter_blocks);</code></p>
<p><code>MarginalizationFactor::Evaluate(...)</code> computes <code>linearized_residuals</code> that is assigned to <code>jacobian</code>, and <code>residuals</code> that linearly grows by adding <code>linearized_jacobians * dx</code>, where 
<code>dx</code> is the delta between this step <code>x</code> and the previous step <code>x0</code>; <code>dx.segment&lt;3&gt;(idx + 0)</code> talks about translation and <code>dx.segment&lt;3&gt;(idx + 3)</code> talks about rotation.
In detail, <code>x0 = MarginalizationInfo::keep_block_data</code> stores to-be-kept data blocks in the Marginalization matrix. 
So that <code>x - x0</code> computes the differences of the to-be-kept data blocks between now and the previous marginalization.</p>
<p>The two const pointer <code>const *const *parameters</code> refers to the 2d parameter block should be const during the execution, and the changeable parameters are <code>x</code> and <code>x0</code> having the same values as <code>parameters</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">MarginalizationInfo</span><span class="o">::</span><span class="n">getParameterBlocks</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">addr_shift</span><span class="p">){</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">parameter_block_idx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">        </span><span class="c1">// `idx &gt;= m` means the data blocks are to be kept  </span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">            </span><span class="n">keep_block_data</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">parameter_block_data</span><span class="p">[</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">]);</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="p">}</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="kt">bool</span><span class="w"> </span><span class="n">MarginalizationFactor</span><span class="o">::</span><span class="n">Evaluate</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">residuals</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">jacobians</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="p">{</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="nf">dx</span><span class="p">(</span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">keep_block_size</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&gt;</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&gt;</span><span class="p">(</span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">keep_block_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">        </span><span class="n">dx</span><span class="p">.</span><span class="n">segment</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">head</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">.</span><span class="n">head</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">        </span><span class="c1">// `vec()` returns a vector expression of the imaginary part (x,y,z) </span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">        </span><span class="n">dx</span><span class="p">.</span><span class="n">segment</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">positify</span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="p">(</span><span class="n">x0</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">x0</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">x0</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">x0</span><span class="p">(</span><span class="mi">5</span><span class="p">)).</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">5</span><span class="p">))).</span><span class="n">vec</span><span class="p">();</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&gt;</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">linearized_residuals</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">linearized_jacobians</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dx</span><span class="p">;</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">keep_block_size</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Dynamic</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Dynamic</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="w">        </span><span class="n">jacobian</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="w">        </span><span class="n">jacobian</span><span class="p">.</span><span class="n">leftCols</span><span class="p">(</span><span class="n">local_size</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">marginalization_info</span><span class="o">-&gt;</span><span class="n">linearized_jacobians</span><span class="p">.</span><span class="n">middleCols</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">local_size</span><span class="p">);</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="p">}</span>
</code></pre></div>
<h3 id="pre-marginalization">Pre-Marginalization</h3>
<p>Marginalization first starts with <code>preMarginalize()</code>, that first does <code>ResidualBlockInfo::Evaluate()</code>, that computes a vector of residuals and Jacobian matrices, and scaled by loss function if defined.
In detail, they are computed in <code>preMarginalize(){  it-&gt;Evaluate(); ... }</code>, where <code>ResidualBlockInfo::Evaluate(){  ...  cost_function-&gt;Evaluate(...); ... }</code>, that calls <code>MarginalizationFactor::Evaluate(...)</code>.</p>
<p>Then, it allocates memory to <code>MarginalizationInfo::parameter_block_data</code>, which is a <code>std::unordered_map&lt;long, double *&gt;</code> whose key is a pointer pointed to a block memory of <code>double</code> type.  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">MarginalizationInfo::preMarginalize</span><span class="p">()</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">factors</span><span class="p">)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">        </span><span class="c1">// computes a vector of residuals and Jacobian matrices, and scaled by a loss function</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">        </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">Evaluate</span><span class="p">();</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">        </span><span class="c1">// prepare data memory allocation</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">block_sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">cost_function</span><span class="o">-&gt;</span><span class="n">parameter_block_sizes</span><span class="p">();</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parameter_block_data</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">parameter_block_data</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">                </span><span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">                </span><span class="n">parameter_block_data</span><span class="p">[</span><span class="n">addr</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="p">}</span>
</code></pre></div>
<h3 id="compute-marginalization">Compute Marginalization</h3>
<p>First, set matrix size <code>Eigen::MatrixXd A(pos, pos);</code> <span class="arithmatex">\(A \in \mathbb{R}^{(m+n)\times(m+n)}\)</span> and <code>Eigen::VectorXd b(pos);</code> <span class="arithmatex">\(\mathbf{b} \in \mathbb{R}^{m+n}\)</span> where <code>pos = m + n</code>;
<code>m</code> refers to the parameter block size to be marginalized out, and <code>n</code> refers to the parameter block size to be kept).</p>
<p>Take Jacobians <span class="arithmatex">\(\mathbf{J}\)</span> and residuals <span class="arithmatex">\(\mathbf{r}\)</span> from <code>ResidualBlockInfo</code>, and compute for <span class="arithmatex">\(A_t=A_{t-1}+\mathbf{J}^\top \mathbf{J}\)</span>, and <span class="arithmatex">\(\mathbf{b}_t = \mathbf{b}_{t-1} + \mathbf{J}^\top\mathbf{r}\)</span>, where the subscripts <span class="arithmatex">\(\space_{t}\)</span> and <span class="arithmatex">\(\space_{t-1}\)</span> refer to timestamps before and after updating.</p>
<p>To facilitate computation, <span class="arithmatex">\(A_t=A_{t-1}+\mathbf{J}^\top \mathbf{J}\)</span>, and <span class="arithmatex">\(\mathbf{b}_t = \mathbf{b}_{t-1} + \mathbf{J}^\top\mathbf{r}\)</span> are computed in parallel by multi-threading where data is partitioned in <code>ThreadsStruct* p</code>.
The computed results are summed to <code>A</code> and <code>b</code>.</p>
<p>Then, <code>Amm</code> is <span class="arithmatex">\(A_{mm}=\frac{1}{2} A_{mm} + A_{mm}^\top\)</span>, and is self-adjoint.</p>
<p>The inverse of <span class="arithmatex">\(A_{mm}\)</span> (denoted in code as <code>Amm_inv</code> <span class="arithmatex">\(A_{mm}^{-1}\)</span>) can be computed by, 
first take eigen-decomposition of <span class="arithmatex">\(A_{mm}\)</span> such that <span class="arithmatex">\(A_{mm}=V_{mm} \Sigma_{mm} V_{mm}^{\top}\)</span>, where <span class="arithmatex">\(\Sigma_{mm}=\text{diag}(\sigma_1, \sigma_2, ..., \sigma_m)\)</span> is the diagonal matrix comprised of eigenvalues; 
then take element-wise inverse operation on <span class="arithmatex">\(\Sigma_{mm}\)</span> such that <span class="arithmatex">\(\Sigma^{-1}_{mm}=\text{diag}(\sigma_1^{-1}, \sigma_2^{-1}, ..., \sigma_m^{-1})\)</span>;
finally, there is <span class="arithmatex">\(A_{mm}^{-1}=V_{mm} \Sigma^{-1}_{mm} V_{mm}^{\top}\)</span></p>
<p>The marginalization aims to compute <span class="arithmatex">\(\Delta \mathbf{x}_{{\mathbf{x}_m } \notin \mathbf{x}}\)</span>.</p>
<div class="arithmatex">\[
\begin{bmatrix}
    A_{mm} &amp; A_{mr} \\\\
    A_{rm} &amp; A_{rr}
\end{bmatrix}
\begin{bmatrix}
    \Delta \mathbf{x}_{{\mathbf{x}_m }} \\\\
    \Delta \mathbf{x}_{{\mathbf{x}_m } \notin \mathbf{x}}
\end{bmatrix}=
\begin{bmatrix}
    \mathbf{b}_{mm} \\\\
    \mathbf{b}_{rr}
\end{bmatrix}
\]</div>
<p>The expression (by Schur trick) for <span class="arithmatex">\(\Delta \mathbf{x}_{{\mathbf{x}_1 } \notin \mathbf{x}}\)</span> should be as below, rewrite the coefficients to <span class="arithmatex">\(A\)</span> and bias to <span class="arithmatex">\(\mathbf{b}\)</span></p>
<div class="arithmatex">\[
\underbrace{(A_{rr}- A_{rm}A_{mm}^{-1}A_{mr})}_{A}
\Delta \mathbf{x}_{{\mathbf{x}_m } \notin \mathbf{x}}=
\underbrace{\mathbf{b}_{rr} - A_{rm}A_{mm}^{-1} \mathbf{b}_{mm}
}_{\mathbf{b}}
\]</div>
<p>Take eigen-decomposition of <span class="arithmatex">\(A=V_A \Sigma_A V_A^{\top}\)</span>. 
Define <span class="arithmatex">\(\mathbf{s}=[\sigma_1, \sigma_2, ..., \sigma_r]\)</span>, 
where <span class="arithmatex">\(\sigma_i \in \Sigma_A\)</span> is the non-zero eigenvalues of <span class="arithmatex">\(A\)</span>, similarly, 
define element-wise inverse <span class="arithmatex">\(\mathbf{s}^{-1}=[\sigma_1^{-1}, \sigma_2^{-1}, ..., \sigma_r^{-1}]\)</span> (denoted as <code>S</code> and <code>S_inv</code> in code).</p>
<p>Take the element-wise square root of <span class="arithmatex">\(\mathbf{s}\)</span> and <span class="arithmatex">\(\mathbf{s}^{-1}\)</span> (denoted as <span class="arithmatex">\(|\mathbf{s}|\)</span> and <span class="arithmatex">\(|\mathbf{s}^{-1}|\)</span>), and the linearized Jacobians <span class="arithmatex">\(\mathbf{J}\)</span> and residuals <span class="arithmatex">\(\mathbf{r}\)</span> are</p>
<div class="arithmatex">\[
\begin{align*}
\mathbf{J} &amp;= \text{diag}(|\mathbf{s}|) \cdot V_A^\top \\\\
\mathbf{r} &amp;=
\underbrace{\text{diag}(|\mathbf{s}^{-1}|) \cdot V_A^\top}_{\mathbf{J}^{-1}}
 \cdot \mathbf{b}
\end{align*}
\]</div>
<p>The Jacobian and residual explained: consider a general least squares problem <span class="arithmatex">\(\min \frac{1}{2} \mathbf{r}^\top(\mathbf{x}) \mathbf{r}(\mathbf{x})\)</span>, and let <span class="arithmatex">\(\mathbf{J}\)</span> be the Jacobian of <span class="arithmatex">\(\mathbf{r}(\mathbf{x})\)</span>, and the Hessian be <span class="arithmatex">\(\mathbf{J}^\top \mathbf{J}\)</span>.
By Gauss-Newton method (ignored higher order terms greater than Hessian), the optimal <span class="arithmatex">\(\mathbf{x}^*=\mathbf{x}_0+\Delta\mathbf{x}\)</span> can be found by successive iteration: </p>
<div class="arithmatex">\[
\begin{align*}
&amp;&amp;
\mathbf{x}_{k+1} &amp;= \mathbf{x}_k - (\mathbf{J}^\top \mathbf{J})^{-1} \mathbf{J}^\top \mathbf{r}(\mathbf{x})
\\\\ \Rightarrow &amp;&amp;
\mathbf{J}^\top \mathbf{J}(\mathbf{x}_{k+1} - \mathbf{x}_k) &amp;=  -\mathbf{J}^\top \mathbf{r}(\mathbf{x})
\\\\ \Rightarrow &amp;&amp;
\underbrace{\mathbf{J}^\top \mathbf{J}}_{A} 
\Delta \mathbf{x}_k &amp;=  
\underbrace{-\mathbf{J}^\top \mathbf{r}(\mathbf{x})}_{\mathbf{r}}
\end{align*}
\]</div>
<p>where <span class="arithmatex">\(\mathbf{r}(\mathbf{x}) := \mathbf{b}\)</span> is defined interchangeably as in the code's notation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ThreadsStruct</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="p">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ResidualBlockInfo</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">sub_factors</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">A</span><span class="p">;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameter_block_size</span><span class="p">;</span><span class="w"> </span><span class="c1">//global size</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameter_block_idx</span><span class="p">;</span><span class="w"> </span><span class="c1">//local size</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="p">};</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="c1">// Compute for </span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="c1">// A = jacobian_i.transpose() * jacobian_j </span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="c1">// b = jacobian_i.transpose() * it-&gt;residuals</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">ThreadsConstructA</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">threadsstruct</span><span class="p">)</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="p">{</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="n">ThreadsStruct</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ThreadsStruct</span><span class="o">*</span><span class="p">)</span><span class="n">threadsstruct</span><span class="p">);</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">sub_factors</span><span class="p">)</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">idx_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">parameter_block_idx</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">])];</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">size_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">parameter_block_size</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">])];</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size_i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">                </span><span class="n">size_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">jacobian_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">jacobians</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">leftCols</span><span class="p">(</span><span class="n">size_i</span><span class="p">);</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">idx_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">parameter_block_idx</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">j</span><span class="p">])];</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">size_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">parameter_block_size</span><span class="p">[</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">parameter_blocks</span><span class="p">[</span><span class="n">j</span><span class="p">])];</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size_j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">                    </span><span class="n">size_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">                </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">jacobian_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">jacobians</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">leftCols</span><span class="p">(</span><span class="n">size_j</span><span class="p">);</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">                    </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="n">idx_i</span><span class="p">,</span><span class="w"> </span><span class="n">idx_j</span><span class="p">,</span><span class="w"> </span><span class="n">size_i</span><span class="p">,</span><span class="w"> </span><span class="n">size_j</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">jacobian_i</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobian_j</span><span class="p">;</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">                </span><span class="k">else</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">                </span><span class="p">{</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w">                    </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="n">idx_i</span><span class="p">,</span><span class="w"> </span><span class="n">idx_j</span><span class="p">,</span><span class="w"> </span><span class="n">size_i</span><span class="p">,</span><span class="w"> </span><span class="n">size_j</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">jacobian_i</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobian_j</span><span class="p">;</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">                    </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="n">idx_j</span><span class="p">,</span><span class="w"> </span><span class="n">idx_i</span><span class="p">,</span><span class="w"> </span><span class="n">size_j</span><span class="p">,</span><span class="w"> </span><span class="n">size_i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="n">idx_i</span><span class="p">,</span><span class="w"> </span><span class="n">idx_j</span><span class="p">,</span><span class="w"> </span><span class="n">size_i</span><span class="p">,</span><span class="w"> </span><span class="n">size_j</span><span class="p">).</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w">            </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">segment</span><span class="p">(</span><span class="n">idx_i</span><span class="p">,</span><span class="w"> </span><span class="n">size_i</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">jacobian_i</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">residuals</span><span class="p">;</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">threadsstruct</span><span class="p">;</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="p">}</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="kt">void</span><span class="w"> </span><span class="nf">MarginalizationInfo::marginalize</span><span class="p">()</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="p">{</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="w">    </span><span class="c1">// `m = pos;` is the total size of existing parameter block</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">parameter_block_idx</span><span class="p">)</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="w">        </span><span class="n">pos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">localSize</span><span class="p">(</span><span class="n">parameter_block_size</span><span class="p">[</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">]);</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a><span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="w">    </span><span class="c1">// `n = pos - m;` is the new parameter block excluded existing parameters that `n` increases</span>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a><span class="w">    </span><span class="c1">// when the block idx is not found`parameter_block_idx.find(it.first) == parameter_block_idx.end()`</span>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">parameter_block_size</span><span class="p">)</span>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parameter_block_idx</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">parameter_block_idx</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="w">            </span><span class="n">parameter_block_idx</span><span class="p">[</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span>
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a><span class="w">            </span><span class="n">pos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">localSize</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a><span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a>
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a><span class="w">    </span><span class="c1">// pos is the total size before marginalization</span>
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a><span class="w">    </span><span class="n">A</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a><span class="w">    </span><span class="c1">// assign data blocks to threads</span>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a><span class="w">    </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_thread_summing</span><span class="p">;</span>
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a><span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">tids</span><span class="p">[</span><span class="n">NUM_THREADS</span><span class="p">];</span>
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a><span class="w">    </span><span class="n">ThreadsStruct</span><span class="w"> </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">NUM_THREADS</span><span class="p">];</span>
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">factors</span><span class="p">)</span>
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a><span class="w">        </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sub_factors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">NUM_THREADS</span><span class="p">;</span>
<a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-86" name="__codelineno-15-86" href="#__codelineno-15-86"></a>
<a id="__codelineno-15-87" name="__codelineno-15-87" href="#__codelineno-15-87"></a><span class="w">    </span><span class="c1">// run threads to compute </span>
<a id="__codelineno-15-88" name="__codelineno-15-88" href="#__codelineno-15-88"></a><span class="w">    </span><span class="c1">// A = jacobian_i.transpose() * jacobian_j </span>
<a id="__codelineno-15-89" name="__codelineno-15-89" href="#__codelineno-15-89"></a><span class="w">    </span><span class="c1">// b = jacobian_i.transpose() * it-&gt;residuals</span>
<a id="__codelineno-15-90" name="__codelineno-15-90" href="#__codelineno-15-90"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_THREADS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-15-91" name="__codelineno-15-91" href="#__codelineno-15-91"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-15-92" name="__codelineno-15-92" href="#__codelineno-15-92"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">zero_matrix</span><span class="p">;</span>
<a id="__codelineno-15-93" name="__codelineno-15-93" href="#__codelineno-15-93"></a><span class="w">        </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Zero</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">pos</span><span class="p">);</span>
<a id="__codelineno-15-94" name="__codelineno-15-94" href="#__codelineno-15-94"></a><span class="w">        </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">::</span><span class="n">Zero</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
<a id="__codelineno-15-95" name="__codelineno-15-95" href="#__codelineno-15-95"></a><span class="w">        </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">parameter_block_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameter_block_size</span><span class="p">;</span>
<a id="__codelineno-15-96" name="__codelineno-15-96" href="#__codelineno-15-96"></a><span class="w">        </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">parameter_block_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameter_block_idx</span><span class="p">;</span>
<a id="__codelineno-15-97" name="__codelineno-15-97" href="#__codelineno-15-97"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pthread_create</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">ThreadsConstructA</span><span class="w"> </span><span class="p">,(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
<a id="__codelineno-15-98" name="__codelineno-15-98" href="#__codelineno-15-98"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-99" name="__codelineno-15-99" href="#__codelineno-15-99"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-15-100" name="__codelineno-15-100" href="#__codelineno-15-100"></a><span class="w">            </span><span class="n">ROS_WARN</span><span class="p">(</span><span class="s">&quot;pthread_create error&quot;</span><span class="p">);</span>
<a id="__codelineno-15-101" name="__codelineno-15-101" href="#__codelineno-15-101"></a><span class="w">            </span><span class="n">ROS_BREAK</span><span class="p">();</span>
<a id="__codelineno-15-102" name="__codelineno-15-102" href="#__codelineno-15-102"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-103" name="__codelineno-15-103" href="#__codelineno-15-103"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-104" name="__codelineno-15-104" href="#__codelineno-15-104"></a>
<a id="__codelineno-15-105" name="__codelineno-15-105" href="#__codelineno-15-105"></a><span class="w">    </span><span class="c1">// join threads, and sums A and b</span>
<a id="__codelineno-15-106" name="__codelineno-15-106" href="#__codelineno-15-106"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NUM_THREADS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-15-107" name="__codelineno-15-107" href="#__codelineno-15-107"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-15-108" name="__codelineno-15-108" href="#__codelineno-15-108"></a><span class="w">        </span><span class="n">pthread_join</span><span class="p">(</span><span class="w"> </span><span class="n">tids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-15-109" name="__codelineno-15-109" href="#__codelineno-15-109"></a><span class="w">        </span><span class="n">A</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">A</span><span class="p">;</span>
<a id="__codelineno-15-110" name="__codelineno-15-110" href="#__codelineno-15-110"></a><span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">threadsstruct</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-15-111" name="__codelineno-15-111" href="#__codelineno-15-111"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-112" name="__codelineno-15-112" href="#__codelineno-15-112"></a>
<a id="__codelineno-15-113" name="__codelineno-15-113" href="#__codelineno-15-113"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">Amm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">).</span><span class="n">transpose</span><span class="p">());</span>
<a id="__codelineno-15-114" name="__codelineno-15-114" href="#__codelineno-15-114"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">SelfAdjointEigenSolver</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">saes</span><span class="p">(</span><span class="n">Amm</span><span class="p">);</span>
<a id="__codelineno-15-115" name="__codelineno-15-115" href="#__codelineno-15-115"></a><span class="w">    </span><span class="c1">// `array() &gt; eps` means selecting non-zero elements</span>
<a id="__codelineno-15-116" name="__codelineno-15-116" href="#__codelineno-15-116"></a><span class="w">    </span><span class="c1">// `array()` is the element-wise operation in Eigen</span>
<a id="__codelineno-15-117" name="__codelineno-15-117" href="#__codelineno-15-117"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">Amm_inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<a id="__codelineno-15-118" name="__codelineno-15-118" href="#__codelineno-15-118"></a><span class="w">      </span><span class="n">saes</span><span class="p">.</span><span class="n">eigenvectors</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-15-119" name="__codelineno-15-119" href="#__codelineno-15-119"></a><span class="w">      </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="p">((</span><span class="n">saes</span><span class="p">.</span><span class="n">eigenvalues</span><span class="p">().</span><span class="n">array</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">eps</span><span class="p">).</span><span class="n">select</span><span class="p">(</span><span class="n">saes</span><span class="p">.</span><span class="n">eigenvalues</span><span class="p">().</span><span class="n">array</span><span class="p">().</span><span class="n">inverse</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">)).</span><span class="n">asDiagonal</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-15-120" name="__codelineno-15-120" href="#__codelineno-15-120"></a><span class="w">      </span><span class="o">*</span><span class="w"> </span><span class="n">saes</span><span class="p">.</span><span class="n">eigenvectors</span><span class="p">().</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-15-121" name="__codelineno-15-121" href="#__codelineno-15-121"></a>
<a id="__codelineno-15-122" name="__codelineno-15-122" href="#__codelineno-15-122"></a><span class="w">    </span><span class="c1">// Marginalization by Schur trick</span>
<a id="__codelineno-15-123" name="__codelineno-15-123" href="#__codelineno-15-123"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">bmm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">);</span>
<a id="__codelineno-15-124" name="__codelineno-15-124" href="#__codelineno-15-124"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">Amr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-15-125" name="__codelineno-15-125" href="#__codelineno-15-125"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">Arm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">);</span>
<a id="__codelineno-15-126" name="__codelineno-15-126" href="#__codelineno-15-126"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">Arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">block</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-15-127" name="__codelineno-15-127" href="#__codelineno-15-127"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">brr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">segment</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-15-128" name="__codelineno-15-128" href="#__codelineno-15-128"></a><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Arm</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Amm_inv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Amr</span><span class="p">;</span>
<a id="__codelineno-15-129" name="__codelineno-15-129" href="#__codelineno-15-129"></a><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Arm</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Amm_inv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bmm</span><span class="p">;</span>
<a id="__codelineno-15-130" name="__codelineno-15-130" href="#__codelineno-15-130"></a>
<a id="__codelineno-15-131" name="__codelineno-15-131" href="#__codelineno-15-131"></a><span class="w">    </span><span class="c1">// (saes2.eigenvalues().array() &gt; eps).select(saes2.eigenvalues().array(), 0) is a ternary operation, same as `&gt; eps ? eigenvalues : 0`</span>
<a id="__codelineno-15-132" name="__codelineno-15-132" href="#__codelineno-15-132"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">SelfAdjointEigenSolver</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">saes2</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
<a id="__codelineno-15-133" name="__codelineno-15-133" href="#__codelineno-15-133"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="p">((</span><span class="n">saes2</span><span class="p">.</span><span class="n">eigenvalues</span><span class="p">().</span><span class="n">array</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">eps</span><span class="p">).</span><span class="n">select</span><span class="p">(</span><span class="n">saes2</span><span class="p">.</span><span class="n">eigenvalues</span><span class="p">().</span><span class="n">array</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-15-134" name="__codelineno-15-134" href="#__codelineno-15-134"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">S_inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="p">((</span><span class="n">saes2</span><span class="p">.</span><span class="n">eigenvalues</span><span class="p">().</span><span class="n">array</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">eps</span><span class="p">).</span><span class="n">select</span><span class="p">(</span><span class="n">saes2</span><span class="p">.</span><span class="n">eigenvalues</span><span class="p">().</span><span class="n">array</span><span class="p">().</span><span class="n">inverse</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-15-135" name="__codelineno-15-135" href="#__codelineno-15-135"></a>
<a id="__codelineno-15-136" name="__codelineno-15-136" href="#__codelineno-15-136"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">S_sqrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">cwiseSqrt</span><span class="p">();</span>
<a id="__codelineno-15-137" name="__codelineno-15-137" href="#__codelineno-15-137"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">S_inv_sqrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S_inv</span><span class="p">.</span><span class="n">cwiseSqrt</span><span class="p">();</span>
<a id="__codelineno-15-138" name="__codelineno-15-138" href="#__codelineno-15-138"></a>
<a id="__codelineno-15-139" name="__codelineno-15-139" href="#__codelineno-15-139"></a><span class="w">    </span><span class="c1">// compute Jacobians and residuals</span>
<a id="__codelineno-15-140" name="__codelineno-15-140" href="#__codelineno-15-140"></a><span class="w">    </span><span class="n">linearized_jacobians</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S_sqrt</span><span class="p">.</span><span class="n">asDiagonal</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">saes2</span><span class="p">.</span><span class="n">eigenvectors</span><span class="p">().</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-15-141" name="__codelineno-15-141" href="#__codelineno-15-141"></a><span class="w">    </span><span class="n">linearized_residuals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S_inv_sqrt</span><span class="p">.</span><span class="n">asDiagonal</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">saes2</span><span class="p">.</span><span class="n">eigenvectors</span><span class="p">().</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-15-142" name="__codelineno-15-142" href="#__codelineno-15-142"></a><span class="p">}</span>
</code></pre></div>
<h2 id="imu">IMU</h2>
<p>The IMU component is comprised of a <code>pre_integration</code> that stores accumulated imu readings and compute preintegration, and an <code>Evaluate(...)</code> that computes residuals and Jacobians.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">IMUFactor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">SizedCostFunction</span><span class="o">&lt;</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="n">IMUFactor</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="n">IMUFactor</span><span class="p">(</span><span class="n">IntegrationBase</span><span class="o">*</span><span class="w"> </span><span class="n">_pre_integration</span><span class="p">)</span><span class="o">:</span><span class="n">pre_integration</span><span class="p">(</span><span class="n">_pre_integration</span><span class="p">)</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Evaluate</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">residuals</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">jacobians</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="n">IntegrationBase</span><span class="o">*</span><span class="w"> </span><span class="n">pre_integration</span><span class="p">;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="p">}</span>
</code></pre></div>
<p>In <code>estimator</code>, <code>IntegrationBase</code> is stored in a list where each integration term takes the current IMU reading <code>acc_0, gyr_0</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="w">    </span><span class="n">pre_integrations</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IntegrationBase</span><span class="p">{</span><span class="n">acc_0</span><span class="p">,</span><span class="w"> </span><span class="n">gyr_0</span><span class="p">,</span><span class="w"> </span><span class="n">Bas</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="p">],</span><span class="w"> </span><span class="n">Bgs</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="p">]};</span>
</code></pre></div></p>
<h3 id="imu-noise-and-covariance-propogation">IMU Noise and Covariance Propogation</h3>
<p>IMU noises <span class="arithmatex">\(\mathbf{N}_{18 \times 18}\)</span> are simulated as below</p>
<div class="arithmatex">\[
\mathbf{N}_{ma} = \begin{bmatrix}
    n_{ma} &amp; 0 &amp; 0 \\\\
    0 &amp;  n_{ma} &amp; 0 \\\\
    0 &amp; 0 &amp; n_{ma} \\\\
\end{bmatrix}
, \qquad
\mathbf{N}_{m\omega} = \begin{bmatrix}
    n_{m\omega} &amp; 0 &amp; 0 \\\\
    0 &amp;  n_{m\omega} &amp; 0 \\\\
    0 &amp; 0 &amp; n_{m\omega} \\\\
\end{bmatrix} \\\\
\space \\\\
\mathbf{N}_{ba} = \begin{bmatrix}
    n_{ba} &amp; 0 &amp; 0 \\\\
    0 &amp;  n_{ba} &amp; 0 \\\\
    0 &amp; 0 &amp; n_{ba} \\\\
\end{bmatrix}
, \qquad
\mathbf{N}_{b\omega} = \begin{bmatrix}
    n_{b\omega} &amp; 0 &amp; 0 \\\\
    0 &amp;  n_{b\omega} &amp; 0 \\\\
    0 &amp; 0 &amp; n_{b\omega} \\\\
\end{bmatrix}
\]</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1">// acc_n: 0.08          # accelerometer measurement noise standard deviation. #0.2   0.04</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="c1">// gyr_n: 0.004         # gyroscope measurement noise standard deviation.     #0.05  0.004</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="c1">// acc_w: 0.00004         # accelerometer bias random work noise standard deviation.  #0.02</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1">// gyr_w: 2.0e-6       # gyroscope bias random work noise standard deviation.     #4.0e-5</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="o">&gt;::</span><span class="n">Zero</span><span class="p">();</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="n">noise</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">ACC_N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ACC_N</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">noise</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">GYR_N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">GYR_N</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="n">noise</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">ACC_N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ACC_N</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="n">noise</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">GYR_N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">GYR_N</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="n">noise</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">ACC_W</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ACC_W</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="n">noise</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">GYR_W</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">GYR_W</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
</code></pre></div>
<p>IMU readings get processed in <code>processIMU(...)</code> and <code>slideWindow()</code> where IMU readings are <code>push_back</code>ed to preintegration.
One IMU reading is comprised of <code>linear_acceleration</code> and <code>angular_velocity</code> as well as the elapsed time <code>dt</code> to next IMU reading.</p>
<p><code>push_back</code>/<code>propagate</code> takes this time IMU reading <code>_acc_1</code> <span class="arithmatex">\(\hat{\mathbf{a}}_{t}\)</span> and <code>_gyr_1</code> <span class="arithmatex">\(\hat{\mathbf{\omega}}_{t}\)</span> and the previous time reading (after preintegration correction) <code>acc_0</code> <span class="arithmatex">\({\mathbf{a}}_{t-1}\)</span> and <code>gyr_0</code> <span class="arithmatex">\({\mathbf{\omega}}_{t}\)</span> to compute the differences between this and the previous: <code>result_delta_p, result_delta_q, result_delta_v, result_linearized_ba, result_linearized_bg</code> for <span class="arithmatex">\(\Delta \mathbf{p}, \Delta \mathbf{\theta}, \Delta \mathbf{v}, \Delta \mathbf{b}_a, \Delta \mathbf{b}_\omega\)</span>, representing changes of position, orientation, velocity, linear acceleration bias and angular/gyro velocity bias.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Estimator::processIMU</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linear_acceleration</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">angular_velocity</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="n">pre_integrations</span><span class="p">[</span><span class="n">frame_count</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">linear_acceleration</span><span class="p">,</span><span class="w"> </span><span class="n">angular_velocity</span><span class="p">);</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="n">tmp_pre_integration</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">linear_acceleration</span><span class="p">,</span><span class="w"> </span><span class="n">angular_velocity</span><span class="p">);</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="p">}</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Estimator::slideWindow</span><span class="p">()</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="p">{</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">    </span><span class="n">pre_integrations</span><span class="p">[</span><span class="n">frame_count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_dt</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_linear_acceleration</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_angular_velocity</span><span class="p">);</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="p">}</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="kt">void</span><span class="w"> </span><span class="nf">IntegrationBase::push_back</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gyr</span><span class="p">)</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="p">{</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">    </span><span class="n">dt_buf</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">dt</span><span class="p">);</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">    </span><span class="n">acc_buf</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">acc</span><span class="p">);</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">    </span><span class="n">gyr_buf</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">gyr</span><span class="p">);</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">    </span><span class="n">propagate</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">gyr</span><span class="p">);</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="p">}</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="kt">void</span><span class="w"> </span><span class="nf">IntegrationBase::propagate</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">_dt</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_acc_1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_gyr_1</span><span class="p">)</span>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="p">{</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">    </span><span class="n">midPointIntegration</span><span class="p">(</span><span class="n">_dt</span><span class="p">,</span><span class="w"> </span><span class="n">acc_0</span><span class="p">,</span><span class="w"> </span><span class="n">gyr_0</span><span class="p">,</span><span class="w"> </span><span class="n">_acc_1</span><span class="p">,</span><span class="w"> </span><span class="n">_gyr_1</span><span class="p">,</span><span class="w"> </span><span class="n">delta_p</span><span class="p">,</span><span class="w"> </span><span class="n">delta_q</span><span class="p">,</span><span class="w"> </span><span class="n">delta_v</span><span class="p">,</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">                            </span><span class="n">linearized_ba</span><span class="p">,</span><span class="w"> </span><span class="n">linearized_bg</span><span class="p">,</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">                            </span><span class="n">result_delta_p</span><span class="p">,</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">,</span><span class="w"> </span><span class="n">result_delta_v</span><span class="p">,</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">                            </span><span class="n">result_linearized_ba</span><span class="p">,</span><span class="w"> </span><span class="n">result_linearized_bg</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">    </span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="w">    </span><span class="n">delta_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result_delta_p</span><span class="p">;</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">    </span><span class="n">delta_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">;</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="w">    </span><span class="n">delta_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result_delta_v</span><span class="p">;</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="w">    </span><span class="n">linearized_ba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result_linearized_ba</span><span class="p">;</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="w">    </span><span class="n">linearized_bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result_linearized_bg</span><span class="p">;</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="w">    </span><span class="n">delta_q</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="w">    </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="w">    </span><span class="n">acc_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_acc_1</span><span class="p">;</span>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="w">    </span><span class="n">gyr_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_gyr_1</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="p">}</span>
</code></pre></div>
where <code>midPointIntegration(...)</code> computes <span class="arithmatex">\(\Delta \mathbf{p}, \Delta \mathbf{\theta}, \Delta \mathbf{v}, \Delta \mathbf{b}_a, \Delta \mathbf{b}_\omega\)</span> and the Jacobian <span class="arithmatex">\(\mathbf{J}\)</span> as well as covariance.</p>
<div class="arithmatex">\[
\begin{align*}
    \hat{\mathbf{a}}_{t, t-1} &amp;= (\Delta \mathbf{\omega}_{t-1})_\mathbf{Q} (\mathbf{a}_{t-1} - \mathbf{b}_{a})
    \qquad&amp;&amp; (.)_\mathbf{Q} \text{ denotes quaternion rotating a vector} \\\\
    \mathbf{\omega}_t &amp;= \frac{1}{2} (\mathbf{\omega}_{t-1} + \hat{\mathbf{\omega}}_{t}) - \mathbf{b}_{\omega} \\\\
    \Delta \mathbf{\theta}_{t} &amp;= \Delta \mathbf{\theta}_{t-1} \otimes \begin{bmatrix}
        1 \\\\
        \frac{1}{2} \mathbf{\omega}_t \cdot \delta t
    \end{bmatrix} 
    \qquad&amp;&amp; \otimes \text{ denotes quaternion multiplication}
    \\\\ &amp; &amp;&amp; \frac{1}{2} \mathbf{\omega}_t \cdot \delta t \text{ is right perturbation} \\\\
    \hat{\mathbf{a}}_{t,t} &amp;= (\Delta \mathbf{\theta}_{t})_{\mathbf{Q}} (\hat{\mathbf{a}}_{t} - \mathbf{b}_a) \\\\
    \mathbf{a}_{t} &amp;= \frac{1}{2} (\hat{\mathbf{a}}_{t,t} + \hat{\mathbf{a}}_{t, t-1}) \\\\
    \Delta\mathbf{p}_{j, t} &amp;= \Delta \mathbf{p}_{j, t-1} + \Delta \mathbf{v}_{j, t-1} \cdot \delta t + \frac{1}{2} \mathbf{a}_{t} (\delta t)^2 \\\\
    \Delta \mathbf{v}_{j, t} &amp;= \Delta \mathbf{v}_{j, t-1} + \mathbf{a}_{j, t} \cdot \delta t 
\end{align*}
\]</div>
<p>Rewrite some vectors to matrix representations</p>
<div class="arithmatex">\[
\begin{align*}
R_{\omega} &amp;= \begin{bmatrix}
    0 &amp; -{\omega}_z &amp; {\omega}_y \\\\
    {\omega}_z &amp; 0 &amp; -{\omega}_x \\\\
    -{\omega}_y &amp; {\omega}_x &amp; 0 \\\\
\end{bmatrix}
,\qquad
R_{a,t-1} = \begin{bmatrix}
    0 &amp; -{a}_{t-1,z} &amp; {a}_{t-1,y} \\\\
    {a}_{t-1,z} &amp; 0 &amp; -{a}_{t-1,x} \\\\
    -{a}_{t-1,y} &amp; {a}_{t-1,x} &amp; 0 \\\\
\end{bmatrix}
,\qquad
R_{a,t} = \begin{bmatrix}
    0 &amp; -{a}_{t,z} &amp; {a}_{t,y} \\\\
    {a}_{t,z} &amp; 0 &amp; -{a}_{t,x} \\\\
    -{a}_{t,y} &amp; {a}_{t,x} &amp; 0 \\\\
\end{bmatrix} \\\\
\space\\\\
R_{\Delta \theta} :&amp;= \text{Quaternion }\Delta \theta \rightarrow \text{RotationMatrix } R_{\Delta \theta} 
\end{align*}
\]</div>
<p>The Jacobian <span class="arithmatex">\(\mathbf{J}\)</span> is updated such as <span class="arithmatex">\(\mathbf{J}_{t}=\mathbf{F}\mathbf{J}_{t-1}= \big(\mathbf{I}+\hat{\mathbf{J}}_t \cdot(\delta t) \big)\mathbf{J}_{t-1}\)</span>,
where <span class="arithmatex">\(\hat{\mathbf{J}}\)</span> is the Jacobian, and <span class="arithmatex">\(\delta t\)</span> is the time interval between two IMU readings.</p>
<div class="arithmatex">\[
\hat{\mathbf{J}} = \begin{bmatrix}
    \frac{\partial \Delta\mathbf{p}}{\partial \Delta\mathbf{p}} 
    &amp; \frac{\partial \Delta\mathbf{p}}{\partial \Delta\mathbf{\theta}} 
    &amp; \frac{\partial \Delta\mathbf{p}}{\partial \Delta\mathbf{v}} 
    &amp; \frac{\partial \Delta\mathbf{p}}{\partial \mathbf{b}_a} 
    &amp; \frac{\partial \Delta\mathbf{p}}{\partial \mathbf{b}_\omega}  \\\\
    \frac{\partial \Delta\mathbf{\theta}}{\partial \Delta\mathbf{p}} 
    &amp; \frac{\partial \Delta\mathbf{\theta}}{\partial \Delta\mathbf{\theta}} 
    &amp; \frac{\partial \Delta\mathbf{\theta}}{\partial \Delta\mathbf{v}} 
    &amp; \frac{\partial \Delta\mathbf{\theta}}{\partial \mathbf{b}_a} 
    &amp; \frac{\partial \Delta\mathbf{\theta}}{\partial \mathbf{b}_\omega}  \\\\
    \frac{\partial \Delta\mathbf{v}}{\partial \Delta\mathbf{p}} 
    &amp; \frac{\partial \Delta\mathbf{v}}{\partial \Delta\mathbf{\theta}} 
    &amp; \frac{\partial \Delta\mathbf{v}}{\partial \Delta\mathbf{v}} 
    &amp; \frac{\partial \Delta\mathbf{v}}{\partial \mathbf{b}_a} 
    &amp; \frac{\partial \Delta\mathbf{v}}{\partial \mathbf{b}_\omega}  \\\\
    \frac{\partial \mathbf{b}_a}{\partial \Delta\mathbf{p}} 
    &amp; \frac{\partial \mathbf{b}_a}{\partial \Delta\mathbf{\theta}} 
    &amp; \frac{\partial \mathbf{b}_a}{\partial \Delta\mathbf{v}} 
    &amp; \frac{\partial \mathbf{b}_a}{\partial \mathbf{b}_a} 
    &amp; \frac{\partial \mathbf{b}_a}{\partial \mathbf{b}_\omega}  \\\\
    \frac{\partial \mathbf{b}_{\omega}}{\partial \Delta\mathbf{p}} 
    &amp; \frac{\partial \mathbf{b}_{\omega}}{\partial \Delta\mathbf{\theta}} 
    &amp; \frac{\partial \mathbf{b}_{\omega}}{\partial \Delta\mathbf{v}} 
    &amp; \frac{\partial \mathbf{b}_{\omega}}{\partial \mathbf{b}_a} 
    &amp; \frac{\partial \mathbf{b}_{\omega}}{\partial \mathbf{b}_\omega} 
\end{bmatrix}
\]</div>
<p>Accordingly, <span class="arithmatex">\(\mathbf{F}\)</span> can be computed as below</p>
<div class="arithmatex">\[
\mathbf{F}_{15 \times 15} = \begin{bmatrix}
    \mathbf{I}_{3 \times 3} 
    &amp; -\frac{1}{4} \Big( R_{\Delta \theta, t-1} R_{a,t-1} +  R_{\Delta \theta, t} R_{a,t} \big(\mathbf{I}_{3 \times 3} - R_{\omega}\cdot (\delta t) \big) \Big) \cdot (\delta t)^2 
    &amp; \mathbf{I}_{3 \times 3} \cdot (\delta t)
    &amp; -\frac{1}{4} (R_{\Delta \theta, t-1} + R_{\Delta \theta,t} ) \cdot (\delta t)^2 
    &amp; -\frac{1}{4} R_{\Delta \theta, t} R_{a,t} \cdot (\delta t)^2 \cdot (-\delta t) \\\\
    \mathbf{0}_{3 \times 3}
    &amp; \mathbf{I}_{3 \times 3} - R_{\omega}\cdot (\delta t)
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; - \mathbf{I}_{3 \times 3} \cdot (\delta t) \\\\
    \mathbf{0}_{3 \times 3}
    &amp; -\frac{1}{2} \Big(R_{\Delta \theta, t-1} R_{a,t-1} + R_{\Delta \theta, t} R_{a,t} \big(\mathbf{I}_{3 \times 3} - R_{\omega}\cdot (\delta t) \big) \Big) \cdot (\delta t)
    &amp; \mathbf{I}_{3 \times 3} 
    &amp; -\frac{1}{2} (R_{\Delta \theta, t-1} + R_{\Delta \theta,t} ) \cdot (\delta t)
    &amp; -\frac{1}{2} R_{\Delta \theta, t} R_{a,t} \cdot (\delta t) \cdot (-\delta t) \\\\
    \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{I}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3} \\\\
    \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{I}_{3 \times 3}
\end{bmatrix}
\]</div>
<p>VINS uses the below list of linear approximations to integrate noises over the time <span class="arithmatex">\(\tau \in \delta t\)</span> between two IMU readings.</p>
<ul>
<li>Acceleration measurement noise approximation for position change over the time <span class="arithmatex">\(\tau \in \delta t\)</span> (denoted in the first-row first-col position of <span class="arithmatex">\(\mathbf{V}\)</span> in below) is done by integrating the previous rotation change: <span class="arithmatex">\(\big( \frac{1}{4} R_{\Delta \theta, t-1} \cdot (\delta t)^2 \big) \mathbf{N}_{ma}   = \int \int_{\tau \in \delta t} \big( R_{\Delta \theta, t-1}\mathbf{N}_{ma} \big) d\tau^2\)</span></li>
<li>Rotation measurement noise approximation for position change over the time <span class="arithmatex">\(\tau \in \delta t\)</span> (denoted in the first-row second-col position of <span class="arithmatex">\(\mathbf{V}\)</span> in below) is done by integrating the previous halfway rotation change multiplying the current acceleration: <span class="arithmatex">\(\big( \frac{1}{4} R_{\Delta \theta, t} \cdot (\delta t)^2 \big) \mathbf{N}_{m\omega} = \int \int_{\tau \in \delta t} \big(-R_{\Delta \theta, t} R_{a,t} \cdot \frac{1}{2}\delta t \mathbf{N}_{m\omega} \big) d\tau^2\)</span></li>
<li>... (the same rules go with other noise terms)</li>
<li>Acceleration bias noise approximation for acceleration bias itself over the time <span class="arithmatex">\(\tau \in \delta t\)</span> is simply the linear increment <span class="arithmatex">\(\big( \mathbf{I}_{3 \times 3} \cdot (\delta t) \big) \mathbf{N}_{ba} = \int_{\tau \in \delta t} \mathbf{N}_{ba} d\tau\)</span></li>
<li>Similarly for rotation bias noise approximation, there is <span class="arithmatex">\(\big( \mathbf{I}_{3 \times 3} \cdot (\delta t) \big) \mathbf{N}_{b\omega} = \int_{\tau \in \delta t} \mathbf{N}_{b\omega} d\tau\)</span></li>
</ul>
<p>Take away the noise terms <span class="arithmatex">\(\mathbf{N}\)</span>, the noise approximation matrix <span class="arithmatex">\(\mathbf{V}\)</span> can be expressed as below.</p>
<div class="arithmatex">\[
\mathbf{V}_{15 \times 18} = \begin{bmatrix}
    \frac{1}{4} R_{\Delta \theta, t-1} \cdot (\delta t)^2 
    &amp; -\frac{1}{4} R_{\Delta \theta, t} R_{a,t} \cdot (\delta t)^2 \cdot \frac{1}{2}\delta t
    &amp; \frac{1}{4} R_{\Delta \theta, t} \cdot (\delta t)^2
    &amp; -\frac{1}{4} R_{\Delta \theta, t} R_{a,t} \cdot (\delta t)^2 \cdot \frac{1}{2}\delta t
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3} \\\\
    \mathbf{0}_{3 \times 3}
    &amp; \frac{1}{2} \mathbf{I}_{3 \times 3} \cdot (\delta t)
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \frac{1}{2} \mathbf{I}_{3 \times 3} \cdot (\delta t)
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3} \\\\
    \frac{1}{2}R_{\Delta \theta, t-1} \cdot (\delta t)
    &amp; -\frac{1}{2} R_{\Delta \theta, t} R_{a,t} \cdot (\delta t) \cdot \frac{1}{2}\delta t
    &amp; \frac{1}{2} R_{\Delta \theta, t} \cdot (\delta t)
    &amp; -\frac{1}{2} R_{\Delta \theta, t} R_{a,t} \cdot (\delta t) \cdot \frac{1}{2}\delta t
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3} \\\\
    \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{I}_{3 \times 3} \cdot (\delta t)
    &amp; \mathbf{0}_{3 \times 3} \\\\
    \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{0}_{3 \times 3}
    &amp; \mathbf{I}_{3 \times 3} \cdot (\delta t)
\end{bmatrix}
\]</div>
<p>Covariance update is (when started, the covariance is set to zero to begin with <span class="arithmatex">\(\mathbf{\Sigma}_0=\mathbf{0}\)</span>)</p>
<div class="arithmatex">\[
\mathbf{\Sigma}_t = 
\mathbf{F} \mathbf{\Sigma}_{t-1} \mathbf{F}^\top+
\mathbf{V} \mathbf{N} \mathbf{V}^{\top}
\]</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">IntegrationBase::midPointIntegration</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">_dt</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_acc_0</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_gyr_0</span><span class="p">,</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_acc_1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_gyr_1</span><span class="p">,</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">delta_p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="o">&amp;</span><span class="n">delta_q</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">delta_v</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linearized_ba</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linearized_bg</span><span class="p">,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">                        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result_delta_p</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result_delta_q</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result_delta_v</span><span class="p">,</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">                        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result_linearized_ba</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result_linearized_bg</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">update_jacobian</span><span class="p">)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="p">{</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_acc_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_acc_0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_ba</span><span class="p">);</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_gyr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_gyr_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_gyr_1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_bg</span><span class="p">;</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="n">result_delta_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Quaterniond</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">un_gyr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">un_gyr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">un_gyr</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_acc_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result_delta_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_acc_1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_ba</span><span class="p">);</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">un_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">un_acc_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">un_acc_1</span><span class="p">);</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="n">result_delta_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">delta_v</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">un_acc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">    </span><span class="n">result_delta_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_v</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">un_acc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="n">result_linearized_ba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linearized_ba</span><span class="p">;</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">    </span><span class="n">result_linearized_bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linearized_bg</span><span class="p">;</span><span class="w">         </span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">update_jacobian</span><span class="p">)</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">w_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_gyr_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_gyr_1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_bg</span><span class="p">;</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">a_0_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_acc_0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_ba</span><span class="p">;</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">a_1_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_acc_1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_ba</span><span class="p">;</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="w">        </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R_w_x</span><span class="p">,</span><span class="w"> </span><span class="n">R_a_0_x</span><span class="p">,</span><span class="w"> </span><span class="n">R_a_1_x</span><span class="p">;</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="w">        </span><span class="n">R_w_x</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">w_x</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">w_x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">            </span><span class="n">w_x</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">w_x</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="w">            </span><span class="o">-</span><span class="n">w_x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">w_x</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">        </span><span class="n">R_a_0_x</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">a_0_x</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">a_0_x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">            </span><span class="n">a_0_x</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">a_0_x</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">            </span><span class="o">-</span><span class="n">a_0_x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">a_0_x</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="w">        </span><span class="n">R_a_1_x</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">a_1_x</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">a_1_x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="w">            </span><span class="n">a_1_x</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">a_1_x</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="w">            </span><span class="o">-</span><span class="n">a_1_x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">a_1_x</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="w">        </span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Zero</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">);</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_0_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="w">                              </span><span class="mf">-0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_1_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">R_w_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">())</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_1_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">-</span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">R_w_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_0_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="w">                              </span><span class="mf">-0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_1_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">R_w_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">())</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_1_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">-</span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>
<a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a><span class="w">        </span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Zero</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">);</span>
<a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">-</span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_1_x</span><span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">-</span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R_a_1_x</span><span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result_delta_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a><span class="w">        </span><span class="n">V</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MatrixXd</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_dt</span><span class="p">;</span>
<a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>
<a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a><span class="w">        </span><span class="n">jacobian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobian</span><span class="p">;</span>
<a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a><span class="w">        </span><span class="n">covariance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">covariance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">noise</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">V</span><span class="p">.</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a>
<a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a><span class="p">}</span>
</code></pre></div>
<h3 id="imu-residuals-and-jacobians">IMU Residuals and Jacobians</h3>
<div class="arithmatex">\[
\min_{\mathcal{X}}
\underbrace{\sum_{k_i \in \mathcal{B}} 
\Big|\Big|
    \mathbf{r}_\mathcal{B} ( \hat{\mathbf{z}}_{\tiny{BK}} ,\mathbf{\mathcal{X}} )
\Big|\Big|^2}_{
\text{IMU measurement residuals}}
\]</div>
<p>The residual <code>Eigen::Matrix&lt;double, 15, 1&gt; residuals;</code> <span class="arithmatex">\(\mathbf{r} \in \mathbb{R}^{15}\)</span> is defined as the differences between two preintegrated IMU results from two frames: the <span class="arithmatex">\(i\)</span>-th and the <span class="arithmatex">\(j\)</span>-th frame.
The parameters to be optimized:</p>
<div class="arithmatex">\[
\mathbf{p}_i \in \mathbb{R}^3, \qquad
\mathbf{\theta}_i \in \mathbb{R}^4, \qquad
\mathbf{v}_i \in \mathbb{R}^3, \qquad
\mathbf{b}_{a,i} \in \mathbb{R}^3, \qquad
\mathbf{b}_{\omega,i} \in \mathbb{R}^3 \\\\
\mathbf{p}_j \in \mathbb{R}^3, \qquad
\mathbf{\theta}_j \in \mathbb{R}^4, \qquad
\mathbf{v}_j \in \mathbb{R}^3, \qquad
\mathbf{b}_{a,j} \in \mathbb{R}^3, \qquad
\mathbf{b}_{\omega,j} \in \mathbb{R}^3
\]</div>
<p>From <code>jacobian</code> get
$$
    \frac{\partial \mathbf{p}}{\partial \mathbf{b}<em>a} = \mathbf{J}</em>{1:3, 10:12}
, \qquad
    \frac{\partial \mathbf{p}}{\partial \mathbf{b}<em>\omega} = \mathbf{J}</em>{1:3, 13:15}
, \qquad
    \frac{\partial \mathbf{\theta}}{\partial \mathbf{b}<em>\omega} = \mathbf{J}</em>{4:6, 13:15}
, \qquad
    \frac{\partial \mathbf{v}}{\partial \mathbf{b}<em>a} = \mathbf{J}</em>{7:9, 10:12}
, \qquad
    \frac{\partial \mathbf{v}}{\partial \mathbf{b}<em>\omega} = \mathbf{J}</em>{7:9, 13:15}
, \qquad
    \Delta\mathbf{b}<em>a = 
, \qquad
    \Delta\mathbf{b}</em>\omega = 
$$</p>
<p>Compute the corrected <span class="arithmatex">\(\Delta\mathbf{\theta}, \Delta\mathbf{v}, \Delta\mathbf{p}\)</span> considered linearized acceleration and gyro biases.</p>
<div class="arithmatex">\[
\Delta\mathbf{\theta} = \Delta\hat{\mathbf{\theta}} \frac{\partial \mathbf{\theta}}{\partial \mathbf{b}_\omega} \Delta\mathbf{b}_\omega
,\qquad
\Delta\mathbf{v} = \Delta\hat{\mathbf{v}} + \frac{\partial \mathbf{v}}{\partial \mathbf{b}_a} \Delta\mathbf{b}_a + \frac{\partial \mathbf{v}}{\partial \mathbf{b}_\omega} \Delta\mathbf{b}_\omega
, \qquad
\Delta\mathbf{p} = \Delta\hat{\mathbf{p}} + \frac{\partial \mathbf{p}}{\partial \mathbf{b}_a} \Delta\mathbf{b}_a + \frac{\partial \mathbf{p}}{\partial \mathbf{b}_\omega} \Delta\mathbf{b}_\omega
\]</div>
<p>The residual</p>
<div class="arithmatex">\[
\begin{align*}
\mathbf{r}_{1:3} &amp;= 
(\mathbf{\theta}_{i}^{-1} )_{\mathbf{Q}} \big(
    \frac{1}{2} \mathbf{g}_{earth} (\delta t)^2 + \mathbf{p}_j - \mathbf{p}_i - \mathbf{v}_i \cdot (\delta t)
\big)
&amp;&amp; (.)_{\mathbf{Q}} \text{ means quaternion operation} \\\\
\mathbf{r}_{4:6} &amp;= 
\Big((\Delta\mathbf{\theta})_\mathbf{Q} (\mathbf{\theta}_{i}^{-1} )_{\mathbf{Q}} (\mathbf{\theta}_{j} )_{\mathbf{Q}}\Big)_{\mathbf{E}}
&amp;&amp; \text{ Quaternion } (.)_{\mathbf{Q}}  \text{ to Euler } (.)_{\mathbf{E}}: \quad \mathbb{R}^4 \rightarrow \mathbb{R}^3 \\\\
\mathbf{r}_{7:9} &amp;= 
(\mathbf{\theta}_{i}^{-1} )_{\mathbf{Q}} \big(
    \mathbf{g}_{earth} (\delta t) + \mathbf{v}_j - \mathbf{v}_i - \Delta\mathbf{v}
\big) \\\\
\mathbf{r}_{10:12} &amp;= \mathbf{b}_{a,j} - \mathbf{b}_{a,i} \\\\
\mathbf{r}_{13:15} &amp;= \mathbf{b}_{\omega,j} - \mathbf{b}_{\omega,i}
\end{align*}
\]</div>
<p>For the <span class="arithmatex">\(i\)</span>-th frame</p>
<div class="arithmatex">\[
\frac{\partial \mathbf{r}}{\partial (\mathbf{p}_i, \mathbf{\theta}_i)} = \begin{bmatrix}
    \frac{\partial \mathbf{p}_i}{\partial \mathbf{p}_i}
    &amp; \frac{\partial \mathbf{p}_i}{\partial \mathbf{\theta}_i}
    &amp; \mathbf{0}_{1 \times 3} \\\\
    \mathbf{0}_{3 \times 3}
    &amp; \frac{\partial \mathbf{\theta}_i}{\partial \mathbf{\theta}_i}
    &amp; \mathbf{0}_{1 \times 3}
\\\\ 
    \mathbf{0}_{3 \times 3}
    &amp; \frac{\partial \mathbf{v}_i}{\partial \mathbf{\theta}_i}
    &amp; \mathbf{0}_{1 \times 3}
\\\\ 
    \mathbf{0}_{6 \times 3}
    &amp; \mathbf{0}_{6 \times 3}
    &amp; \mathbf{0}_{1 \times 3}
\end{bmatrix}
\]</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">StateOrder</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="n">O_P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="n">O_R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="n">O_V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="n">O_BA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="n">O_BG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">};</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">IMUFactor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">SizedCostFunction</span><span class="o">&lt;</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Evaluate</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">residuals</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">jacobians</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">        </span><span class="c1">// take IMU data</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Pi</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">Qi</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Vi</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Bai</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Bgi</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">8</span><span class="p">]);</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Pj</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">Qj</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Vj</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Baj</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Bgj</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">]);</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">residual</span><span class="p">(</span><span class="n">residuals</span><span class="p">);</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">        </span><span class="c1">// IntegrationBase::evaluate(...)</span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w">        </span><span class="n">residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Pi</span><span class="p">,</span><span class="w"> </span><span class="n">Qi</span><span class="p">,</span><span class="w"> </span><span class="n">Vi</span><span class="p">,</span><span class="w"> </span><span class="n">Bai</span><span class="p">,</span><span class="w"> </span><span class="n">Bgi</span><span class="p">,</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w">                                            </span><span class="n">Pj</span><span class="p">,</span><span class="w"> </span><span class="n">Qj</span><span class="p">,</span><span class="w"> </span><span class="n">Vj</span><span class="p">,</span><span class="w"> </span><span class="n">Baj</span><span class="p">,</span><span class="w"> </span><span class="n">Bgj</span><span class="p">);</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">        </span><span class="c1">// Standard Cholesky decomposition (LL^T) of a matrix and associated features.</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">LLT</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">covariance</span><span class="p">.</span><span class="n">inverse</span><span class="p">()).</span><span class="n">matrixL</span><span class="p">().</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w">        </span><span class="n">residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">residual</span><span class="p">;</span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">sum_dt</span><span class="p">;</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dp_dba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">jacobian</span><span class="p">.</span><span class="k">template</span><span class="w"> </span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="p">);</span>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dp_dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">jacobian</span><span class="p">.</span><span class="k">template</span><span class="w"> </span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="p">);</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dq_dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">jacobian</span><span class="p">.</span><span class="k">template</span><span class="w"> </span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_R</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="p">);</span>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dv_dba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">jacobian</span><span class="p">.</span><span class="k">template</span><span class="w"> </span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="p">);</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dv_dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">jacobian</span><span class="p">.</span><span class="k">template</span><span class="w"> </span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="p">);</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian_pose_i</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a>
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">().</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_R</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">skewSymmetric</span><span class="p">(</span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Pj</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Pi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="p">));</span>
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a>
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">corrected_delta_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">delta_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">deltaQ</span><span class="p">(</span><span class="n">dq_dbg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Bgi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">linearized_bg</span><span class="p">));</span>
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_R</span><span class="p">,</span><span class="w"> </span><span class="n">O_R</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">Utility</span><span class="o">::</span><span class="n">Qleft</span><span class="p">(</span><span class="n">Qj</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Qi</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">Qright</span><span class="p">(</span><span class="n">corrected_delta_q</span><span class="p">)).</span><span class="n">bottomRightCorner</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a>
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_R</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">skewSymmetric</span><span class="p">(</span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">G</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vj</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vi</span><span class="p">));</span>
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobian_pose_i</span><span class="p">;</span>
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a>
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">maxCoeff</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1e8</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">minCoeff</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">-1e8</span><span class="p">)</span>
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a><span class="w">                </span><span class="n">ROS_WARN</span><span class="p">(</span><span class="s">&quot;numerical unstable in preintegration&quot;</span><span class="p">);</span>
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a><span class="w">                </span><span class="c1">//std::cout &lt;&lt; sqrt_info &lt;&lt; std::endl;</span>
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a><span class="w">                </span><span class="c1">//ROS_BREAK();</span>
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian_speedbias_i</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_V</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">().</span><span class="n">toRotationMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="p">;</span>
<a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">dp_dba</span><span class="p">;</span>
<a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">dp_dbg</span><span class="p">;</span>
<a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a>
<a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_R</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Utility</span><span class="o">::</span><span class="n">Qleft</span><span class="p">(</span><span class="n">Qj</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Qi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">delta_q</span><span class="p">).</span><span class="n">bottomRightCorner</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dq_dbg</span><span class="p">;</span>
<a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a>
<a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_V</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">().</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">dv_dba</span><span class="p">;</span>
<a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">dv_dbg</span><span class="p">;</span>
<a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a>
<a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_BA</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a>
<a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_BG</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a>
<a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a><span class="w">            </span><span class="n">jacobian_speedbias_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobian_speedbias_i</span><span class="p">;</span>
<a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian_pose_j</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a><span class="w">            </span><span class="n">jacobian_pose_j</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a>
<a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a><span class="w">            </span><span class="n">jacobian_pose_j</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">().</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a>
<a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">corrected_delta_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">delta_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">deltaQ</span><span class="p">(</span><span class="n">dq_dbg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Bgi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pre_integration</span><span class="o">-&gt;</span><span class="n">linearized_bg</span><span class="p">));</span>
<a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a><span class="w">            </span><span class="n">jacobian_pose_j</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_R</span><span class="p">,</span><span class="w"> </span><span class="n">O_R</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">Qleft</span><span class="p">(</span><span class="n">corrected_delta_q</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Qj</span><span class="p">).</span><span class="n">bottomRightCorner</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a>
<a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a><span class="w">            </span><span class="n">jacobian_pose_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobian_pose_j</span><span class="p">;</span>
<a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian_speedbias_j</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a><span class="w">            </span><span class="n">jacobian_speedbias_j</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a>
<a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a><span class="w">            </span><span class="n">jacobian_speedbias_j</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_V</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">().</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a>
<a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a><span class="w">            </span><span class="n">jacobian_speedbias_j</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_BA</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a>
<a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a><span class="w">            </span><span class="n">jacobian_speedbias_j</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_BG</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O_V</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a>
<a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a><span class="w">            </span><span class="n">jacobian_speedbias_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jacobian_speedbias_j</span><span class="p">;</span>
<a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a><span class="p">}</span>
<a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a>
<a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">IntegrationBase</span><span class="o">::</span><span class="n">evaluate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pi</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Qi</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a><span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Vi</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Bai</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Bgi</span><span class="p">,</span>
<a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a><span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pj</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Qj</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Vj</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Baj</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Bgj</span><span class="p">)</span>
<a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a><span class="p">{</span>
<a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">residuals</span><span class="p">;</span>
<a id="__codelineno-21-122" name="__codelineno-21-122" href="#__codelineno-21-122"></a>
<a id="__codelineno-21-123" name="__codelineno-21-123" href="#__codelineno-21-123"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dp_dba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jacobian</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="p">);</span>
<a id="__codelineno-21-124" name="__codelineno-21-124" href="#__codelineno-21-124"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dp_dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jacobian</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="p">);</span>
<a id="__codelineno-21-125" name="__codelineno-21-125" href="#__codelineno-21-125"></a>
<a id="__codelineno-21-126" name="__codelineno-21-126" href="#__codelineno-21-126"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dq_dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jacobian</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_R</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="p">);</span>
<a id="__codelineno-21-127" name="__codelineno-21-127" href="#__codelineno-21-127"></a>
<a id="__codelineno-21-128" name="__codelineno-21-128" href="#__codelineno-21-128"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dv_dba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jacobian</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_BA</span><span class="p">);</span>
<a id="__codelineno-21-129" name="__codelineno-21-129" href="#__codelineno-21-129"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">dv_dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jacobian</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="n">O_BG</span><span class="p">);</span>
<a id="__codelineno-21-130" name="__codelineno-21-130" href="#__codelineno-21-130"></a>
<a id="__codelineno-21-131" name="__codelineno-21-131" href="#__codelineno-21-131"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">dba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bai</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_ba</span><span class="p">;</span>
<a id="__codelineno-21-132" name="__codelineno-21-132" href="#__codelineno-21-132"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">dbg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bgi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linearized_bg</span><span class="p">;</span>
<a id="__codelineno-21-133" name="__codelineno-21-133" href="#__codelineno-21-133"></a>
<a id="__codelineno-21-134" name="__codelineno-21-134" href="#__codelineno-21-134"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">corrected_delta_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">deltaQ</span><span class="p">(</span><span class="n">dq_dbg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dbg</span><span class="p">);</span>
<a id="__codelineno-21-135" name="__codelineno-21-135" href="#__codelineno-21-135"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">corrected_delta_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_v</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dv_dba</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dba</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dv_dbg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dbg</span><span class="p">;</span>
<a id="__codelineno-21-136" name="__codelineno-21-136" href="#__codelineno-21-136"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">corrected_delta_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dp_dba</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dba</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dp_dbg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dbg</span><span class="p">;</span>
<a id="__codelineno-21-137" name="__codelineno-21-137" href="#__codelineno-21-137"></a>
<a id="__codelineno-21-138" name="__codelineno-21-138" href="#__codelineno-21-138"></a><span class="w">    </span><span class="n">residuals</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_P</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Pj</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Pi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corrected_delta_p</span><span class="p">;</span>
<a id="__codelineno-21-139" name="__codelineno-21-139" href="#__codelineno-21-139"></a><span class="w">    </span><span class="n">residuals</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_R</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">corrected_delta_q</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Qj</span><span class="p">)).</span><span class="n">vec</span><span class="p">();</span>
<a id="__codelineno-21-140" name="__codelineno-21-140" href="#__codelineno-21-140"></a><span class="w">    </span><span class="n">residuals</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_V</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qi</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">G</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vj</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vi</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corrected_delta_v</span><span class="p">;</span>
<a id="__codelineno-21-141" name="__codelineno-21-141" href="#__codelineno-21-141"></a><span class="w">    </span><span class="n">residuals</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_BA</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Baj</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bai</span><span class="p">;</span>
<a id="__codelineno-21-142" name="__codelineno-21-142" href="#__codelineno-21-142"></a><span class="w">    </span><span class="n">residuals</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">O_BG</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bgj</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bgi</span><span class="p">;</span>
<a id="__codelineno-21-143" name="__codelineno-21-143" href="#__codelineno-21-143"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">residuals</span><span class="p">;</span>
<a id="__codelineno-21-144" name="__codelineno-21-144" href="#__codelineno-21-144"></a><span class="p">}</span>
</code></pre></div>
<h2 id="reprojection-error">Reprojection Error</h2>
<p>Reprojection cost function takes two frames' estimated 3d world points <code>pts_i</code> and <code>pts_j</code>, transformed by camera extrinsics and relative transform betweeb the <span class="arithmatex">\(i\)</span>-th and <span class="arithmatex">\(j\)</span>-th poses, should see the two points <code>pts_i</code> and <code>pts_j</code> have the same pixel location <span class="arithmatex">\((u, v)\)</span>.
The difference is the residual, to be reduced by adjusting IMU poses.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">ProjectionFactor</span><span class="o">::</span><span class="n">ProjectionFactor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_pts_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_pts_j</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="n">pts_i</span><span class="p">(</span><span class="n">_pts_i</span><span class="p">),</span><span class="w"> </span><span class="n">pts_j</span><span class="p">(</span><span class="n">_pts_j</span><span class="p">)</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Estimator::optimization</span><span class="p">()</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="p">{</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f_manager</span><span class="p">.</span><span class="n">feature</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">imu_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">start_frame</span><span class="p">;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">imu_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">point</span><span class="p">;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">it_per_frame</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">it_per_id</span><span class="p">.</span><span class="n">feature_per_frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">            </span><span class="p">...</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it_per_frame</span><span class="p">.</span><span class="n">point</span><span class="p">;</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">            </span><span class="n">ProjectionFactor</span><span class="w"> </span><span class="o">*</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProjectionFactor</span><span class="p">(</span><span class="n">pts_i</span><span class="p">,</span><span class="w"> </span><span class="n">pts_j</span><span class="p">);</span><span class="w">   </span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">            </span><span class="n">problem</span><span class="p">.</span><span class="n">AddResidualBlock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">loss_function</span><span class="p">,</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">imu_i</span><span class="p">],</span><span class="w"> </span><span class="n">para_Pose</span><span class="p">[</span><span class="n">imu_j</span><span class="p">],</span><span class="w"> </span><span class="n">para_Ex_Pose</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">para_Feature</span><span class="p">[</span><span class="n">feature_index</span><span class="p">]);</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">            </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="p">}</span>
</code></pre></div>
<p>Optionally, VINS provides <code>ProjectionTdFactor(...)</code> that takes into account camera extrinsics besides adjusting for IMU poses.
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">ProjectionTdFactor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_pts_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_pts_j</span><span class="p">,</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_velocity_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_velocity_j</span><span class="p">,</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">_td_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">_td_j</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">_row_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">_row_j</span><span class="p">);</span>
</code></pre></div></p>
<div class="arithmatex">\[
\begin{align*}
\mathbf{x}_{imu,i} &amp;= (\mathbf{\theta}_{ce})_{\mathbf{Q}} (\mathbf{x}_{cam,i} / d_i) + \mathbf{t}_{ce}
\\\\    
\mathbf{X}_{world} &amp;= (\mathbf{\theta}_i)_{\mathbf{Q}} \mathbf{x}_{imu,i} + \mathbf{p}_i \\\\
\mathbf{x}_{imu,j} &amp;= (\mathbf{\theta}_j^{-1})_{\mathbf{Q}} (\mathbf{X}_{world} - \mathbf{p}_j) \\\\
\hat{\mathbf{x}}_{cam,j} &amp;= (\mathbf{\theta}_{ce}^{-1})_{\mathbf{Q}} (\mathbf{x}_{imu,j} - \mathbf{t}_{ce})
\end{align*}
\]</div>
<p>The residual is defined as <span class="arithmatex">\(\mathbf{r}_{proj,cam,j} = \big(d_j\hat{\mathbf{x}}_{cam,j} - \mathbf{x}_{cam,j} \big)_{1:2}\)</span>, where <span class="arithmatex">\(\space_{1:2}\)</span> represents taking the first two elements <span class="arithmatex">\((u, v)\)</span>. </p>
<div class="arithmatex">\[
R_r = \begin{bmatrix}
    1/d_j &amp; 0 &amp; \hat{\mathbf{x}}_{cam,j}.x / (d_j^2) \\\\
    0 &amp; 1/d_j &amp; \hat{\mathbf{x}}_{cam,j}.y / (d_j^2)
\end{bmatrix}
\in \mathbb{R}^{2 \times 3}
\]</div>
<div class="arithmatex">\[
\frac{\partial \mathbf{r}_{proj,cam,j} }{\partial (\mathbf{p}_j, \mathbf{\theta}_j)} \in \mathbb{R}^{2 \times 7} = 
R_r 
\begin{bmatrix}
    R_{ec}^{\top} R_j^{\top} 
    &amp; R_{ec}^{\top} R_j^{\top} R_i  \mathbf{x}_{imu,i}^{\wedge}
    &amp; \mathbf{0}_{2 \times 1}
\end{bmatrix}
\]</div>
<p>where <span class="arithmatex">\((\mathbf{p}_j, \mathbf{\theta}_j) \in \mathbb{R}^{7}\)</span> consists of 3d translation elements and 4d quaternion for rotation.
The 4d rotation representation by quaternion is here replaced with rotation matrix that gives a 3d vector, hence the last col is <span class="arithmatex">\(\mathbf{0}_{2 \times 1}\)</span>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1">// tic, ric, sqrt_info, td are defined as static/global variables</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_OF_CAM</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="p">{</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">    </span><span class="n">tic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TIC</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">    </span><span class="n">ric</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RIC</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="p">}</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="n">f_manager</span><span class="p">.</span><span class="n">setRic</span><span class="p">(</span><span class="n">ric</span><span class="p">);</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">ProjectionFactor</span><span class="o">::</span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FOCAL_LENGTH</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Matrix2d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="n">ProjectionTdFactor</span><span class="o">::</span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FOCAL_LENGTH</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Matrix2d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="n">td</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TD</span><span class="p">;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">ProjectionFactor::Evaluate</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">residuals</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">jacobians</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="p">{</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">    </span><span class="n">TicToc</span><span class="w"> </span><span class="n">tic_toc</span><span class="p">;</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Pi</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">Qi</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">Pj</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">Qj</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">tic</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">qic</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">inv_dep_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_camera_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pts_i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">inv_dep_i</span><span class="p">;</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_imu_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qic</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pts_camera_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tic</span><span class="p">;</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pts_imu_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Pi</span><span class="p">;</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_imu_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qj</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">pts_w</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Pj</span><span class="p">);</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">pts_camera_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qic</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">pts_imu_j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tic</span><span class="p">);</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&gt;</span><span class="w"> </span><span class="n">residual</span><span class="p">(</span><span class="n">residuals</span><span class="p">);</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">dep_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pts_camera_j</span><span class="p">.</span><span class="n">z</span><span class="p">();</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="w">    </span><span class="n">residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pts_camera_j</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dep_j</span><span class="p">).</span><span class="n">head</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pts_j</span><span class="p">.</span><span class="n">head</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="w">    </span><span class="n">residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">residual</span><span class="p">;</span>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">)</span>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">Ri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qi</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">Rj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Qj</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">ric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qic</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reduce</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>
<a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a><span class="w">        </span><span class="n">reduce</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dep_j</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pts_camera_j</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">dep_j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dep_j</span><span class="p">),</span>
<a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dep_j</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pts_camera_j</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">dep_j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dep_j</span><span class="p">);</span>
<a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="w">        </span><span class="n">reduce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt_info</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">reduce</span><span class="p">;</span>
<a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a>
<a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian_pose_i</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a>
<a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jaco_i</span><span class="p">;</span>
<a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a><span class="w">            </span><span class="n">jaco_i</span><span class="p">.</span><span class="n">leftCols</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Rj</span><span class="p">.</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a><span class="w">            </span><span class="n">jaco_i</span><span class="p">.</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Rj</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ri</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">-</span><span class="n">Utility</span><span class="o">::</span><span class="n">skewSymmetric</span><span class="p">(</span><span class="n">pts_imu_i</span><span class="p">);</span>
<a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a>
<a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">leftCols</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jaco_i</span><span class="p">;</span>
<a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a><span class="w">            </span><span class="n">jacobian_pose_i</span><span class="p">.</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">().</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a>
<a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian_pose_j</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a>
<a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jaco_j</span><span class="p">;</span>
<a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a><span class="w">            </span><span class="n">jaco_j</span><span class="p">.</span><span class="n">leftCols</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">-</span><span class="n">Rj</span><span class="p">.</span><span class="n">transpose</span><span class="p">();</span>
<a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a><span class="w">            </span><span class="n">jaco_j</span><span class="p">.</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">skewSymmetric</span><span class="p">(</span><span class="n">pts_imu_j</span><span class="p">);</span>
<a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a>
<a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a><span class="w">            </span><span class="n">jacobian_pose_j</span><span class="p">.</span><span class="n">leftCols</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jaco_j</span><span class="p">;</span>
<a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a><span class="w">            </span><span class="n">jacobian_pose_j</span><span class="p">.</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">().</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">RowMajor</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jacobian_ex_pose</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jaco_ex</span><span class="p">;</span>
<a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a><span class="w">            </span><span class="n">jaco_ex</span><span class="p">.</span><span class="n">leftCols</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Rj</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ri</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">());</span>
<a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">tmp_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Rj</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ri</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ric</span><span class="p">;</span>
<a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a><span class="w">            </span><span class="n">jaco_ex</span><span class="p">.</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">tmp_r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">skewSymmetric</span><span class="p">(</span><span class="n">pts_camera_i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">skewSymmetric</span><span class="p">(</span><span class="n">tmp_r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pts_camera_i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a><span class="w">                                     </span><span class="n">Utility</span><span class="o">::</span><span class="n">skewSymmetric</span><span class="p">(</span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Rj</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Ri</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tic</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Pi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Pj</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tic</span><span class="p">));</span>
<a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a><span class="w">            </span><span class="n">jacobian_ex_pose</span><span class="p">.</span><span class="n">leftCols</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">jaco_ex</span><span class="p">;</span>
<a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a><span class="w">            </span><span class="n">jacobian_ex_pose</span><span class="p">.</span><span class="n">rightCols</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">().</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-24-86" name="__codelineno-24-86" href="#__codelineno-24-86"></a><span class="w">            </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jacobian_feature</span><span class="p">(</span><span class="n">jacobians</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<a id="__codelineno-24-87" name="__codelineno-24-87" href="#__codelineno-24-87"></a><span class="w">            </span><span class="n">jacobian_feature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ric</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Rj</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ri</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ric</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pts_i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">-1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">inv_dep_i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inv_dep_i</span><span class="p">);</span>
<a id="__codelineno-24-88" name="__codelineno-24-88" href="#__codelineno-24-88"></a>
<a id="__codelineno-24-89" name="__codelineno-24-89" href="#__codelineno-24-89"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-24-90" name="__codelineno-24-90" href="#__codelineno-24-90"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-91" name="__codelineno-24-91" href="#__codelineno-24-91"></a><span class="w">    </span><span class="n">sum_t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tic_toc</span><span class="p">.</span><span class="n">toc</span><span class="p">();</span>
<a id="__codelineno-24-92" name="__codelineno-24-92" href="#__codelineno-24-92"></a>
<a id="__codelineno-24-93" name="__codelineno-24-93" href="#__codelineno-24-93"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-24-94" name="__codelineno-24-94" href="#__codelineno-24-94"></a><span class="p">}</span>
</code></pre></div>
<h2 id="feature-tracking">Feature Tracking</h2>
<p>Recall that VINS subsribes the below two topics:
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/feature_tracker/feature&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">feature_callback</span><span class="p">);</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_restart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/feature_tracker/restart&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">restart_callback</span><span class="p">);</span>
</code></pre></div></p>
<p>Feature tracking is done in <code>feature_tracker</code> node
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;feature_tracker&quot;</span><span class="p">);</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">);</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">IMAGE_TOPIC</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">img_callback</span><span class="p">);</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">    </span><span class="n">pub_img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;feature&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">    </span><span class="n">pub_match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;feature_img&quot;</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">    </span><span class="n">pub_restart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;restart&quot;</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="p">}</span>
</code></pre></div></p>
<p>The <code>void img_callback(const sensor_msgs::ImageConstPtr &amp;img_msg)</code> handles the image streaming data, having done some checking then finds feature points and publishes them.</p>
<p>Checking includes 
* camera streaming frames should come in order
* only process a certain number of camera frames per second, and discard the redundant
* encode the camera frames in opencv <code>uchar</code> encoding</p>
<p><code>readImage(...)</code> is the core function that analyzes/reads feature points from a camera frame and track them.</p>
<p>Finally, the discovered feature points are published.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">img_callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">img_msg</span><span class="p">)</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="p">{</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="c1">// detect unstable camera stream</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">last_image_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">last_image_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="c1">// frequency control</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pub_count</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">first_image_time</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">FREQ</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">    </span><span class="c1">// encoding</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">encoding</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;8UC1&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_OF_CAM</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">        </span><span class="n">trackerData</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">readImage</span><span class="p">(</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">.</span><span class="n">rowRange</span><span class="p">(</span><span class="n">ROW</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ROW</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="n">img_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">());</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PUB_THIS_FRAME</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_OF_CAM</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trackerData</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ids</span><span class="p">;</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ids</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="w">                </span><span class="p">...</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="w">                </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Point32</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="w">                </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">un_pts</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="w">                </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">un_pts</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a><span class="w">                </span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a><span class="w">                </span><span class="n">feature_points</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a><span class="w">        </span><span class="n">pub_img</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">feature_points</span><span class="p">);</span>
<a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a><span class="p">}</span>
</code></pre></div>
<p><code>FeatureTracker::readImage(...)</code> is used to find feature points.</p>
<ul>
<li><code>cv::createCLAHE(...);</code> is used to perform <em>histogram equalization</em> that enhances image quality by improving contrast.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">CLAHE</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">createCLAHE</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">clipLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">40.0</span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="w">     </span><span class="n">tileGridSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Size</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">     </span>
</code></pre></div>
<ul>
<li><code>cv::calcOpticalFlowPyrLK(...)</code> tracks the feature points by calculating an optical flow for a sparse feature set using the iterative Lucas-Kanade method with pyramids.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">calcOpticalFlowPyrLK</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">InputArray</span><span class="w">  </span><span class="n">prevImg</span><span class="p">,</span><span class="w"> </span><span class="n">InputArray</span><span class="w"> </span><span class="n">nextImg</span><span class="p">,</span><span class="w"> </span><span class="n">InputArray</span><span class="w"> </span><span class="n">prevPts</span><span class="p">,</span><span class="w"> </span><span class="n">InputOutputArray</span><span class="w"> </span><span class="n">nextPts</span><span class="p">,</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">                                </span><span class="n">OutputArray</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">OutputArray</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="w">   </span><span class="n">winSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Size</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">),</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">                                </span><span class="n">TermCriteria</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TermCriteria</span><span class="p">(</span><span class="n">TermCriteria</span><span class="o">::</span><span class="n">COUNT</span><span class="o">+</span><span class="n">TermCriteria</span><span class="o">::</span><span class="n">EPS</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">),</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">minEigThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-4</span><span class="w"> </span><span class="p">)</span><span class="w">   </span>
</code></pre></div>
<ul>
<li><code>cv::goodFeaturesToTrack(...)</code> finds good features to track by </li>
<li>performs corner quality measure at every source image pixel by <em>Harris operator</em></li>
<li>performs a non-maximum suppression (the local maximums in <span class="arithmatex">\(3 \times 3\)</span> neighborhood are retained)</li>
<li>performs sorting on the features, and discard low-quality features</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">goodFeaturesToTrack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">InputArray</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">OutputArray</span><span class="w"> </span><span class="n">corners</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxCorners</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">qualityLevel</span><span class="p">,</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">                                </span><span class="kt">double</span><span class="w">  </span><span class="n">minDistance</span><span class="p">,</span><span class="w"> </span><span class="n">InputArray</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">noArray</span><span class="p">(),</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">blockSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">useHarrisDetector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">                                </span><span class="kt">double</span><span class="w">  </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.04</span><span class="w"> </span><span class="p">)</span><span class="w">  </span>
</code></pre></div>
<ul>
<li><code>FeatureTracker::rejectWithF()</code> (that calls <code>cv::findFundamentalMat(...)</code>) finds the fundamental matrix from feature points from two images <code>InputArray points1, InputArray points2</code>, then discards those feature points fail the fundamental matrix.
VINS uses RANSAC to find the fundamental matrix (the number of feature points should be greater/equal than/to <span class="arithmatex">\(8\)</span> for the most of time).<ul>
<li><code>FM_7POINT</code> for a 7-point algorithm. <span class="arithmatex">\(N=7\)</span></li>
<li><code>FM_8POINT</code> for an 8-point algorithm. <span class="arithmatex">\(N \ge 8\)</span></li>
<li><code>FM_RANSAC</code> for the RANSAC algorithm. <span class="arithmatex">\(N \ge 8\)</span></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">Mat</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">findFundamentalMat</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">InputArray</span><span class="w"> </span><span class="n">points1</span><span class="p">,</span><span class="w"> </span><span class="n">InputArray</span><span class="w"> </span><span class="n">points2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ransacReprojThreshold</span><span class="p">,</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">                            </span><span class="kt">double</span><span class="w"> </span><span class="n">confidence</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxIters</span><span class="p">,</span><span class="w"> </span><span class="n">OutputArray</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">noArray</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
</code></pre></div>
<p>The <code>FeatureTracker::readImage(...)</code> goes as such below</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">FeatureTracker::readImage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_img</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">_cur_time</span><span class="p">)</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="p">{</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">img</span><span class="p">;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_r</span><span class="p">;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="n">cur_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_cur_time</span><span class="p">;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EQUALIZE</span><span class="p">)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">CLAHE</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clahe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">createCLAHE</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">));</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_c</span><span class="p">;</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">        </span><span class="n">clahe</span><span class="o">-&gt;</span><span class="n">apply</span><span class="p">(</span><span class="n">_img</span><span class="p">,</span><span class="w"> </span><span class="n">img</span><span class="p">);</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">        </span><span class="n">ROS_DEBUG</span><span class="p">(</span><span class="s">&quot;CLAHE costs: %fms&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_c</span><span class="p">.</span><span class="n">toc</span><span class="p">());</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">        </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_img</span><span class="p">;</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cur_pts</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_o</span><span class="p">;</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">calcOpticalFlowPyrLK</span><span class="p">(</span><span class="n">cur_img</span><span class="p">,</span><span class="w"> </span><span class="n">forw_img</span><span class="p">,</span><span class="w"> </span><span class="n">cur_pts</span><span class="p">,</span><span class="w"> </span><span class="n">forw_pts</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">forw_pts</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">inBorder</span><span class="p">(</span><span class="n">forw_pts</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="w">                </span><span class="n">status</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="w">        </span><span class="n">reduceVector</span><span class="p">(</span><span class="n">prev_pts</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="w">        </span><span class="n">reduceVector</span><span class="p">(</span><span class="n">cur_pts</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="w">        </span><span class="n">reduceVector</span><span class="p">(</span><span class="n">forw_pts</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="w">        </span><span class="n">reduceVector</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">        </span><span class="n">reduceVector</span><span class="p">(</span><span class="n">cur_un_pts</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="w">        </span><span class="n">reduceVector</span><span class="p">(</span><span class="n">track_cnt</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a><span class="w">        </span><span class="n">ROS_DEBUG</span><span class="p">(</span><span class="s">&quot;temporal optical flow costs: %fms&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_o</span><span class="p">.</span><span class="n">toc</span><span class="p">());</span>
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a>
<a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">track_cnt</span><span class="p">)</span>
<a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a><span class="w">        </span><span class="n">n</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a>
<a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PUB_THIS_FRAME</span><span class="p">)</span>
<a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a><span class="w">        </span><span class="n">rejectWithF</span><span class="p">();</span>
<a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a>
<a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_m</span><span class="p">;</span>
<a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a><span class="w">        </span><span class="n">setMask</span><span class="p">();</span>
<a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a>
<a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_t</span><span class="p">;</span><span class="w">    </span>
<a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">n_max_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX_CNT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">forw_pts</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n_max_cnt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">mask</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
<a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a><span class="w">                </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;mask is empty &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mask</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CV_8UC1</span><span class="p">)</span>
<a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a><span class="w">                </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;mask type wrong &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mask</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">forw_img</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
<a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a><span class="w">                </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;wrong size &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a><span class="w">            </span><span class="n">cv</span><span class="o">::</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span><span class="n">forw_img</span><span class="p">,</span><span class="w"> </span><span class="n">n_pts</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_CNT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">forw_pts</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">MIN_DIST</span><span class="p">,</span><span class="w"> </span><span class="n">mask</span><span class="p">);</span>
<a id="__codelineno-32-59" name="__codelineno-32-59" href="#__codelineno-32-59"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-32-60" name="__codelineno-32-60" href="#__codelineno-32-60"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-32-61" name="__codelineno-32-61" href="#__codelineno-32-61"></a><span class="w">            </span><span class="n">n_pts</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-32-62" name="__codelineno-32-62" href="#__codelineno-32-62"></a>
<a id="__codelineno-32-63" name="__codelineno-32-63" href="#__codelineno-32-63"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_a</span><span class="p">;</span>
<a id="__codelineno-32-64" name="__codelineno-32-64" href="#__codelineno-32-64"></a><span class="w">        </span><span class="n">addPoints</span><span class="p">();</span>
<a id="__codelineno-32-65" name="__codelineno-32-65" href="#__codelineno-32-65"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-66" name="__codelineno-32-66" href="#__codelineno-32-66"></a>
<a id="__codelineno-32-67" name="__codelineno-32-67" href="#__codelineno-32-67"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-32-68" name="__codelineno-32-68" href="#__codelineno-32-68"></a><span class="w">    </span><span class="n">undistortedPoints</span><span class="p">();</span>
<a id="__codelineno-32-69" name="__codelineno-32-69" href="#__codelineno-32-69"></a><span class="p">}</span>
</code></pre></div>
<h3 id="brief-features">BRIEF Features</h3>
<p>VINS uses BRIEF Features.
In <code>pose_graph_node</code>, BRIEF vacabularies are loaded into <code>BriefDatabase db;</code>.</p>
<p><code>DBoW2</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">/// BRIEF Vocabulary</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">typedef</span><span class="w"> </span><span class="n">DBoW2</span><span class="o">::</span><span class="n">TemplatedVocabulary</span><span class="o">&lt;</span><span class="n">DBoW2</span><span class="o">::</span><span class="n">FBrief</span><span class="o">::</span><span class="n">TDescriptor</span><span class="p">,</span><span class="w"> </span><span class="n">DBoW2</span><span class="o">::</span><span class="n">FBrief</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span><span class="n">BriefVocabulary</span><span class="p">;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="c1">/// BRIEF Database</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="k">typedef</span><span class="w"> </span><span class="n">DBoW2</span><span class="o">::</span><span class="n">TemplatedDatabase</span><span class="o">&lt;</span><span class="n">DBoW2</span><span class="o">::</span><span class="n">FBrief</span><span class="o">::</span><span class="n">TDescriptor</span><span class="p">,</span><span class="w"> </span><span class="n">DBoW2</span><span class="o">::</span><span class="n">FBrief</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">  </span><span class="n">BriefDatabase</span><span class="p">;</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="c1">// The BRIEF Vocabulary and Database are defined in `PoseGraph`</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">PoseGraph</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">loadVocabulary</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">voc_path</span><span class="p">)</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">        </span><span class="n">voc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BriefVocabulary</span><span class="p">(</span><span class="n">voc_path</span><span class="p">);</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">        </span><span class="n">db</span><span class="p">.</span><span class="n">setVocabulary</span><span class="p">(</span><span class="o">*</span><span class="n">voc</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="w">    </span><span class="n">BriefDatabase</span><span class="w"> </span><span class="n">db</span><span class="p">;</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w">    </span><span class="n">BriefVocabulary</span><span class="o">*</span><span class="w"> </span><span class="n">voc</span><span class="p">;</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="p">}</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="c1">// At the beginning of pose_graph node running, the BRIEF vocabulary db is loaded</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="p">{</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pose_graph&quot;</span><span class="p">);</span>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">);</span>
<a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">    </span><span class="n">posegraph</span><span class="p">.</span><span class="n">registerPub</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a>
<a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a>
<a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">vocabulary_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pkg_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/../support_files/brief_k10L6.bin&quot;</span><span class="p">;</span>
<a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="w">    </span><span class="n">posegraph</span><span class="p">.</span><span class="n">loadVocabulary</span><span class="p">(</span><span class="n">vocabulary_file</span><span class="p">);</span>
<a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a>
<a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a><span class="p">}</span>
</code></pre></div>
<p><code>computeBRIEFPoint()</code> first finds some good features to track (if none then initiate some by FAST).
<code>extractor</code> is used to extract features by BRIEF patterns, and stores the extracted results in <code>keypoints</code>.</p>
<p>The <code>BRIEF::compute(...);</code> is a DBoW2 provided API to perform binary test with results stored in <code>descriptors</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BriefExtractor::operator</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="o">&amp;</span><span class="n">im</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">keys</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BRIEF</span><span class="o">::</span><span class="n">bitset</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">descriptors</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">  </span><span class="n">m_brief</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="w"> </span><span class="n">keys</span><span class="p">,</span><span class="w"> </span><span class="n">descriptors</span><span class="p">);</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="p">}</span>
</code></pre></div>
<p><code>liftProjective(...)</code> "lift"s image pixel <code>const Eigen::Vector2d&amp; p</code> to a normalized 3d world coordinate <code>Eigen::Vector3d&amp; P</code>, by first normalizing the 2d point then compute <span class="arithmatex">\(\theta\)</span> and <span class="arithmatex">\(\phi\)</span> as to find out the 3d world coordinate (<span class="arithmatex">\(P_{\text{distorted}} \rightarrow P(X_c, Y_c, Z_c)\)</span>).
This process is same as fisheye undistortion work.</p>
<p>Finally, normalize the keypoints such that <span class="arithmatex">\((\frac{X_c}{Z_c}, \frac{Y_c}{Z_c}, 1)\)</span></p>
<div style="display: flex; justify-content: center;">
      <img src="imgs/fisheye_proj.png" width="30%" height="30%" alt="fisheye_proj" />
</div>
<p></br></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kt">void</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nf">EquidistantCamera::liftProjective</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="o">&amp;</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="p">{</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="c1">// Lift points to normalised plane</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="w"> </span><span class="n">p_u</span><span class="p">;</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="n">p_u</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_inv_K11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m_inv_K13</span><span class="p">,</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">           </span><span class="n">m_inv_K22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m_inv_K23</span><span class="p">;</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">    </span><span class="c1">// Obtain a projective ray</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="p">;</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="n">backprojectSymmetric</span><span class="p">(</span><span class="n">p_u</span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="p">);</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">    </span><span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="p">}</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="kt">void</span><span class="w"> </span><span class="nf">KeyFrame::computeBRIEFPoint</span><span class="p">()</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="p">{</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">    </span><span class="n">BriefExtractor</span><span class="w"> </span><span class="n">extractor</span><span class="p">(</span><span class="n">BRIEF_PATTERN_FILE</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fast_th</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="c1">// corner detector response threshold</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">FAST</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">keypoints</span><span class="p">,</span><span class="w"> </span><span class="n">fast_th</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tmp_pts</span><span class="p">;</span>
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_pts</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">tmp_pts</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a><span class="w">            </span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a><span class="w">            </span><span class="n">key</span><span class="p">.</span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_pts</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a><span class="w">            </span><span class="n">keypoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a><span class="w">    </span><span class="n">extractor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">keypoints</span><span class="p">,</span><span class="w"> </span><span class="n">brief_descriptors</span><span class="p">);</span>
<a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">keypoints</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-35-38" name="__codelineno-35-38" href="#__codelineno-35-38"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">tmp_p</span><span class="p">;</span>
<a id="__codelineno-35-39" name="__codelineno-35-39" href="#__codelineno-35-39"></a><span class="w">        </span><span class="n">m_camera</span><span class="o">-&gt;</span><span class="n">liftProjective</span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="p">(</span><span class="n">keypoints</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">keypoints</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">tmp_p</span><span class="p">);</span>
<a id="__codelineno-35-40" name="__codelineno-35-40" href="#__codelineno-35-40"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="w"> </span><span class="n">tmp_norm</span><span class="p">;</span>
<a id="__codelineno-35-41" name="__codelineno-35-41" href="#__codelineno-35-41"></a><span class="w">        </span><span class="n">tmp_norm</span><span class="p">.</span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="n">tmp_p</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="o">/</span><span class="n">tmp_p</span><span class="p">.</span><span class="n">z</span><span class="p">(),</span><span class="w"> </span><span class="n">tmp_p</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="o">/</span><span class="n">tmp_p</span><span class="p">.</span><span class="n">z</span><span class="p">());</span>
<a id="__codelineno-35-42" name="__codelineno-35-42" href="#__codelineno-35-42"></a><span class="w">        </span><span class="n">keypoints_norm</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_norm</span><span class="p">);</span>
<a id="__codelineno-35-43" name="__codelineno-35-43" href="#__codelineno-35-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-35-44" name="__codelineno-35-44" href="#__codelineno-35-44"></a><span class="p">}</span>
<a id="__codelineno-35-45" name="__codelineno-35-45" href="#__codelineno-35-45"></a>
<a id="__codelineno-35-46" name="__codelineno-35-46" href="#__codelineno-35-46"></a><span class="kt">void</span><span class="w"> </span><span class="nf">KeyFrame::computeWindowBRIEFPoint</span><span class="p">()</span>
<a id="__codelineno-35-47" name="__codelineno-35-47" href="#__codelineno-35-47"></a><span class="p">{</span>
<a id="__codelineno-35-48" name="__codelineno-35-48" href="#__codelineno-35-48"></a><span class="w">    </span><span class="n">BriefExtractor</span><span class="w"> </span><span class="n">extractor</span><span class="p">(</span><span class="n">BRIEF_PATTERN_FILE</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<a id="__codelineno-35-49" name="__codelineno-35-49" href="#__codelineno-35-49"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">point_2d_uv</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-35-50" name="__codelineno-35-50" href="#__codelineno-35-50"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-35-51" name="__codelineno-35-51" href="#__codelineno-35-51"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-35-52" name="__codelineno-35-52" href="#__codelineno-35-52"></a><span class="w">        </span><span class="n">key</span><span class="p">.</span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_2d_uv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-35-53" name="__codelineno-35-53" href="#__codelineno-35-53"></a><span class="w">        </span><span class="n">window_keypoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-35-54" name="__codelineno-35-54" href="#__codelineno-35-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-35-55" name="__codelineno-35-55" href="#__codelineno-35-55"></a><span class="w">    </span><span class="n">extractor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">window_keypoints</span><span class="p">,</span><span class="w"> </span><span class="n">window_brief_descriptors</span><span class="p">);</span>
<a id="__codelineno-35-56" name="__codelineno-35-56" href="#__codelineno-35-56"></a><span class="p">}</span>
</code></pre></div>
<p>In <code>pose_graph</code> node launched <code>measurement_process = std::thread(process);</code>, there is <code>new KeyFrame(...);</code>, and
<code>computeBRIEFPoint()</code> is computed when creating a new keyframe.</p>
<p><code>computeWindowBRIEFPoint()</code> simply computes BRIEF pattern matching against the keyframe's <code>point_2d_uv</code>/<code>window_keypoints</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">KeyFrame</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="p">{</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_3d</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_2d_uv</span><span class="p">;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_2d_norm</span><span class="p">;</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_id</span><span class="p">;</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keypoints</span><span class="p">;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keypoints_norm</span><span class="p">;</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="n">window_keypoints</span><span class="p">;</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BRIEF</span><span class="o">::</span><span class="n">bitset</span><span class="o">&gt;</span><span class="w"> </span><span class="n">brief_descriptors</span><span class="p">;</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BRIEF</span><span class="o">::</span><span class="n">bitset</span><span class="o">&gt;</span><span class="w"> </span><span class="n">window_brief_descriptors</span><span class="p">;</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">    </span><span class="c1">// create keyframe online</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">    </span><span class="n">KeyFrame</span><span class="o">::</span><span class="n">KeyFrame</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">_time_stamp</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_index</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_vio_T_w_i</span><span class="p">,</span><span class="w"> </span><span class="n">Matrix3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_vio_R_w_i</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_image</span><span class="p">,</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">                   </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_point_3d</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_point_2d_uv</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_point_2d_norm</span><span class="p">,</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">                   </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_point_id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_sequence</span><span class="p">)</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">        </span><span class="n">point_3d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_point_3d</span><span class="p">;</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="w">        </span><span class="n">point_2d_uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_point_2d_uv</span><span class="p">;</span>
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="w">        </span><span class="n">point_2d_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_point_2d_norm</span><span class="p">;</span>
<a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a><span class="w">        </span><span class="n">point_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_point_id</span><span class="p">;</span>
<a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a>
<a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a><span class="w">        </span><span class="n">computeWindowBRIEFPoint</span><span class="p">();</span>
<a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a><span class="w">        </span><span class="n">computeBRIEFPoint</span><span class="p">();</span>
<a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a><span class="p">}</span>
<a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a>
<a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a><span class="kt">void</span><span class="w"> </span><span class="n">process</span><span class="p">()</span>
<a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a><span class="p">{</span>
<a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a><span class="w">    </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">keyframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KeyFrame</span><span class="p">(</span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">(),</span><span class="w"> </span><span class="n">frame_index</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">,</span>
<a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a><span class="w">                                   </span><span class="n">point_3d</span><span class="p">,</span><span class="w"> </span><span class="n">point_2d_uv</span><span class="p">,</span><span class="w"> </span><span class="n">point_2d_normal</span><span class="p">,</span><span class="w"> </span><span class="n">point_id</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="p">);</span><span class="w">  </span>
<a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a><span class="w">    </span><span class="n">m_process</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a><span class="w">    </span><span class="n">posegraph</span><span class="p">.</span><span class="n">addKeyFrame</span><span class="p">(</span><span class="n">keyframe</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a><span class="w">    </span><span class="n">m_process</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a><span class="p">}</span>
</code></pre></div>
<h3 id="feature-publish">Feature Publish</h3>
<p>In <code>pose_graph</code> node launched <code>measurement_process = std::thread(process);</code> calling <code>PoseGraph::addKeyFrame(...)</code>, there is <code>cur_kf-&gt;findConnection(old_kf)</code> that finds matching BRIEF features, as well as publishing these features.</p>
<p>The published data is of <code>sensor_msgs::PointCloud</code>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">pub_match_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;match_points&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
</code></pre></div></p>
<p>The keypoints are stored in <code>matched_2d_old_norm</code> computed from <code>searchByBRIEFDes(...)</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">KeyFrame::findConnection</span><span class="p">(</span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">old_kf</span><span class="p">)</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="p">{</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">    </span><span class="n">searchByBRIEFDes</span><span class="p">(</span><span class="n">matched_2d_old</span><span class="p">,</span><span class="w"> </span><span class="n">matched_2d_old_norm</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">                    </span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">brief_descriptors</span><span class="p">,</span><span class="w"> </span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">keypoints</span><span class="p">,</span><span class="w"> </span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">keypoints_norm</span><span class="p">);</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">matched_2d_cur</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MIN_LOOP_NUM</span><span class="p">)</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">        </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud</span><span class="w"> </span><span class="n">msg_match_points</span><span class="p">;</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">        </span><span class="n">msg_match_points</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="n">time_stamp</span><span class="p">);</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">matched_2d_old_norm</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">              </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Point32</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">              </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matched_2d_old_norm</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">              </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matched_2d_old_norm</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">              </span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matched_id</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">              </span><span class="n">msg_match_points</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">T_w_i</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">R_w_i</span><span class="p">;</span>
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="w">        </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a><span class="w">        </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ChannelFloat32</span><span class="w"> </span><span class="n">t_q_index</span><span class="p">;</span>
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">x</span><span class="p">());</span>
<a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">y</span><span class="p">());</span>
<a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">z</span><span class="p">());</span>
<a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Q</span><span class="p">.</span><span class="n">w</span><span class="p">());</span>
<a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Q</span><span class="p">.</span><span class="n">x</span><span class="p">());</span>
<a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Q</span><span class="p">.</span><span class="n">y</span><span class="p">());</span>
<a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Q</span><span class="p">.</span><span class="n">z</span><span class="p">());</span>
<a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a><span class="w">        </span><span class="n">t_q_index</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a><span class="w">        </span><span class="n">msg_match_points</span><span class="p">.</span><span class="n">channels</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">t_q_index</span><span class="p">);</span>
<a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a><span class="w">        </span><span class="n">pub_match_points</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg_match_points</span><span class="p">);</span>
<a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a><span class="p">}</span>
</code></pre></div>
<p><code>window_brief_descriptors</code> is the current frame's BRIEF features that are iterated through and comparedd against the old BRIEF features by Hamming distance <code>int dis = HammingDis(window_descriptor, descriptors_old[i]);</code>.
The most similar (having the shortest Hamming distance) feature's index is recorded.</p>
<p>The best match as well as its normalizaed value is stored in <code>pt</code> and <code>pt_norm</code>, then <code>push_back</code>ed to <code>matched_2d_old</code> and <code>matched_2d_old_norm</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">KeyFrame::searchByBRIEFDes</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">matched_2d_old</span><span class="p">,</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">                                </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">matched_2d_old_norm</span><span class="p">,</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">                                </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BRIEF</span><span class="o">::</span><span class="n">bitset</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">descriptors_old</span><span class="p">,</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">keypoints_old</span><span class="p">,</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">keypoints_old_norm</span><span class="p">)</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="p">{</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">window_brief_descriptors</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="w"> </span><span class="n">pt</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">);</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="w"> </span><span class="n">pt_norm</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">);</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">searchInAera</span><span class="p">(</span><span class="n">window_brief_descriptors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">descriptors_old</span><span class="p">,</span><span class="w"> </span><span class="n">keypoints_old</span><span class="p">,</span><span class="w"> </span><span class="n">keypoints_old_norm</span><span class="p">,</span><span class="w"> </span><span class="n">pt</span><span class="p">,</span><span class="w"> </span><span class="n">pt_norm</span><span class="p">))</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">          </span><span class="n">status</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">          </span><span class="n">status</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">        </span><span class="n">matched_2d_old</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pt</span><span class="p">);</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">        </span><span class="n">matched_2d_old_norm</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pt_norm</span><span class="p">);</span>
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="p">}</span>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">KeyFrame::searchInAera</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BRIEF</span><span class="o">::</span><span class="n">bitset</span><span class="w"> </span><span class="n">window_descriptor</span><span class="p">,</span>
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BRIEF</span><span class="o">::</span><span class="n">bitset</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">descriptors_old</span><span class="p">,</span>
<a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">keypoints_old</span><span class="p">,</span>
<a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">keypoints_old_norm</span><span class="p">,</span>
<a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="w">                            </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="w"> </span><span class="o">&amp;</span><span class="n">best_match</span><span class="p">,</span>
<a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">                            </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="w"> </span><span class="o">&amp;</span><span class="n">best_match_norm</span><span class="p">)</span>
<a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="p">{</span>
<a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a><span class="w">    </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="w"> </span><span class="n">best_pt</span><span class="p">;</span>
<a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bestDist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">128</span><span class="p">;</span>
<a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">descriptors_old</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a>
<a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">dis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HammingDis</span><span class="p">(</span><span class="n">window_descriptor</span><span class="p">,</span><span class="w"> </span><span class="n">descriptors_old</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">dis</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bestDist</span><span class="p">)</span>
<a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">            </span><span class="n">bestDist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dis</span><span class="p">;</span>
<a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a><span class="w">            </span><span class="n">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bestIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bestDist</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a><span class="w">      </span><span class="n">best_match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keypoints_old</span><span class="p">[</span><span class="n">bestIndex</span><span class="p">].</span><span class="n">pt</span><span class="p">;</span>
<a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a><span class="w">      </span><span class="n">best_match_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keypoints_old_norm</span><span class="p">[</span><span class="n">bestIndex</span><span class="p">].</span><span class="n">pt</span><span class="p">;</span>
<a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-39-50" name="__codelineno-39-50" href="#__codelineno-39-50"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-39-51" name="__codelineno-39-51" href="#__codelineno-39-51"></a><span class="p">}</span>
</code></pre></div>
<h2 id="pose-graph-and-loop-closure">Pose Graph and Loop Closure</h2>
<p>The start of <code>pose_graph</code> node is shown as below, where two threads are spwaned: <code>keyboard_command_process</code> receives commands from keyboard: keyboard button <code>s</code> means saving, and <code>n</code> starts a new pose gragh task,
while <code>measurement_process</code> does the below:
* Pop out msgs: <code>pose_msg</code>, <code>image_msg</code>, <code>point_msg</code> from buffers
* Building a keyframe:
  * from <code>pose_msg</code> compute <code>Vector3d T</code> and <code>Matrix3d R</code>
  * publish <code>point_msg</code> 
  * Take <code>Vector3d T</code> and <code>Matrix3d R</code>, and <code>image_msg</code>, <code>point_msg</code> to build a new keyframe</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">// declared as a global var</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">PoseGraph</span><span class="w"> </span><span class="n">posegraph</span><span class="p">;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="p">{</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pose_graph&quot;</span><span class="p">);</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">);</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">    </span><span class="n">posegraph</span><span class="p">.</span><span class="n">registerPub</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="c1">// some config params reading</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">    </span><span class="c1">// read BRIEF features</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">vocabulary_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pkg_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/../support_files/brief_k10L6.bin&quot;</span><span class="p">;</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">    </span><span class="n">posegraph</span><span class="p">.</span><span class="n">loadVocabulary</span><span class="p">(</span><span class="n">vocabulary_file</span><span class="p">);</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_i1mu_forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/vins_estimator/imu_propagate&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">imu_forward_callback</span><span class="p">);</span>
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_vio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/vins_estimator/odometry&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">vio_callback</span><span class="p">);</span>
<a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">IMAGE_TOPIC</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">image_callback</span><span class="p">);</span>
<a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/vins_estimator/keyframe_pose&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">pose_callback</span><span class="p">);</span>
<a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_extrinsic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/vins_estimator/extrinsic&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">extrinsic_callback</span><span class="p">);</span>
<a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/vins_estimator/keyframe_point&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">point_callback</span><span class="p">);</span>
<a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub_relo_relative_pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/vins_estimator/relo_relative_pose&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">relo_relative_pose_callback</span><span class="p">);</span>
<a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a>
<a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="w">    </span><span class="n">pub_match_img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;match_image&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="w">    </span><span class="n">pub_camera_pose_visual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">MarkerArray</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;camera_pose_visual&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="w">    </span><span class="n">pub_key_odometrys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">Marker</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;key_odometrys&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a><span class="w">    </span><span class="n">pub_vio_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Path</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;no_loop_path&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a><span class="w">    </span><span class="n">pub_match_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;match_points&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a>
<a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">measurement_process</span><span class="p">;</span>
<a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">keyboard_command_process</span><span class="p">;</span>
<a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a>
<a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a><span class="w">    </span><span class="n">measurement_process</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="n">process</span><span class="p">);</span>
<a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a><span class="w">    </span><span class="n">keyboard_command_process</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a>
<a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span>
<a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a>
<a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-40-39" name="__codelineno-40-39" href="#__codelineno-40-39"></a><span class="p">}</span>
</code></pre></div>
<p>The <code>process()</code> goes as below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">process</span><span class="p">()</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="p">{</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">LOOP_CLOSURE</span><span class="p">)</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">        </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="w"> </span><span class="n">image_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">        </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloudConstPtr</span><span class="w"> </span><span class="n">point_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">        </span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="n">pose_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span><span class="c1">// align timestamps before pop out msg</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">        </span><span class="n">m_buf</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">        </span><span class="n">pose_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_buf</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">        </span><span class="n">pose_buf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">        </span><span class="n">image_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image_buf</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">        </span><span class="n">image_buf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">        </span><span class="n">point_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_buf</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">        </span><span class="n">point_buf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">        </span><span class="n">m_buf</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pose_msg</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">            </span><span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImageConstPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv_bridge</span><span class="o">::</span><span class="n">toCvCopy</span><span class="p">(</span><span class="n">image_msg</span><span class="p">,</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">image_encodings</span><span class="o">::</span><span class="n">MONO8</span><span class="p">);</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">            </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">;</span>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">            </span><span class="c1">// build keyframe</span>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">                                  </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w">                                  </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Quaterniond</span><span class="p">(</span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="p">,</span>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w">                                     </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w">                                     </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="w">                                     </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="p">).</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="n">T</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">last_t</span><span class="p">).</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">SKIP_DIS</span><span class="p">)</span>
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w">                </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_3d</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w">                </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_2d_uv</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="w">                </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_2d_normal</span><span class="p">;</span>
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="w">                </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">point_id</span><span class="p">;</span>
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a>
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="w">                </span><span class="p">{</span>
<a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a><span class="w">                    </span><span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span><span class="w"> </span><span class="n">p_3d</span><span class="p">;</span>
<a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a><span class="w">                    </span><span class="n">p_3d</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a><span class="w">                    </span><span class="n">p_3d</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a><span class="w">                    </span><span class="n">p_3d</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a><span class="w">                    </span><span class="n">point_3d</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p_3d</span><span class="p">);</span>
<a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a>
<a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a><span class="w">                    </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="w"> </span><span class="n">p_2d_uv</span><span class="p">,</span><span class="w"> </span><span class="n">p_2d_normal</span><span class="p">;</span>
<a id="__codelineno-41-50" name="__codelineno-41-50" href="#__codelineno-41-50"></a><span class="w">                    </span><span class="kt">double</span><span class="w"> </span><span class="n">p_id</span><span class="p">;</span>
<a id="__codelineno-41-51" name="__codelineno-41-51" href="#__codelineno-41-51"></a><span class="w">                    </span><span class="n">p_2d_normal</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-41-52" name="__codelineno-41-52" href="#__codelineno-41-52"></a><span class="w">                    </span><span class="n">p_2d_normal</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-41-53" name="__codelineno-41-53" href="#__codelineno-41-53"></a><span class="w">                    </span><span class="n">p_2d_uv</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-41-54" name="__codelineno-41-54" href="#__codelineno-41-54"></a><span class="w">                    </span><span class="n">p_2d_uv</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-41-55" name="__codelineno-41-55" href="#__codelineno-41-55"></a><span class="w">                    </span><span class="n">p_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_msg</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a id="__codelineno-41-56" name="__codelineno-41-56" href="#__codelineno-41-56"></a><span class="w">                    </span><span class="n">point_2d_normal</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p_2d_normal</span><span class="p">);</span>
<a id="__codelineno-41-57" name="__codelineno-41-57" href="#__codelineno-41-57"></a><span class="w">                    </span><span class="n">point_2d_uv</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p_2d_uv</span><span class="p">);</span>
<a id="__codelineno-41-58" name="__codelineno-41-58" href="#__codelineno-41-58"></a><span class="w">                    </span><span class="n">point_id</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p_id</span><span class="p">);</span>
<a id="__codelineno-41-59" name="__codelineno-41-59" href="#__codelineno-41-59"></a>
<a id="__codelineno-41-60" name="__codelineno-41-60" href="#__codelineno-41-60"></a><span class="w">                    </span><span class="c1">//printf(&quot;u %f, v %f \n&quot;, p_2d_uv.x, p_2d_uv.y);</span>
<a id="__codelineno-41-61" name="__codelineno-41-61" href="#__codelineno-41-61"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-41-62" name="__codelineno-41-62" href="#__codelineno-41-62"></a>
<a id="__codelineno-41-63" name="__codelineno-41-63" href="#__codelineno-41-63"></a><span class="w">                </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">keyframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KeyFrame</span><span class="p">(</span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">(),</span><span class="w"> </span><span class="n">frame_index</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">,</span>
<a id="__codelineno-41-64" name="__codelineno-41-64" href="#__codelineno-41-64"></a><span class="w">                                   </span><span class="n">point_3d</span><span class="p">,</span><span class="w"> </span><span class="n">point_2d_uv</span><span class="p">,</span><span class="w"> </span><span class="n">point_2d_normal</span><span class="p">,</span><span class="w"> </span><span class="n">point_id</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="p">);</span><span class="w">   </span>
<a id="__codelineno-41-65" name="__codelineno-41-65" href="#__codelineno-41-65"></a><span class="w">                </span><span class="n">m_process</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-41-66" name="__codelineno-41-66" href="#__codelineno-41-66"></a><span class="w">                </span><span class="n">start_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-41-67" name="__codelineno-41-67" href="#__codelineno-41-67"></a><span class="w">                </span><span class="n">posegraph</span><span class="p">.</span><span class="n">addKeyFrame</span><span class="p">(</span><span class="n">keyframe</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-41-68" name="__codelineno-41-68" href="#__codelineno-41-68"></a><span class="w">                </span><span class="n">m_process</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-41-69" name="__codelineno-41-69" href="#__codelineno-41-69"></a><span class="w">                </span><span class="n">frame_index</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-41-70" name="__codelineno-41-70" href="#__codelineno-41-70"></a><span class="w">                </span><span class="n">last_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<a id="__codelineno-41-71" name="__codelineno-41-71" href="#__codelineno-41-71"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-41-72" name="__codelineno-41-72" href="#__codelineno-41-72"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-41-73" name="__codelineno-41-73" href="#__codelineno-41-73"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="w"> </span><span class="n">dura</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-41-74" name="__codelineno-41-74" href="#__codelineno-41-74"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">dura</span><span class="p">);</span>
<a id="__codelineno-41-75" name="__codelineno-41-75" href="#__codelineno-41-75"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-41-76" name="__codelineno-41-76" href="#__codelineno-41-76"></a><span class="p">}</span>
</code></pre></div>
<h3 id="data-visulization-and-buffer-storage-callbacks">Data Visulization and Buffer Storage Callbacks</h3>
<ul>
<li><code>void imu_forward_callback(const nav_msgs::Odometry::ConstPtr &amp;forward_msg)</code></li>
</ul>
<p>Visualize IMU readings, that <code>imu_forward_callback</code> receives IMU from the topic <code>"/vins_estimator/imu_propagate"</code> then adds the IMU data to <code>CameraPoseVisualization cameraposevisual</code> which publishes the data.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">CameraPoseVisualization::publish_by</span><span class="p">(</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pub</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Header</span><span class="w"> </span><span class="o">&amp;</span><span class="n">header</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">    </span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">MarkerArray</span><span class="w"> </span><span class="n">markerArray_msg</span><span class="p">;</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_markers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">        </span><span class="n">marker</span><span class="p">.</span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">header</span><span class="p">;</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">        </span><span class="n">markerArray_msg</span><span class="p">.</span><span class="n">markers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">marker</span><span class="p">);</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="w">    </span><span class="n">pub</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">markerArray_msg</span><span class="p">);</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="p">}</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="kt">void</span><span class="w"> </span><span class="nf">imu_forward_callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">forward_msg</span><span class="p">)</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="p">{</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">VISUALIZE_IMU_FORWARD</span><span class="p">)</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vio_t</span><span class="p">(</span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="w">        </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">vio_q</span><span class="p">;</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="w">        </span><span class="n">vio_q</span><span class="p">.</span><span class="n">w</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="w">        </span><span class="n">vio_q</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="w">        </span><span class="n">vio_q</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a><span class="w">        </span><span class="n">vio_q</span><span class="p">.</span><span class="n">z</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a><span class="w">        </span><span class="n">vio_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">w_t_vio</span><span class="p">;</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a><span class="w">        </span><span class="n">vio_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">vio_q</span><span class="p">;</span>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="w">        </span><span class="n">vio_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">t_drift</span><span class="p">;</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a><span class="w">        </span><span class="n">vio_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_q</span><span class="p">;</span>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vio_t_cam</span><span class="p">;</span>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="w">        </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">vio_q_cam</span><span class="p">;</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a><span class="w">        </span><span class="n">vio_t_cam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vio_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vio_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tic</span><span class="p">;</span>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="w">        </span><span class="n">vio_q_cam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vio_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qic</span><span class="p">;</span><span class="w">        </span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a><span class="w">        </span><span class="n">cameraposevisual</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a><span class="w">        </span><span class="n">cameraposevisual</span><span class="p">.</span><span class="n">add_pose</span><span class="p">(</span><span class="n">vio_t_cam</span><span class="p">,</span><span class="w"> </span><span class="n">vio_q_cam</span><span class="p">);</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a><span class="w">        </span><span class="n">cameraposevisual</span><span class="p">.</span><span class="n">publish_by</span><span class="p">(</span><span class="n">pub_camera_pose_visual</span><span class="p">,</span><span class="w"> </span><span class="n">forward_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">);</span>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><code>void vio_callback(const nav_msgs::Odometry::ConstPtr &amp;pose_msg)</code></li>
</ul>
<p>Visualize VIO pose results, that <code>vio_callback</code> takes <code>pose_msg</code> to <code>key_odometrys.points.push_back(pose_marker);</code> and publishes it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">vio_callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose_msg</span><span class="p">)</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="p">{</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="c1">//ROS_INFO(&quot;vio_callback!&quot;);</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vio_t</span><span class="p">(</span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">    </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">vio_q</span><span class="p">;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">    </span><span class="n">vio_q</span><span class="p">.</span><span class="n">w</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="n">vio_q</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">    </span><span class="n">vio_q</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">    </span><span class="n">vio_q</span><span class="p">.</span><span class="n">z</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">    </span><span class="n">vio_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">w_t_vio</span><span class="p">;</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">    </span><span class="n">vio_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">vio_q</span><span class="p">;</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="w">    </span><span class="n">vio_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">t_drift</span><span class="p">;</span>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">    </span><span class="n">vio_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posegraph</span><span class="p">.</span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_q</span><span class="p">;</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vio_t_cam</span><span class="p">;</span>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">    </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">vio_q_cam</span><span class="p">;</span>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">    </span><span class="n">vio_t_cam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vio_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vio_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tic</span><span class="p">;</span>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">    </span><span class="n">vio_q_cam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vio_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qic</span><span class="p">;</span><span class="w">        </span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">    </span><span class="n">odometry_buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">vio_t_cam</span><span class="p">);</span>
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="w">    </span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">Marker</span><span class="w"> </span><span class="n">key_odometrys</span><span class="p">;</span>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="c1">// define `key_odometrys`</span>
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a>
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">odometry_buf</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="w">        </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Point</span><span class="w"> </span><span class="n">pose_marker</span><span class="p">;</span>
<a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vio_t</span><span class="p">;</span>
<a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a><span class="w">        </span><span class="n">vio_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">odometry_buf</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
<a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="w">        </span><span class="n">odometry_buf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a><span class="w">        </span><span class="n">pose_marker</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vio_t</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
<a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="w">        </span><span class="n">pose_marker</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vio_t</span><span class="p">.</span><span class="n">y</span><span class="p">();</span>
<a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a><span class="w">        </span><span class="n">pose_marker</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vio_t</span><span class="p">.</span><span class="n">z</span><span class="p">();</span>
<a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="w">        </span><span class="n">key_odometrys</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pose_marker</span><span class="p">);</span>
<a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a><span class="w">        </span><span class="n">odometry_buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">vio_t</span><span class="p">);</span>
<a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a><span class="w">    </span><span class="n">pub_key_odometrys</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">key_odometrys</span><span class="p">);</span>
<a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a>
<a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><code>void pose_callback(const nav_msgs::Odometry::ConstPtr &amp;pose_msg)</code></li>
</ul>
<p>Just store poses to buffer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">pose_callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose_msg</span><span class="p">)</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="p">{</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">LOOP_CLOSURE</span><span class="p">)</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">    </span><span class="n">m_buf</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="n">pose_buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">pose_msg</span><span class="p">);</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">    </span><span class="n">m_buf</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><code>void point_callback(const sensor_msgs::PointCloudConstPtr &amp;point_msg)</code></li>
</ul>
<p>Just store points to buffer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">point_callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">PointCloudConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">point_msg</span><span class="p">)</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="p">{</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">LOOP_CLOSURE</span><span class="p">)</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="n">m_buf</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">    </span><span class="n">point_buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">point_msg</span><span class="p">);</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">    </span><span class="n">m_buf</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="p">}</span>
</code></pre></div>
<h3 id="relocalization">Relocalization</h3>
<p>Topic <code>"/vins_estimator/relo_relative_pose"</code> sends relocation pose msg to the <code>pose_graph</code> node that if the relative transform is small (judged by <code>if (abs(_loop_info(7)) &lt; 30.0 &amp;&amp; Vector3d(_loop_info(0), _loop_info(1), _loop_info(2)).norm() &lt; 20.0)</code>).
The correction is passed to <code>yaw_drift</code>, <code>r_drift</code> and <code>t_drift</code>, that are computed in <code>PoseGraph::addKeyFrame(...)</code> to set the pose in a keyframe.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">relo_relative_pose_callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose_msg</span><span class="p">)</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="p">{</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">relative_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">                                   </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">                                   </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">    </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">relative_q</span><span class="p">;</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">    </span><span class="n">relative_q</span><span class="p">.</span><span class="n">w</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">    </span><span class="n">relative_q</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">    </span><span class="n">relative_q</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">    </span><span class="n">relative_q</span><span class="p">.</span><span class="n">z</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">    </span><span class="c1">//printf(&quot;receive index %d \n&quot;, index );</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">loop_info</span><span class="p">;</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">    </span><span class="n">loop_info</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">x</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">z</span><span class="p">(),</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w">                 </span><span class="n">relative_q</span><span class="p">.</span><span class="n">w</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_q</span><span class="p">.</span><span class="n">x</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_q</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_q</span><span class="p">.</span><span class="n">z</span><span class="p">(),</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">                 </span><span class="n">relative_yaw</span><span class="p">;</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">    </span><span class="n">posegraph</span><span class="p">.</span><span class="n">updateKeyFrameLoop</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">loop_info</span><span class="p">);</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="p">}</span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="kt">void</span><span class="w"> </span><span class="nf">PoseGraph::updateKeyFrameLoop</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_loop_info</span><span class="p">)</span>
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a><span class="p">{</span>
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="w">    </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">kf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getKeyFrame</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="w">    </span><span class="n">kf</span><span class="o">-&gt;</span><span class="n">updateLoop</span><span class="p">(</span><span class="n">_loop_info</span><span class="p">);</span>
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">_loop_info</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">30.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">_loop_info</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">_loop_info</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">_loop_info</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">20.0</span><span class="p">)</span>
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FAST_RELOCALIZATION</span><span class="p">)</span>
<a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a><span class="w">            </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">old_kf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getKeyFrame</span><span class="p">(</span><span class="n">kf</span><span class="o">-&gt;</span><span class="n">loop_index</span><span class="p">);</span>
<a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">w_P_old</span><span class="p">,</span><span class="w"> </span><span class="n">w_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="p">;</span>
<a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">w_R_old</span><span class="p">,</span><span class="w"> </span><span class="n">w_R_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">;</span>
<a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a><span class="w">            </span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">getPose</span><span class="p">(</span><span class="n">w_P_old</span><span class="p">,</span><span class="w"> </span><span class="n">w_R_old</span><span class="p">);</span>
<a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a><span class="w">            </span><span class="n">kf</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">vio_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">);</span>
<a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a>
<a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">relative_t</span><span class="p">;</span>
<a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a><span class="w">            </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">relative_q</span><span class="p">;</span>
<a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a><span class="w">            </span><span class="n">relative_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kf</span><span class="o">-&gt;</span><span class="n">getLoopRelativeT</span><span class="p">();</span>
<a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a><span class="w">            </span><span class="n">relative_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kf</span><span class="o">-&gt;</span><span class="n">getLoopRelativeQ</span><span class="p">()).</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a><span class="w">            </span><span class="n">w_P_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_R_old</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">relative_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w_P_old</span><span class="p">;</span>
<a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a><span class="w">            </span><span class="n">w_R_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_R_old</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">relative_q</span><span class="p">;</span>
<a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a><span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">shift_yaw</span><span class="p">;</span>
<a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">shift_r</span><span class="p">;</span>
<a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">shift_t</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a><span class="w">            </span><span class="n">shift_yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">w_R_cur</span><span class="p">).</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">vio_R_cur</span><span class="p">).</span><span class="n">x</span><span class="p">();</span>
<a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a><span class="w">            </span><span class="n">shift_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">ypr2R</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">shift_yaw</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a><span class="w">            </span><span class="n">shift_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_P_cur</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">w_R_cur</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a>
<a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a><span class="w">            </span><span class="n">m_drift</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a><span class="w">            </span><span class="n">yaw_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shift_yaw</span><span class="p">;</span>
<a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a><span class="w">            </span><span class="n">r_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shift_r</span><span class="p">;</span>
<a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a><span class="w">            </span><span class="n">t_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shift_t</span><span class="p">;</span>
<a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a><span class="w">            </span><span class="n">m_drift</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-46-54" name="__codelineno-46-54" href="#__codelineno-46-54"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-46-55" name="__codelineno-46-55" href="#__codelineno-46-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-56" name="__codelineno-46-56" href="#__codelineno-46-56"></a><span class="p">}</span>
</code></pre></div>
<h3 id="loop-closure-detection">Loop Closure Detection</h3>
<p>Generally speaking, loop closure is done by checking in BRIEF database if the recent frames have seen similar features in some old frames.</p>
<p><code>db.query(keyframe-&gt;brief_descriptors, ret, 4, frame_index - 50);</code> does the checking: whether there is any old frame <code>frame_index - 50</code> (50 frames earlier) that have similar BRIEF features of the current keyframe <code>keyframe-&gt;brief_descriptors</code>.
If yes, then find the top <code>4</code> best matching images/frames stored in <code>ret</code>.</p>
<p><code>db.add(keyframe-&gt;brief_descriptors);</code> adds this keyframe's features to the BRIEF database.</p>
<p><code>if (ret.size() &gt;= 1 &amp;&amp; ret[0].Score &gt; 0.05) {...}</code> says that if there exist at least one similar frame and the best matching frame's score is greater than <code>0.05</code> (recall that in DBoW2, <code>ret</code> is sorted by score, so that <code>ret[0]</code> maps to the top matching frame/image), it can be said <code>find_loop = true;</code>, and returns <code>min_index = ret[i].Id;</code></p>
<p>The <code>min_index</code> will be used in <code>addKeyFrame(...)</code> to locate the previous matching keyframe/image by keyframe id.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">PoseGraph</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="p">{</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="n">BriefDatabase</span><span class="w"> </span><span class="n">db</span><span class="p">;</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span><span class="n">BriefVocabulary</span><span class="o">*</span><span class="w"> </span><span class="n">voc</span><span class="p">;</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="p">}</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="kt">int</span><span class="w"> </span><span class="n">PoseGraph</span><span class="o">::</span><span class="n">detectLoop</span><span class="p">(</span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">keyframe</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">frame_index</span><span class="p">)</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="p">{</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">    </span><span class="c1">// put image into image_pool; for visualization</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">    </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">compressed_image</span><span class="p">;</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG_IMAGE</span><span class="p">)</span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">feature_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframe</span><span class="o">-&gt;</span><span class="n">keypoints</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">keyframe</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">compressed_image</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">376</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">));</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="w">        </span><span class="n">putText</span><span class="p">(</span><span class="n">compressed_image</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;feature_num:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">to_string</span><span class="p">(</span><span class="n">feature_num</span><span class="p">),</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="n">CV_FONT_HERSHEY_SIMPLEX</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="w">        </span><span class="n">image_pool</span><span class="p">[</span><span class="n">frame_index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compressed_image</span><span class="p">;</span>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a>
<a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="w">    </span><span class="n">TicToc</span><span class="w"> </span><span class="n">tmp_t</span><span class="p">;</span>
<a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="w">    </span><span class="c1">//first query; then add this frame into database!</span>
<a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="w">    </span><span class="n">QueryResults</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a><span class="w">    </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_query</span><span class="p">;</span>
<a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a><span class="w">    </span><span class="n">db</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">keyframe</span><span class="o">-&gt;</span><span class="n">brief_descriptors</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">frame_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>
<a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a>
<a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a><span class="w">    </span><span class="n">TicToc</span><span class="w"> </span><span class="n">t_add</span><span class="p">;</span>
<a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a><span class="w">    </span><span class="n">db</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">keyframe</span><span class="o">-&gt;</span><span class="n">brief_descriptors</span><span class="p">);</span>
<a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">find_loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a><span class="w">    </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">loop_result</span><span class="p">;</span>
<a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG_IMAGE</span><span class="p">)</span>
<a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a><span class="w">        </span><span class="n">loop_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compressed_image</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a><span class="w">            </span><span class="n">putText</span><span class="p">(</span><span class="n">loop_result</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;neighbour score:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">to_string</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Score</span><span class="p">),</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">),</span><span class="w"> </span><span class="n">CV_FONT_HERSHEY_SIMPLEX</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
<a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a><span class="w">    </span><span class="c1">// visual loop result </span>
<a id="__codelineno-47-38" name="__codelineno-47-38" href="#__codelineno-47-38"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG_IMAGE</span><span class="p">)</span>
<a id="__codelineno-47-39" name="__codelineno-47-39" href="#__codelineno-47-39"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-47-40" name="__codelineno-47-40" href="#__codelineno-47-40"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ret</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-47-41" name="__codelineno-47-41" href="#__codelineno-47-41"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-47-42" name="__codelineno-47-42" href="#__codelineno-47-42"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Id</span><span class="p">;</span>
<a id="__codelineno-47-43" name="__codelineno-47-43" href="#__codelineno-47-43"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image_pool</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">tmp_index</span><span class="p">);</span>
<a id="__codelineno-47-44" name="__codelineno-47-44" href="#__codelineno-47-44"></a><span class="w">            </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">tmp_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">).</span><span class="n">clone</span><span class="p">();</span>
<a id="__codelineno-47-45" name="__codelineno-47-45" href="#__codelineno-47-45"></a><span class="w">            </span><span class="n">putText</span><span class="p">(</span><span class="n">tmp_image</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;index:  &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">to_string</span><span class="p">(</span><span class="n">tmp_index</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;loop score:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">to_string</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Score</span><span class="p">),</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">),</span><span class="w"> </span><span class="n">CV_FONT_HERSHEY_SIMPLEX</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
<a id="__codelineno-47-46" name="__codelineno-47-46" href="#__codelineno-47-46"></a><span class="w">            </span><span class="n">cv</span><span class="o">::</span><span class="n">hconcat</span><span class="p">(</span><span class="n">loop_result</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_image</span><span class="p">,</span><span class="w"> </span><span class="n">loop_result</span><span class="p">);</span>
<a id="__codelineno-47-47" name="__codelineno-47-47" href="#__codelineno-47-47"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-47-48" name="__codelineno-47-48" href="#__codelineno-47-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-49" name="__codelineno-47-49" href="#__codelineno-47-49"></a><span class="w">    </span><span class="c1">// a good match with its nerghbour</span>
<a id="__codelineno-47-50" name="__codelineno-47-50" href="#__codelineno-47-50"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<a id="__codelineno-47-51" name="__codelineno-47-51" href="#__codelineno-47-51"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ret</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-47-52" name="__codelineno-47-52" href="#__codelineno-47-52"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-47-53" name="__codelineno-47-53" href="#__codelineno-47-53"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.015</span><span class="p">)</span>
<a id="__codelineno-47-54" name="__codelineno-47-54" href="#__codelineno-47-54"></a><span class="w">            </span><span class="p">{</span><span class="w">          </span>
<a id="__codelineno-47-55" name="__codelineno-47-55" href="#__codelineno-47-55"></a><span class="w">                </span><span class="n">find_loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-47-56" name="__codelineno-47-56" href="#__codelineno-47-56"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Id</span><span class="p">;</span>
<a id="__codelineno-47-57" name="__codelineno-47-57" href="#__codelineno-47-57"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG_IMAGE</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-47-58" name="__codelineno-47-58" href="#__codelineno-47-58"></a><span class="w">                </span><span class="p">{</span>
<a id="__codelineno-47-59" name="__codelineno-47-59" href="#__codelineno-47-59"></a><span class="w">                    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image_pool</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">tmp_index</span><span class="p">);</span>
<a id="__codelineno-47-60" name="__codelineno-47-60" href="#__codelineno-47-60"></a><span class="w">                    </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">tmp_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">).</span><span class="n">clone</span><span class="p">();</span>
<a id="__codelineno-47-61" name="__codelineno-47-61" href="#__codelineno-47-61"></a><span class="w">                    </span><span class="n">putText</span><span class="p">(</span><span class="n">tmp_image</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;loop score:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">to_string</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Score</span><span class="p">),</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">),</span><span class="w"> </span><span class="n">CV_FONT_HERSHEY_SIMPLEX</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
<a id="__codelineno-47-62" name="__codelineno-47-62" href="#__codelineno-47-62"></a><span class="w">                    </span><span class="n">cv</span><span class="o">::</span><span class="n">hconcat</span><span class="p">(</span><span class="n">loop_result</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_image</span><span class="p">,</span><span class="w"> </span><span class="n">loop_result</span><span class="p">);</span>
<a id="__codelineno-47-63" name="__codelineno-47-63" href="#__codelineno-47-63"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-47-64" name="__codelineno-47-64" href="#__codelineno-47-64"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-47-65" name="__codelineno-47-65" href="#__codelineno-47-65"></a>
<a id="__codelineno-47-66" name="__codelineno-47-66" href="#__codelineno-47-66"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-47-67" name="__codelineno-47-67" href="#__codelineno-47-67"></a>
<a id="__codelineno-47-68" name="__codelineno-47-68" href="#__codelineno-47-68"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">find_loop</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">frame_index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-47-69" name="__codelineno-47-69" href="#__codelineno-47-69"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-47-70" name="__codelineno-47-70" href="#__codelineno-47-70"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">min_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-47-71" name="__codelineno-47-71" href="#__codelineno-47-71"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ret</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-47-72" name="__codelineno-47-72" href="#__codelineno-47-72"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-47-73" name="__codelineno-47-73" href="#__codelineno-47-73"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">min_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min_index</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.015</span><span class="p">))</span>
<a id="__codelineno-47-74" name="__codelineno-47-74" href="#__codelineno-47-74"></a><span class="w">                </span><span class="n">min_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Id</span><span class="p">;</span>
<a id="__codelineno-47-75" name="__codelineno-47-75" href="#__codelineno-47-75"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-47-76" name="__codelineno-47-76" href="#__codelineno-47-76"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">min_index</span><span class="p">;</span>
<a id="__codelineno-47-77" name="__codelineno-47-77" href="#__codelineno-47-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-78" name="__codelineno-47-78" href="#__codelineno-47-78"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-47-79" name="__codelineno-47-79" href="#__codelineno-47-79"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-47-80" name="__codelineno-47-80" href="#__codelineno-47-80"></a>
<a id="__codelineno-47-81" name="__codelineno-47-81" href="#__codelineno-47-81"></a><span class="p">}</span>
</code></pre></div>
<h3 id="loop-closure-correction">Loop Closure Correction</h3>
<p>In <code>process()</code>, a new <code>KeyFrame</code> is added to <code>posegraph</code> if there is a gap <code>(T - last_t).norm() &gt; SKIP_DIS</code> between this pose and the last pose.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">process</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="p">{</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">T</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">last_t</span><span class="p">).</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">SKIP_DIS</span><span class="p">)</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">        </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">keyframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KeyFrame</span><span class="p">(</span><span class="n">pose_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">(),</span><span class="w"> </span><span class="n">frame_index</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">,</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">                                       </span><span class="n">point_3d</span><span class="p">,</span><span class="w"> </span><span class="n">point_2d_uv</span><span class="p">,</span><span class="w"> </span><span class="n">point_2d_normal</span><span class="p">,</span><span class="w"> </span><span class="n">point_id</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="p">);</span><span class="w">   </span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">        </span><span class="n">m_process</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">        </span><span class="n">start_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">        </span><span class="n">posegraph</span><span class="p">.</span><span class="n">addKeyFrame</span><span class="p">(</span><span class="n">keyframe</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">        </span><span class="n">m_process</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">        </span><span class="n">frame_index</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="p">}</span>
</code></pre></div>
<p>During <code>addKeyFrame(...)</code>, by loop closure detection <code>loop_index = detectLoop(cur_kf, cur_kf-&gt;index);</code>, an old keyframe that co-observes some similar features is located <code>KeyFrame* old_kf = getKeyFrame(loop_index);</code>.</p>
<p><code>cur_kf-&gt;findConnection(old_kf)</code> computes the relative transform from the <code>old_kf</code> and <code>cur_kf</code>, then <code>relative_t = cur_kf-&gt;getLoopRelativeT();</code> and <code>relative_q = (cur_kf-&gt;getLoopRelativeQ()).toRotationMatrix();</code> get the transform, that are applied correction on the old frame pose <code>w_P_cur = w_R_old * relative_t + w_P_old;</code> and <code>w_R_cur = w_R_old * relative_q;</code>.</p>
<p>The corrected current pose is saved to path <code>path[sequence_cnt].poses.push_back(pose_stamped);</code>.</p>
<p><code>keyframelist.push_back(cur_kf);</code> saves the current keyframe.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">PoseGraph::addKeyFrame</span><span class="p">(</span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">cur_kf</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">flag_detect_loop</span><span class="p">)</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="p">{</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">    </span><span class="c1">//shift to base frame</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="p">;</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">    </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">;</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sequence_cnt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="p">)</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">        </span><span class="n">sequence_cnt</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">        </span><span class="n">sequence_loop</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">        </span><span class="n">w_t_vio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">        </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">        </span><span class="n">m_drift</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">        </span><span class="n">t_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">        </span><span class="n">r_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="w">        </span><span class="n">m_drift</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="w">    </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">vio_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">);</span>
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">    </span><span class="n">vio_P_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w_t_vio</span><span class="p">;</span>
<a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="w">    </span><span class="n">vio_R_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">vio_R_cur</span><span class="p">;</span>
<a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="w">    </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">updateVioPose</span><span class="p">(</span><span class="n">vio_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">);</span>
<a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="w">    </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_index</span><span class="p">;</span>
<a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a><span class="w">    </span><span class="n">global_index</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">loop_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flag_detect_loop</span><span class="p">)</span>
<a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">tmp_t</span><span class="p">;</span>
<a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a><span class="w">        </span><span class="n">loop_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">detectLoop</span><span class="p">(</span><span class="n">cur_kf</span><span class="p">,</span><span class="w"> </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">);</span>
<a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a><span class="w">        </span><span class="n">addKeyFrameIntoVoc</span><span class="p">(</span><span class="n">cur_kf</span><span class="p">);</span>
<a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loop_index</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a><span class="w">        </span><span class="c1">//printf(&quot; %d detect loop with %d \n&quot;, cur_kf-&gt;index, loop_index);</span>
<a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a><span class="w">        </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">old_kf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getKeyFrame</span><span class="p">(</span><span class="n">loop_index</span><span class="p">);</span>
<a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a>
<a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">findConnection</span><span class="p">(</span><span class="n">old_kf</span><span class="p">))</span>
<a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">earliest_loop_index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">loop_index</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">earliest_loop_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a><span class="w">                </span><span class="n">earliest_loop_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop_index</span><span class="p">;</span>
<a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a>
<a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">w_P_old</span><span class="p">,</span><span class="w"> </span><span class="n">w_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="p">;</span>
<a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">w_R_old</span><span class="p">,</span><span class="w"> </span><span class="n">w_R_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">;</span>
<a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a><span class="w">            </span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">w_P_old</span><span class="p">,</span><span class="w"> </span><span class="n">w_R_old</span><span class="p">);</span>
<a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a><span class="w">            </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">vio_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">);</span>
<a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a>
<a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">relative_t</span><span class="p">;</span>
<a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a><span class="w">            </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">relative_q</span><span class="p">;</span>
<a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a><span class="w">            </span><span class="n">relative_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getLoopRelativeT</span><span class="p">();</span>
<a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a><span class="w">            </span><span class="n">relative_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getLoopRelativeQ</span><span class="p">()).</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a><span class="w">            </span><span class="n">w_P_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_R_old</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">relative_t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w_P_old</span><span class="p">;</span>
<a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a><span class="w">            </span><span class="n">w_R_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_R_old</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">relative_q</span><span class="p">;</span>
<a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a><span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">shift_yaw</span><span class="p">;</span>
<a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">shift_r</span><span class="p">;</span>
<a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">shift_t</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a><span class="w">            </span><span class="n">shift_yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">w_R_cur</span><span class="p">).</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">vio_R_cur</span><span class="p">).</span><span class="n">x</span><span class="p">();</span>
<a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a><span class="w">            </span><span class="n">shift_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">ypr2R</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">shift_yaw</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a><span class="w">            </span><span class="n">shift_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_P_cur</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">w_R_cur</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a><span class="w">            </span><span class="c1">// shift vio pose of whole sequence to the world frame</span>
<a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">old_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sequence_loop</span><span class="p">[</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a><span class="w">            </span><span class="p">{</span><span class="w">  </span>
<a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a><span class="w">                </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shift_r</span><span class="p">;</span>
<a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a><span class="w">                </span><span class="n">w_t_vio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shift_t</span><span class="p">;</span>
<a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a><span class="w">                </span><span class="n">vio_P_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w_t_vio</span><span class="p">;</span>
<a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a><span class="w">                </span><span class="n">vio_R_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">vio_R_cur</span><span class="p">;</span>
<a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a><span class="w">                </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">updateVioPose</span><span class="p">(</span><span class="n">vio_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">);</span>
<a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a><span class="w">                </span><span class="n">list</span><span class="o">&lt;</span><span class="n">KeyFrame</span><span class="o">*&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<a id="__codelineno-49-70" name="__codelineno-49-70" href="#__codelineno-49-70"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="o">++</span><span class="p">)</span><span class="w">   </span>
<a id="__codelineno-49-71" name="__codelineno-49-71" href="#__codelineno-49-71"></a><span class="w">                </span><span class="p">{</span>
<a id="__codelineno-49-72" name="__codelineno-49-72" href="#__codelineno-49-72"></a><span class="w">                    </span><span class="k">if</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="p">)</span>
<a id="__codelineno-49-73" name="__codelineno-49-73" href="#__codelineno-49-73"></a><span class="w">                    </span><span class="p">{</span>
<a id="__codelineno-49-74" name="__codelineno-49-74" href="#__codelineno-49-74"></a><span class="w">                        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="p">;</span>
<a id="__codelineno-49-75" name="__codelineno-49-75" href="#__codelineno-49-75"></a><span class="w">                        </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">;</span>
<a id="__codelineno-49-76" name="__codelineno-49-76" href="#__codelineno-49-76"></a><span class="w">                        </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">vio_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">);</span>
<a id="__codelineno-49-77" name="__codelineno-49-77" href="#__codelineno-49-77"></a><span class="w">                        </span><span class="n">vio_P_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_P_cur</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w_t_vio</span><span class="p">;</span>
<a id="__codelineno-49-78" name="__codelineno-49-78" href="#__codelineno-49-78"></a><span class="w">                        </span><span class="n">vio_R_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_r_vio</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">vio_R_cur</span><span class="p">;</span>
<a id="__codelineno-49-79" name="__codelineno-49-79" href="#__codelineno-49-79"></a><span class="w">                        </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">updateVioPose</span><span class="p">(</span><span class="n">vio_P_cur</span><span class="p">,</span><span class="w"> </span><span class="n">vio_R_cur</span><span class="p">);</span>
<a id="__codelineno-49-80" name="__codelineno-49-80" href="#__codelineno-49-80"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-49-81" name="__codelineno-49-81" href="#__codelineno-49-81"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-49-82" name="__codelineno-49-82" href="#__codelineno-49-82"></a><span class="w">                </span><span class="n">sequence_loop</span><span class="p">[</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-49-83" name="__codelineno-49-83" href="#__codelineno-49-83"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-49-84" name="__codelineno-49-84" href="#__codelineno-49-84"></a><span class="w">            </span><span class="n">m_optimize_buf</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-49-85" name="__codelineno-49-85" href="#__codelineno-49-85"></a><span class="w">            </span><span class="n">optimize_buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">);</span>
<a id="__codelineno-49-86" name="__codelineno-49-86" href="#__codelineno-49-86"></a><span class="w">            </span><span class="n">m_optimize_buf</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-49-87" name="__codelineno-49-87" href="#__codelineno-49-87"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-88" name="__codelineno-49-88" href="#__codelineno-49-88"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-89" name="__codelineno-49-89" href="#__codelineno-49-89"></a><span class="w">    </span><span class="n">m_keyframelist</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-49-90" name="__codelineno-49-90" href="#__codelineno-49-90"></a><span class="w">    </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-49-91" name="__codelineno-49-91" href="#__codelineno-49-91"></a><span class="w">    </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-49-92" name="__codelineno-49-92" href="#__codelineno-49-92"></a><span class="w">    </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-49-93" name="__codelineno-49-93" href="#__codelineno-49-93"></a><span class="w">    </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t_drift</span><span class="p">;</span>
<a id="__codelineno-49-94" name="__codelineno-49-94" href="#__codelineno-49-94"></a><span class="w">    </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-49-95" name="__codelineno-49-95" href="#__codelineno-49-95"></a><span class="w">    </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">updatePose</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-49-96" name="__codelineno-49-96" href="#__codelineno-49-96"></a><span class="w">    </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">Q</span><span class="p">{</span><span class="n">R</span><span class="p">};</span>
<a id="__codelineno-49-97" name="__codelineno-49-97" href="#__codelineno-49-97"></a><span class="w">    </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">PoseStamped</span><span class="w"> </span><span class="n">pose_stamped</span><span class="p">;</span>
<a id="__codelineno-49-98" name="__codelineno-49-98" href="#__codelineno-49-98"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">time_stamp</span><span class="p">);</span>
<a id="__codelineno-49-99" name="__codelineno-49-99" href="#__codelineno-49-99"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;world&quot;</span><span class="p">;</span>
<a id="__codelineno-49-100" name="__codelineno-49-100" href="#__codelineno-49-100"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">VISUALIZATION_SHIFT_X</span><span class="p">;</span>
<a id="__codelineno-49-101" name="__codelineno-49-101" href="#__codelineno-49-101"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">VISUALIZATION_SHIFT_Y</span><span class="p">;</span>
<a id="__codelineno-49-102" name="__codelineno-49-102" href="#__codelineno-49-102"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">z</span><span class="p">();</span>
<a id="__codelineno-49-103" name="__codelineno-49-103" href="#__codelineno-49-103"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
<a id="__codelineno-49-104" name="__codelineno-49-104" href="#__codelineno-49-104"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">y</span><span class="p">();</span>
<a id="__codelineno-49-105" name="__codelineno-49-105" href="#__codelineno-49-105"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">z</span><span class="p">();</span>
<a id="__codelineno-49-106" name="__codelineno-49-106" href="#__codelineno-49-106"></a><span class="w">    </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">w</span><span class="p">();</span>
<a id="__codelineno-49-107" name="__codelineno-49-107" href="#__codelineno-49-107"></a><span class="w">    </span><span class="n">path</span><span class="p">[</span><span class="n">sequence_cnt</span><span class="p">].</span><span class="n">poses</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pose_stamped</span><span class="p">);</span>
<a id="__codelineno-49-108" name="__codelineno-49-108" href="#__codelineno-49-108"></a><span class="w">    </span><span class="n">path</span><span class="p">[</span><span class="n">sequence_cnt</span><span class="p">].</span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose_stamped</span><span class="p">.</span><span class="n">header</span><span class="p">;</span>
<a id="__codelineno-49-109" name="__codelineno-49-109" href="#__codelineno-49-109"></a>
<a id="__codelineno-49-110" name="__codelineno-49-110" href="#__codelineno-49-110"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SAVE_LOOP_PATH</span><span class="p">)</span>
<a id="__codelineno-49-111" name="__codelineno-49-111" href="#__codelineno-49-111"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-112" name="__codelineno-49-112" href="#__codelineno-49-112"></a><span class="w">        </span><span class="n">ofstream</span><span class="w"> </span><span class="n">loop_path_file</span><span class="p">(</span><span class="n">VINS_RESULT_PATH</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
<a id="__codelineno-49-113" name="__codelineno-49-113" href="#__codelineno-49-113"></a><span class="w">        </span><span class="n">loop_path_file</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">fixed</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">floatfield</span><span class="p">);</span>
<a id="__codelineno-49-114" name="__codelineno-49-114" href="#__codelineno-49-114"></a><span class="w">        </span><span class="n">loop_path_file</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-49-115" name="__codelineno-49-115" href="#__codelineno-49-115"></a><span class="w">        </span><span class="n">loop_path_file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">time_stamp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span>
<a id="__codelineno-49-116" name="__codelineno-49-116" href="#__codelineno-49-116"></a><span class="w">        </span><span class="n">loop_path_file</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-49-117" name="__codelineno-49-117" href="#__codelineno-49-117"></a><span class="w">        </span><span class="n">loop_path_file</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<a id="__codelineno-49-118" name="__codelineno-49-118" href="#__codelineno-49-118"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<a id="__codelineno-49-119" name="__codelineno-49-119" href="#__codelineno-49-119"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">z</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<a id="__codelineno-49-120" name="__codelineno-49-120" href="#__codelineno-49-120"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">w</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<a id="__codelineno-49-121" name="__codelineno-49-121" href="#__codelineno-49-121"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<a id="__codelineno-49-122" name="__codelineno-49-122" href="#__codelineno-49-122"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<a id="__codelineno-49-123" name="__codelineno-49-123" href="#__codelineno-49-123"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Q</span><span class="p">.</span><span class="n">z</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<a id="__codelineno-49-124" name="__codelineno-49-124" href="#__codelineno-49-124"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-49-125" name="__codelineno-49-125" href="#__codelineno-49-125"></a><span class="w">        </span><span class="n">loop_path_file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<a id="__codelineno-49-126" name="__codelineno-49-126" href="#__codelineno-49-126"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-127" name="__codelineno-49-127" href="#__codelineno-49-127"></a><span class="w">    </span><span class="c1">//draw local connection</span>
<a id="__codelineno-49-128" name="__codelineno-49-128" href="#__codelineno-49-128"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SHOW_S_EDGE</span><span class="p">)</span>
<a id="__codelineno-49-129" name="__codelineno-49-129" href="#__codelineno-49-129"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-130" name="__codelineno-49-130" href="#__codelineno-49-130"></a><span class="w">        </span><span class="n">list</span><span class="o">&lt;</span><span class="n">KeyFrame</span><span class="o">*&gt;::</span><span class="n">reverse_iterator</span><span class="w"> </span><span class="n">rit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">rbegin</span><span class="p">();</span>
<a id="__codelineno-49-131" name="__codelineno-49-131" href="#__codelineno-49-131"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-49-132" name="__codelineno-49-132" href="#__codelineno-49-132"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-49-133" name="__codelineno-49-133" href="#__codelineno-49-133"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">rend</span><span class="p">())</span>
<a id="__codelineno-49-134" name="__codelineno-49-134" href="#__codelineno-49-134"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-49-135" name="__codelineno-49-135" href="#__codelineno-49-135"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">conncected_P</span><span class="p">;</span>
<a id="__codelineno-49-136" name="__codelineno-49-136" href="#__codelineno-49-136"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">connected_R</span><span class="p">;</span>
<a id="__codelineno-49-137" name="__codelineno-49-137" href="#__codelineno-49-137"></a><span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="o">*</span><span class="n">rit</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="p">)</span>
<a id="__codelineno-49-138" name="__codelineno-49-138" href="#__codelineno-49-138"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-49-139" name="__codelineno-49-139" href="#__codelineno-49-139"></a><span class="w">                </span><span class="p">(</span><span class="o">*</span><span class="n">rit</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">getPose</span><span class="p">(</span><span class="n">conncected_P</span><span class="p">,</span><span class="w"> </span><span class="n">connected_R</span><span class="p">);</span>
<a id="__codelineno-49-140" name="__codelineno-49-140" href="#__codelineno-49-140"></a><span class="w">                </span><span class="n">posegraph_visualization</span><span class="o">-&gt;</span><span class="n">add_edge</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">conncected_P</span><span class="p">);</span>
<a id="__codelineno-49-141" name="__codelineno-49-141" href="#__codelineno-49-141"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-49-142" name="__codelineno-49-142" href="#__codelineno-49-142"></a><span class="w">            </span><span class="n">rit</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-49-143" name="__codelineno-49-143" href="#__codelineno-49-143"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-144" name="__codelineno-49-144" href="#__codelineno-49-144"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-145" name="__codelineno-49-145" href="#__codelineno-49-145"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SHOW_L_EDGE</span><span class="p">)</span>
<a id="__codelineno-49-146" name="__codelineno-49-146" href="#__codelineno-49-146"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-147" name="__codelineno-49-147" href="#__codelineno-49-147"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">has_loop</span><span class="p">)</span>
<a id="__codelineno-49-148" name="__codelineno-49-148" href="#__codelineno-49-148"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-49-149" name="__codelineno-49-149" href="#__codelineno-49-149"></a><span class="w">            </span><span class="c1">//printf(&quot;has loop \n&quot;);</span>
<a id="__codelineno-49-150" name="__codelineno-49-150" href="#__codelineno-49-150"></a><span class="w">            </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">connected_KF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getKeyFrame</span><span class="p">(</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">loop_index</span><span class="p">);</span>
<a id="__codelineno-49-151" name="__codelineno-49-151" href="#__codelineno-49-151"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">connected_P</span><span class="p">,</span><span class="n">P0</span><span class="p">;</span>
<a id="__codelineno-49-152" name="__codelineno-49-152" href="#__codelineno-49-152"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">connected_R</span><span class="p">,</span><span class="n">R0</span><span class="p">;</span>
<a id="__codelineno-49-153" name="__codelineno-49-153" href="#__codelineno-49-153"></a><span class="w">            </span><span class="n">connected_KF</span><span class="o">-&gt;</span><span class="n">getPose</span><span class="p">(</span><span class="n">connected_P</span><span class="p">,</span><span class="w"> </span><span class="n">connected_R</span><span class="p">);</span>
<a id="__codelineno-49-154" name="__codelineno-49-154" href="#__codelineno-49-154"></a><span class="w">            </span><span class="c1">//cur_kf-&gt;getVioPose(P0, R0);</span>
<a id="__codelineno-49-155" name="__codelineno-49-155" href="#__codelineno-49-155"></a><span class="w">            </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getPose</span><span class="p">(</span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">R0</span><span class="p">);</span>
<a id="__codelineno-49-156" name="__codelineno-49-156" href="#__codelineno-49-156"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-49-157" name="__codelineno-49-157" href="#__codelineno-49-157"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-49-158" name="__codelineno-49-158" href="#__codelineno-49-158"></a><span class="w">                </span><span class="c1">//printf(&quot;add loop into visual \n&quot;);</span>
<a id="__codelineno-49-159" name="__codelineno-49-159" href="#__codelineno-49-159"></a><span class="w">                </span><span class="n">posegraph_visualization</span><span class="o">-&gt;</span><span class="n">add_loopedge</span><span class="p">(</span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">connected_P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">VISUALIZATION_SHIFT_X</span><span class="p">,</span><span class="w"> </span><span class="n">VISUALIZATION_SHIFT_Y</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-49-160" name="__codelineno-49-160" href="#__codelineno-49-160"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-49-161" name="__codelineno-49-161" href="#__codelineno-49-161"></a>
<a id="__codelineno-49-162" name="__codelineno-49-162" href="#__codelineno-49-162"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-163" name="__codelineno-49-163" href="#__codelineno-49-163"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-164" name="__codelineno-49-164" href="#__codelineno-49-164"></a><span class="w">    </span><span class="c1">//posegraph_visualization-&gt;add_pose(P + Vector3d(VISUALIZATION_SHIFT_X, VISUALIZATION_SHIFT_Y, 0), Q);</span>
<a id="__codelineno-49-165" name="__codelineno-49-165" href="#__codelineno-49-165"></a>
<a id="__codelineno-49-166" name="__codelineno-49-166" href="#__codelineno-49-166"></a><span class="w">    </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cur_kf</span><span class="p">);</span>
<a id="__codelineno-49-167" name="__codelineno-49-167" href="#__codelineno-49-167"></a><span class="w">    </span><span class="n">publish</span><span class="p">();</span>
<a id="__codelineno-49-168" name="__codelineno-49-168" href="#__codelineno-49-168"></a><span class="w">    </span><span class="n">m_keyframelist</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-49-169" name="__codelineno-49-169" href="#__codelineno-49-169"></a><span class="p">}</span>
</code></pre></div>
<h3 id="global-pose-graph-optimization">Global Pose Graph Optimization</h3>
<p>In <code>PoseGraph::PoseGraph()</code> constructor, there is <code>t_optimization = std::thread(&amp;PoseGraph::optimize4DoF, this);</code> that launches a thread dedicated to perform global pose graph optimization.</p>
<p>Generally speaking, the global pose optimization adds all poses from <code>keyframelist</code> by <code>problem.AddParameterBlock(euler_array[i], 1, angle_local_parameterization);</code> and <code>problem.AddParameterBlock(t_array[i], 3);</code> to ceres problem, 
whose residuals are <code>FourDOFError</code> and <code>FourDOFWeightError</code>, for local and loop closure pose optimization, respectively.</p>
<p>For <code>FourDOFError</code> for local pose optimization, for each keyframe <code>i</code>, get the recent 4 frames <code>for (int j = 1; j &lt; 5; j++) {...}</code> and compute the transforms between these four poses.
They should be as tightly linked to each other as possible in chronological order, hence the residual is defined as the gap between the chronologically linked poses to be as small as possible.</p>
<p>For <code>FourDOFWeightError</code> for loop closure, for a pose that sees loop closure <code>if((*it)-&gt;has_loop)</code>, it performs optimization on the loop closure correction transform with <code>relative_t = (*it)-&gt;getLoopRelativeT();</code> and <code>double relative_yaw = (*it)-&gt;getLoopRelativeYaw();</code>
If two poses see some similar features/scenes, they should be close to each other.
As a result, the gap between the two loop closure poses should be small.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">PoseGraph::optimize4DoF</span><span class="p">()</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="p">{</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="c1">// some safe check such as pose buffer should not be empty</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">        </span><span class="n">TicToc</span><span class="w"> </span><span class="n">tmp_t</span><span class="p">;</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">        </span><span class="n">m_keyframelist</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">        </span><span class="n">KeyFrame</span><span class="o">*</span><span class="w"> </span><span class="n">cur_kf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getKeyFrame</span><span class="p">(</span><span class="n">cur_index</span><span class="p">);</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">max_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">        </span><span class="c1">// w^t_i   w^q_i</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">max_length</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">        </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">q_array</span><span class="p">[</span><span class="n">max_length</span><span class="p">];</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">euler_array</span><span class="p">[</span><span class="n">max_length</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">sequence_array</span><span class="p">[</span><span class="n">max_length</span><span class="p">];</span><span class="w">    </span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">Problem</span><span class="w"> </span><span class="n">problem</span><span class="p">;</span>
<a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">Solver</span><span class="o">::</span><span class="n">Options</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">        </span><span class="n">options</span><span class="p">.</span><span class="n">linear_solver_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">SPARSE_NORMAL_CHOLESKY</span><span class="p">;</span>
<a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">        </span><span class="n">options</span><span class="p">.</span><span class="n">max_num_iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">Solver</span><span class="o">::</span><span class="n">Summary</span><span class="w"> </span><span class="n">summary</span><span class="p">;</span>
<a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">LossFunction</span><span class="w"> </span><span class="o">*</span><span class="n">loss_function</span><span class="p">;</span>
<a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">        </span><span class="n">loss_function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">HuberLoss</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
<a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">LocalParameterization</span><span class="o">*</span><span class="w"> </span><span class="n">angle_local_parameterization</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">            </span><span class="n">AngleLocalParameterization</span><span class="o">::</span><span class="n">Create</span><span class="p">();</span>
<a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a>
<a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="w">        </span><span class="n">list</span><span class="o">&lt;</span><span class="n">KeyFrame</span><span class="o">*&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">it</span><span class="p">;</span>
<a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a>
<a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">local_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a><span class="w">            </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">tmp_q</span><span class="p">;</span>
<a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">tmp_r</span><span class="p">;</span>
<a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">tmp_t</span><span class="p">;</span>
<a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">tmp_t</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_r</span><span class="p">);</span>
<a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a><span class="w">            </span><span class="n">tmp_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_r</span><span class="p">;</span>
<a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a><span class="w">            </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_t</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a><span class="w">            </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_t</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a><span class="w">            </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_t</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a><span class="w">            </span><span class="n">q_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_q</span><span class="p">;</span>
<a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a>
<a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">euler_angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">tmp_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">());</span>
<a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a><span class="w">            </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">euler_angle</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
<a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a><span class="w">            </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">euler_angle</span><span class="p">.</span><span class="n">y</span><span class="p">();</span>
<a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a><span class="w">            </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">euler_angle</span><span class="p">.</span><span class="n">z</span><span class="p">();</span>
<a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a>
<a id="__codelineno-50-50" name="__codelineno-50-50" href="#__codelineno-50-50"></a><span class="w">            </span><span class="n">sequence_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="p">;</span>
<a id="__codelineno-50-51" name="__codelineno-50-51" href="#__codelineno-50-51"></a>
<a id="__codelineno-50-52" name="__codelineno-50-52" href="#__codelineno-50-52"></a><span class="w">            </span><span class="n">problem</span><span class="p">.</span><span class="n">AddParameterBlock</span><span class="p">(</span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">angle_local_parameterization</span><span class="p">);</span>
<a id="__codelineno-50-53" name="__codelineno-50-53" href="#__codelineno-50-53"></a><span class="w">            </span><span class="n">problem</span><span class="p">.</span><span class="n">AddParameterBlock</span><span class="p">(</span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-50-54" name="__codelineno-50-54" href="#__codelineno-50-54"></a>
<a id="__codelineno-50-55" name="__codelineno-50-55" href="#__codelineno-50-55"></a><span class="w">            </span><span class="c1">// if being the first keyframe</span>
<a id="__codelineno-50-56" name="__codelineno-50-56" href="#__codelineno-50-56"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">first_looped_index</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-50-57" name="__codelineno-50-57" href="#__codelineno-50-57"></a><span class="w">            </span><span class="p">{</span><span class="w">   </span>
<a id="__codelineno-50-58" name="__codelineno-50-58" href="#__codelineno-50-58"></a><span class="w">                </span><span class="n">problem</span><span class="p">.</span><span class="n">SetParameterBlockConstant</span><span class="p">(</span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-50-59" name="__codelineno-50-59" href="#__codelineno-50-59"></a><span class="w">                </span><span class="n">problem</span><span class="p">.</span><span class="n">SetParameterBlockConstant</span><span class="p">(</span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-50-60" name="__codelineno-50-60" href="#__codelineno-50-60"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-50-61" name="__codelineno-50-61" href="#__codelineno-50-61"></a>
<a id="__codelineno-50-62" name="__codelineno-50-62" href="#__codelineno-50-62"></a><span class="w">            </span><span class="c1">//add edge</span>
<a id="__codelineno-50-63" name="__codelineno-50-63" href="#__codelineno-50-63"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-50-64" name="__codelineno-50-64" href="#__codelineno-50-64"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-50-65" name="__codelineno-50-65" href="#__codelineno-50-65"></a><span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sequence_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">sequence_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">])</span>
<a id="__codelineno-50-66" name="__codelineno-50-66" href="#__codelineno-50-66"></a><span class="w">              </span><span class="p">{</span>
<a id="__codelineno-50-67" name="__codelineno-50-67" href="#__codelineno-50-67"></a><span class="w">                </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">euler_conncected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">q_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">].</span><span class="n">toRotationMatrix</span><span class="p">());</span>
<a id="__codelineno-50-68" name="__codelineno-50-68" href="#__codelineno-50-68"></a><span class="w">                </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">relative_t</span><span class="p">(</span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-50-69" name="__codelineno-50-69" href="#__codelineno-50-69"></a><span class="w">                </span><span class="n">relative_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">].</span><span class="n">inverse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">relative_t</span><span class="p">;</span>
<a id="__codelineno-50-70" name="__codelineno-50-70" href="#__codelineno-50-70"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-50-71" name="__codelineno-50-71" href="#__codelineno-50-71"></a><span class="w">                </span><span class="n">ceres</span><span class="o">::</span><span class="n">CostFunction</span><span class="o">*</span><span class="w"> </span><span class="n">cost_function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FourDOFError</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">x</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">z</span><span class="p">(),</span>
<a id="__codelineno-50-72" name="__codelineno-50-72" href="#__codelineno-50-72"></a><span class="w">                                               </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="n">euler_conncected</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span><span class="w"> </span><span class="n">euler_conncected</span><span class="p">.</span><span class="n">z</span><span class="p">());</span>
<a id="__codelineno-50-73" name="__codelineno-50-73" href="#__codelineno-50-73"></a><span class="w">                </span><span class="n">problem</span><span class="p">.</span><span class="n">AddResidualBlock</span><span class="p">(</span><span class="n">cost_function</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-50-74" name="__codelineno-50-74" href="#__codelineno-50-74"></a><span class="w">                                        </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-50-75" name="__codelineno-50-75" href="#__codelineno-50-75"></a><span class="w">                                        </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-50-76" name="__codelineno-50-76" href="#__codelineno-50-76"></a><span class="w">                                        </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-50-77" name="__codelineno-50-77" href="#__codelineno-50-77"></a><span class="w">              </span><span class="p">}</span>
<a id="__codelineno-50-78" name="__codelineno-50-78" href="#__codelineno-50-78"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-50-79" name="__codelineno-50-79" href="#__codelineno-50-79"></a>
<a id="__codelineno-50-80" name="__codelineno-50-80" href="#__codelineno-50-80"></a>
<a id="__codelineno-50-81" name="__codelineno-50-81" href="#__codelineno-50-81"></a><span class="w">            </span><span class="c1">//add loop edge</span>
<a id="__codelineno-50-82" name="__codelineno-50-82" href="#__codelineno-50-82"></a><span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">has_loop</span><span class="p">)</span>
<a id="__codelineno-50-83" name="__codelineno-50-83" href="#__codelineno-50-83"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-50-84" name="__codelineno-50-84" href="#__codelineno-50-84"></a><span class="w">                </span><span class="n">assert</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">loop_index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">first_looped_index</span><span class="p">);</span>
<a id="__codelineno-50-85" name="__codelineno-50-85" href="#__codelineno-50-85"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">connected_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getKeyFrame</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">loop_index</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">local_index</span><span class="p">;</span>
<a id="__codelineno-50-86" name="__codelineno-50-86" href="#__codelineno-50-86"></a><span class="w">                </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">euler_conncected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">q_array</span><span class="p">[</span><span class="n">connected_index</span><span class="p">].</span><span class="n">toRotationMatrix</span><span class="p">());</span>
<a id="__codelineno-50-87" name="__codelineno-50-87" href="#__codelineno-50-87"></a><span class="w">                </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">relative_t</span><span class="p">;</span>
<a id="__codelineno-50-88" name="__codelineno-50-88" href="#__codelineno-50-88"></a><span class="w">                </span><span class="n">relative_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">getLoopRelativeT</span><span class="p">();</span>
<a id="__codelineno-50-89" name="__codelineno-50-89" href="#__codelineno-50-89"></a><span class="w">                </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">getLoopRelativeYaw</span><span class="p">();</span>
<a id="__codelineno-50-90" name="__codelineno-50-90" href="#__codelineno-50-90"></a><span class="w">                </span><span class="n">ceres</span><span class="o">::</span><span class="n">CostFunction</span><span class="o">*</span><span class="w"> </span><span class="n">cost_function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FourDOFWeightError</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">x</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span><span class="w"> </span><span class="n">relative_t</span><span class="p">.</span><span class="n">z</span><span class="p">(),</span>
<a id="__codelineno-50-91" name="__codelineno-50-91" href="#__codelineno-50-91"></a><span class="w">                                                                           </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="n">euler_conncected</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span><span class="w"> </span><span class="n">euler_conncected</span><span class="p">.</span><span class="n">z</span><span class="p">());</span>
<a id="__codelineno-50-92" name="__codelineno-50-92" href="#__codelineno-50-92"></a><span class="w">                </span><span class="n">problem</span><span class="p">.</span><span class="n">AddResidualBlock</span><span class="p">(</span><span class="n">cost_function</span><span class="p">,</span><span class="w"> </span><span class="n">loss_function</span><span class="p">,</span><span class="w"> </span><span class="n">euler_array</span><span class="p">[</span><span class="n">connected_index</span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-50-93" name="__codelineno-50-93" href="#__codelineno-50-93"></a><span class="w">                                                              </span><span class="n">t_array</span><span class="p">[</span><span class="n">connected_index</span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-50-94" name="__codelineno-50-94" href="#__codelineno-50-94"></a><span class="w">                                                              </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-50-95" name="__codelineno-50-95" href="#__codelineno-50-95"></a><span class="w">                                                              </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-50-96" name="__codelineno-50-96" href="#__codelineno-50-96"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-50-97" name="__codelineno-50-97" href="#__codelineno-50-97"></a>
<a id="__codelineno-50-98" name="__codelineno-50-98" href="#__codelineno-50-98"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cur_index</span><span class="p">)</span>
<a id="__codelineno-50-99" name="__codelineno-50-99" href="#__codelineno-50-99"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-50-100" name="__codelineno-50-100" href="#__codelineno-50-100"></a><span class="w">            </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-50-101" name="__codelineno-50-101" href="#__codelineno-50-101"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-50-102" name="__codelineno-50-102" href="#__codelineno-50-102"></a><span class="w">        </span><span class="n">m_keyframelist</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-50-103" name="__codelineno-50-103" href="#__codelineno-50-103"></a>
<a id="__codelineno-50-104" name="__codelineno-50-104" href="#__codelineno-50-104"></a><span class="w">        </span><span class="n">ceres</span><span class="o">::</span><span class="n">Solve</span><span class="p">(</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">summary</span><span class="p">);</span>
<a id="__codelineno-50-105" name="__codelineno-50-105" href="#__codelineno-50-105"></a>
<a id="__codelineno-50-106" name="__codelineno-50-106" href="#__codelineno-50-106"></a><span class="w">        </span><span class="n">m_keyframelist</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-50-107" name="__codelineno-50-107" href="#__codelineno-50-107"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-50-108" name="__codelineno-50-108" href="#__codelineno-50-108"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-50-109" name="__codelineno-50-109" href="#__codelineno-50-109"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-50-110" name="__codelineno-50-110" href="#__codelineno-50-110"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">first_looped_index</span><span class="p">)</span>
<a id="__codelineno-50-111" name="__codelineno-50-111" href="#__codelineno-50-111"></a><span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-50-112" name="__codelineno-50-112" href="#__codelineno-50-112"></a><span class="w">            </span><span class="n">Quaterniond</span><span class="w"> </span><span class="n">tmp_q</span><span class="p">;</span>
<a id="__codelineno-50-113" name="__codelineno-50-113" href="#__codelineno-50-113"></a><span class="w">            </span><span class="n">tmp_q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">ypr2R</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">euler_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]));</span>
<a id="__codelineno-50-114" name="__codelineno-50-114" href="#__codelineno-50-114"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">tmp_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3d</span><span class="p">(</span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-50-115" name="__codelineno-50-115" href="#__codelineno-50-115"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">tmp_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_q</span><span class="p">.</span><span class="n">toRotationMatrix</span><span class="p">();</span>
<a id="__codelineno-50-116" name="__codelineno-50-116" href="#__codelineno-50-116"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="w"> </span><span class="n">updatePose</span><span class="p">(</span><span class="n">tmp_t</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_r</span><span class="p">);</span>
<a id="__codelineno-50-117" name="__codelineno-50-117" href="#__codelineno-50-117"></a>
<a id="__codelineno-50-118" name="__codelineno-50-118" href="#__codelineno-50-118"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cur_index</span><span class="p">)</span>
<a id="__codelineno-50-119" name="__codelineno-50-119" href="#__codelineno-50-119"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-50-120" name="__codelineno-50-120" href="#__codelineno-50-120"></a><span class="w">            </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-50-121" name="__codelineno-50-121" href="#__codelineno-50-121"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-50-122" name="__codelineno-50-122" href="#__codelineno-50-122"></a>
<a id="__codelineno-50-123" name="__codelineno-50-123" href="#__codelineno-50-123"></a><span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">cur_t</span><span class="p">,</span><span class="w"> </span><span class="n">vio_t</span><span class="p">;</span>
<a id="__codelineno-50-124" name="__codelineno-50-124" href="#__codelineno-50-124"></a><span class="w">        </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">cur_r</span><span class="p">,</span><span class="w"> </span><span class="n">vio_r</span><span class="p">;</span>
<a id="__codelineno-50-125" name="__codelineno-50-125" href="#__codelineno-50-125"></a><span class="w">        </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getPose</span><span class="p">(</span><span class="n">cur_t</span><span class="p">,</span><span class="w"> </span><span class="n">cur_r</span><span class="p">);</span>
<a id="__codelineno-50-126" name="__codelineno-50-126" href="#__codelineno-50-126"></a><span class="w">        </span><span class="n">cur_kf</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">vio_t</span><span class="p">,</span><span class="w"> </span><span class="n">vio_r</span><span class="p">);</span>
<a id="__codelineno-50-127" name="__codelineno-50-127" href="#__codelineno-50-127"></a><span class="w">        </span><span class="n">m_drift</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a id="__codelineno-50-128" name="__codelineno-50-128" href="#__codelineno-50-128"></a><span class="w">        </span><span class="n">yaw_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">cur_r</span><span class="p">).</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">R2ypr</span><span class="p">(</span><span class="n">vio_r</span><span class="p">).</span><span class="n">x</span><span class="p">();</span>
<a id="__codelineno-50-129" name="__codelineno-50-129" href="#__codelineno-50-129"></a><span class="w">        </span><span class="n">r_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utility</span><span class="o">::</span><span class="n">ypr2R</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">yaw_drift</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-50-130" name="__codelineno-50-130" href="#__codelineno-50-130"></a><span class="w">        </span><span class="n">t_drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vio_t</span><span class="p">;</span>
<a id="__codelineno-50-131" name="__codelineno-50-131" href="#__codelineno-50-131"></a><span class="w">        </span><span class="n">m_drift</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-50-132" name="__codelineno-50-132" href="#__codelineno-50-132"></a>
<a id="__codelineno-50-133" name="__codelineno-50-133" href="#__codelineno-50-133"></a><span class="w">        </span><span class="n">it</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-50-134" name="__codelineno-50-134" href="#__codelineno-50-134"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">keyframelist</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-50-135" name="__codelineno-50-135" href="#__codelineno-50-135"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-50-136" name="__codelineno-50-136" href="#__codelineno-50-136"></a><span class="w">            </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<a id="__codelineno-50-137" name="__codelineno-50-137" href="#__codelineno-50-137"></a><span class="w">            </span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-50-138" name="__codelineno-50-138" href="#__codelineno-50-138"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">getVioPose</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-50-139" name="__codelineno-50-139" href="#__codelineno-50-139"></a><span class="w">            </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t_drift</span><span class="p">;</span>
<a id="__codelineno-50-140" name="__codelineno-50-140" href="#__codelineno-50-140"></a><span class="w">            </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_drift</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<a id="__codelineno-50-141" name="__codelineno-50-141" href="#__codelineno-50-141"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">updatePose</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-50-142" name="__codelineno-50-142" href="#__codelineno-50-142"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-50-143" name="__codelineno-50-143" href="#__codelineno-50-143"></a><span class="w">        </span><span class="n">m_keyframelist</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-50-144" name="__codelineno-50-144" href="#__codelineno-50-144"></a><span class="w">        </span><span class="n">updatePath</span><span class="p">();</span>
<a id="__codelineno-50-145" name="__codelineno-50-145" href="#__codelineno-50-145"></a>
<a id="__codelineno-50-146" name="__codelineno-50-146" href="#__codelineno-50-146"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="w"> </span><span class="n">dura</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<a id="__codelineno-50-147" name="__codelineno-50-147" href="#__codelineno-50-147"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">dura</span><span class="p">);</span>
<a id="__codelineno-50-148" name="__codelineno-50-148" href="#__codelineno-50-148"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-149" name="__codelineno-50-149" href="#__codelineno-50-149"></a><span class="p">}</span>
</code></pre></div>
<p><code>FourDOFError</code> and <code>FourDOFWeightError</code> are identical that both are defined the cost as the gap between two poses, except that <code>FourDOFWeightError</code> adds a weight (init at <code>weight = 1</code>) to linearly amplify the residuals.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">FourDOFError</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="p">{</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="n">FourDOFError</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_z</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">roll_i</span><span class="p">)</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">                  </span><span class="o">:</span><span class="n">t_x</span><span class="p">(</span><span class="n">t_x</span><span class="p">),</span><span class="w"> </span><span class="n">t_y</span><span class="p">(</span><span class="n">t_y</span><span class="p">),</span><span class="w"> </span><span class="n">t_z</span><span class="p">(</span><span class="n">t_z</span><span class="p">),</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">(</span><span class="n">relative_yaw</span><span class="p">),</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">(</span><span class="n">pitch_i</span><span class="p">),</span><span class="w"> </span><span class="n">roll_i</span><span class="p">(</span><span class="n">roll_i</span><span class="p">){}</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">    </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="p">()(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">yaw_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ti</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">yaw_j</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">tj</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">residuals</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">        </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ti</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">        </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ti</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">        </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ti</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">        </span><span class="c1">// euler to rotation</span>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">w_R_i</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">        </span><span class="n">YawPitchRollToRotationMatrix</span><span class="p">(</span><span class="n">yaw_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">pitch_i</span><span class="p">),</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">roll_i</span><span class="p">),</span><span class="w"> </span><span class="n">w_R_i</span><span class="p">);</span>
<a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">        </span><span class="c1">// rotation transpose</span>
<a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">i_R_w</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
<a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">        </span><span class="n">RotationMatrixTranspose</span><span class="p">(</span><span class="n">w_R_i</span><span class="p">,</span><span class="w"> </span><span class="n">i_R_w</span><span class="p">);</span>
<a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">        </span><span class="c1">// rotation matrix rotate point</span>
<a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">        </span><span class="n">RotationMatrixRotatePoint</span><span class="p">(</span><span class="n">i_R_w</span><span class="p">,</span><span class="w"> </span><span class="n">t_w_ij</span><span class="p">,</span><span class="w"> </span><span class="n">t_i_ij</span><span class="p">);</span>
<a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>
<a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">t_x</span><span class="p">));</span>
<a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">t_y</span><span class="p">));</span>
<a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">t_z</span><span class="p">));</span>
<a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NormalizeAngle</span><span class="p">(</span><span class="n">yaw_j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yaw_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">relative_yaw</span><span class="p">));</span>
<a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a>
<a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a>
<a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">CostFunction</span><span class="o">*</span><span class="w"> </span><span class="n">Create</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_z</span><span class="p">,</span>
<a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">roll_i</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">AutoDiffCostFunction</span><span class="o">&lt;</span>
<a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="w">              </span><span class="n">FourDOFError</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">FourDOFError</span><span class="p">(</span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="n">t_z</span><span class="p">,</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="n">roll_i</span><span class="p">)));</span>
<a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a>
<a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="n">t_z</span><span class="p">;</span>
<a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="n">roll_i</span><span class="p">;</span>
<a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a>
<a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a><span class="p">};</span>
<a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a>
<a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a>
<a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a><span class="k">struct</span><span class="w"> </span><span class="nc">FourDOFWeightError</span>
<a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a><span class="p">{</span>
<a id="__codelineno-51-48" name="__codelineno-51-48" href="#__codelineno-51-48"></a><span class="w">    </span><span class="n">FourDOFWeightError</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_z</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">roll_i</span><span class="p">)</span>
<a id="__codelineno-51-49" name="__codelineno-51-49" href="#__codelineno-51-49"></a><span class="w">                  </span><span class="o">:</span><span class="n">t_x</span><span class="p">(</span><span class="n">t_x</span><span class="p">),</span><span class="w"> </span><span class="n">t_y</span><span class="p">(</span><span class="n">t_y</span><span class="p">),</span><span class="w"> </span><span class="n">t_z</span><span class="p">(</span><span class="n">t_z</span><span class="p">),</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">(</span><span class="n">relative_yaw</span><span class="p">),</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">(</span><span class="n">pitch_i</span><span class="p">),</span><span class="w"> </span><span class="n">roll_i</span><span class="p">(</span><span class="n">roll_i</span><span class="p">){</span>
<a id="__codelineno-51-50" name="__codelineno-51-50" href="#__codelineno-51-50"></a><span class="w">                    </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-51-51" name="__codelineno-51-51" href="#__codelineno-51-51"></a><span class="w">                  </span><span class="p">}</span>
<a id="__codelineno-51-52" name="__codelineno-51-52" href="#__codelineno-51-52"></a>
<a id="__codelineno-51-53" name="__codelineno-51-53" href="#__codelineno-51-53"></a><span class="w">    </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-51-54" name="__codelineno-51-54" href="#__codelineno-51-54"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="p">()(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">yaw_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ti</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">yaw_j</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">tj</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">residuals</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-51-55" name="__codelineno-51-55" href="#__codelineno-51-55"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-51-56" name="__codelineno-51-56" href="#__codelineno-51-56"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-51-57" name="__codelineno-51-57" href="#__codelineno-51-57"></a><span class="w">        </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ti</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-51-58" name="__codelineno-51-58" href="#__codelineno-51-58"></a><span class="w">        </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ti</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-51-59" name="__codelineno-51-59" href="#__codelineno-51-59"></a><span class="w">        </span><span class="n">t_w_ij</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ti</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-51-60" name="__codelineno-51-60" href="#__codelineno-51-60"></a>
<a id="__codelineno-51-61" name="__codelineno-51-61" href="#__codelineno-51-61"></a><span class="w">        </span><span class="c1">// euler to rotation</span>
<a id="__codelineno-51-62" name="__codelineno-51-62" href="#__codelineno-51-62"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">w_R_i</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
<a id="__codelineno-51-63" name="__codelineno-51-63" href="#__codelineno-51-63"></a><span class="w">        </span><span class="n">YawPitchRollToRotationMatrix</span><span class="p">(</span><span class="n">yaw_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">pitch_i</span><span class="p">),</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">roll_i</span><span class="p">),</span><span class="w"> </span><span class="n">w_R_i</span><span class="p">);</span>
<a id="__codelineno-51-64" name="__codelineno-51-64" href="#__codelineno-51-64"></a><span class="w">        </span><span class="c1">// rotation transpose</span>
<a id="__codelineno-51-65" name="__codelineno-51-65" href="#__codelineno-51-65"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">i_R_w</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
<a id="__codelineno-51-66" name="__codelineno-51-66" href="#__codelineno-51-66"></a><span class="w">        </span><span class="n">RotationMatrixTranspose</span><span class="p">(</span><span class="n">w_R_i</span><span class="p">,</span><span class="w"> </span><span class="n">i_R_w</span><span class="p">);</span>
<a id="__codelineno-51-67" name="__codelineno-51-67" href="#__codelineno-51-67"></a><span class="w">        </span><span class="c1">// rotation matrix rotate point</span>
<a id="__codelineno-51-68" name="__codelineno-51-68" href="#__codelineno-51-68"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-51-69" name="__codelineno-51-69" href="#__codelineno-51-69"></a><span class="w">        </span><span class="n">RotationMatrixRotatePoint</span><span class="p">(</span><span class="n">i_R_w</span><span class="p">,</span><span class="w"> </span><span class="n">t_w_ij</span><span class="p">,</span><span class="w"> </span><span class="n">t_i_ij</span><span class="p">);</span>
<a id="__codelineno-51-70" name="__codelineno-51-70" href="#__codelineno-51-70"></a>
<a id="__codelineno-51-71" name="__codelineno-51-71" href="#__codelineno-51-71"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">t_x</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">weight</span><span class="p">);</span>
<a id="__codelineno-51-72" name="__codelineno-51-72" href="#__codelineno-51-72"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">t_y</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">weight</span><span class="p">);</span>
<a id="__codelineno-51-73" name="__codelineno-51-73" href="#__codelineno-51-73"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t_i_ij</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">t_z</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">weight</span><span class="p">);</span>
<a id="__codelineno-51-74" name="__codelineno-51-74" href="#__codelineno-51-74"></a><span class="w">        </span><span class="n">residuals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NormalizeAngle</span><span class="p">((</span><span class="n">yaw_j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yaw_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">relative_yaw</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="mf">10.0</span><span class="p">);</span>
<a id="__codelineno-51-75" name="__codelineno-51-75" href="#__codelineno-51-75"></a>
<a id="__codelineno-51-76" name="__codelineno-51-76" href="#__codelineno-51-76"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-51-77" name="__codelineno-51-77" href="#__codelineno-51-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-78" name="__codelineno-51-78" href="#__codelineno-51-78"></a>
<a id="__codelineno-51-79" name="__codelineno-51-79" href="#__codelineno-51-79"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">CostFunction</span><span class="o">*</span><span class="w"> </span><span class="n">Create</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t_z</span><span class="p">,</span>
<a id="__codelineno-51-80" name="__codelineno-51-80" href="#__codelineno-51-80"></a><span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">roll_i</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-51-81" name="__codelineno-51-81" href="#__codelineno-51-81"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-51-82" name="__codelineno-51-82" href="#__codelineno-51-82"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ceres</span><span class="o">::</span><span class="n">AutoDiffCostFunction</span><span class="o">&lt;</span>
<a id="__codelineno-51-83" name="__codelineno-51-83" href="#__codelineno-51-83"></a><span class="w">              </span><span class="n">FourDOFWeightError</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-51-84" name="__codelineno-51-84" href="#__codelineno-51-84"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">FourDOFWeightError</span><span class="p">(</span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="n">t_z</span><span class="p">,</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="n">roll_i</span><span class="p">)));</span>
<a id="__codelineno-51-85" name="__codelineno-51-85" href="#__codelineno-51-85"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-86" name="__codelineno-51-86" href="#__codelineno-51-86"></a>
<a id="__codelineno-51-87" name="__codelineno-51-87" href="#__codelineno-51-87"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t_x</span><span class="p">,</span><span class="w"> </span><span class="n">t_y</span><span class="p">,</span><span class="w"> </span><span class="n">t_z</span><span class="p">;</span>
<a id="__codelineno-51-88" name="__codelineno-51-88" href="#__codelineno-51-88"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">relative_yaw</span><span class="p">,</span><span class="w"> </span><span class="n">pitch_i</span><span class="p">,</span><span class="w"> </span><span class="n">roll_i</span><span class="p">;</span>
<a id="__codelineno-51-89" name="__codelineno-51-89" href="#__codelineno-51-89"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span>
<a id="__codelineno-51-90" name="__codelineno-51-90" href="#__codelineno-51-90"></a>
<a id="__codelineno-51-91" name="__codelineno-51-91" href="#__codelineno-51-91"></a><span class="p">};</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.top", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>