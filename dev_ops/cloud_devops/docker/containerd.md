# Containerd

`containerd` is the core component of docker container, and can be considered as the minimalist container.
A docker container adds user-facing features on top of `containerd` that in comparison keeps necessary container features.

History and commercial justifications: before 2015, besides the de facto no.1 container solution leader Docker,
other companies, e.g., CoreOS, Google, Red Hat, and other industry leaders all started their container product development.
To maintain container portability, they (including Docker) soon came together under the Linux Foundation to form the Open Container Initiative (OCI) specification.

As a part of the Docker project, `containerd` was spun out as a separate project to foster an open and standardized container ecosystem.
Docker donated `containerd` to the Cloud Native Computing Foundation (CNCF) to be governed as an open, industry-standard project.

To further decompose the encapsulation, here explains with a user action to run docker

1. User docker run command
2. Docker CLI
3. Docker Daemon (`dockerd`)
4. `containerd`
5. `runc` (lower-level runtime)
6. Running Container

where the transition from `dockerd` to `containerd` is essentially `dockerd` making API calls to `containerd` that by `config.json` (defined runtime env and resourced) to launch a runtime env.

However, in practice, it is still recommended to use docker to build container.

## The `config.json` for `containerd`

`config.json` is the OCI Runtime Specification file typically generated by `containerd` rather than manual setup.

For example, to run nginx:

```json
{
  "ociVersion": "1.0.2",
  "process": {
    // What command to run inside the container
    "args": [
      "nginx",
      "-g",
      "daemon off;"
    ],
    // Environment variables
    "env": [
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    ],
    // Working directory for the command
    "cwd": "/"
  },
  "root": {
    // Path on the host to the container's root filesystem
    "path": "/path/to/my/container/rootfs",
    "readonly": false
  },
  "hostname": "my-nginx-container",
  "mounts": [
    // Required kernel filesystems
    { "destination": "/proc", "type": "proc", "source": "proc" },
    { "destination": "/dev", "type": "tmpfs", "source": "tmpfs" },
    { "destination": "/sys", "type": "sysfs", "source": "sysfs" }
  ],
  "linux": {
    // Isolate all these different aspects of the system
    "namespaces": [
      { "type": "pid" },
      { "type": "network" },
      { "type": "ipc" },
      { "type": "uts" },
      { "type": "mount" }
    ],
    // Define resource limits for the container
    "resources": {
      "memory": {
        "limit": 536870912 // 512 MB limit
      },
      "cpu": {
        "shares": 512 // Relative CPU shares
      }
    }
  }
}
```

where `cgroups` for resource control and actual runtime envs are prepared.
